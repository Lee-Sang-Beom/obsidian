## ğŸ“– ê°œìš”

### ğŸ¯ ë¬´ì—‡ì¸ê°€ìš”?

`useInfiniteSignals`ëŠ” **ë¬´í•œ ìŠ¤í¬ë¡¤**ê³¼ **ìë™ ìƒˆë¡œê³ ì¹¨** ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” React ì»¤ìŠ¤í…€ í›…ì…ë‹ˆë‹¤.

### âœ¨ ì£¼ìš” ê¸°ëŠ¥

- **ë¬´í•œ ìŠ¤í¬ë¡¤**: ìŠ¤í¬ë¡¤í•˜ë©´ ìë™ìœ¼ë¡œ ìƒˆ ë°ì´í„° ë¡œë“œ
- **ìë™ ìƒˆë¡œê³ ì¹¨**: 5ë¶„ë§ˆë‹¤ ìµœì‹  ë°ì´í„° ì—…ë°ì´íŠ¸
- **ìŠ¤ë§ˆíŠ¸ ìƒˆë¡œê³ ì¹¨**: ë¸Œë¼ìš°ì € í¬ì»¤ìŠ¤ ì‹œ ìë™ ì—…ë°ì´íŠ¸
- **ë°°ê²½ ìµœì í™”**: íƒ­ì´ ë¹„í™œì„±ì¼ ë•Œ ë¶ˆí•„ìš”í•œ ìš”ì²­ ë°©ì§€
- **ì™„ì „í•œ ìƒíƒœ ê´€ë¦¬**: ë¡œë”©, ì—ëŸ¬, ë¹ˆ ë°ì´í„° ìƒíƒœ ì²˜ë¦¬

### ğŸŒŸ ì–¸ì œ ì‚¬ìš©í•˜ë‚˜ìš”?

- ì†Œì…œ ë¯¸ë””ì–´ í”¼ë“œ
- ë‰´ìŠ¤ ëª©ë¡
- ìƒí’ˆ ëª©ë¡
- ì•Œë¦¼ ëª©ë¡
- ë¬´í•œ ìŠ¤í¬ë¡¤ì´ í•„ìš”í•œ ëª¨ë“  ê³³

---

## ğŸ—ï¸ ì½”ë“œ êµ¬ì¡°

### ğŸ“ ì¸í„°í˜ì´ìŠ¤ ì •ì˜

#### ì…ë ¥ ì˜µì…˜

```typescript
interface UseInfiniteSignalsOptions {
  type?: SignalTypeRequestEnum      // ğŸ“Š ì‹ í˜¸ íƒ€ì… í•„í„°
  pageSize?: number                 // ğŸ“„ í˜ì´ì§€ë‹¹ ì•„ì´í…œ ìˆ˜
  enabled?: boolean                 // ğŸ”˜ ì¿¼ë¦¬ í™œì„±í™” ì—¬ë¶€
  autoRefresh?: boolean            // ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ ì‚¬ìš© ì—¬ë¶€
  refreshInterval?: number         // â° ìƒˆë¡œê³ ì¹¨ ì£¼ê¸° (ë°€ë¦¬ì´ˆ)
}
```

#### ë°˜í™˜ê°’

```typescript
interface UseInfiniteSignalsResult {
  data: SignalListResponse[]        // ğŸ“‹ ì‹¤ì œ ë°ì´í„° ë°°ì—´
  fetchNextPage: () => void         // â–¶ï¸ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ í•¨ìˆ˜
  hasNextPage: boolean             // â“ ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
  isFetchingNextPage: boolean      // â³ ë‹¤ìŒ í˜ì´ì§€ ë¡œë”© ì¤‘
  isLoading: boolean               // ğŸ”„ ì²« ë¡œë”© ì¤‘
  isError: boolean                 // âŒ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€
  error: Error | null              // ğŸš¨ ì—ëŸ¬ ìƒì„¸ ì •ë³´
  refetch: () => void              // ğŸ” ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
}
```

#### ë¶„ì„ ëŒ€ìƒ
```tsx
import {useInfiniteQuery} from '@tanstack/react-query'  
import {useMemo} from 'react'  
import type {SignalListResponse, SignalTypeRequestEnum} from '@/pages/signal/types'  
import type {PagingResult} from '@/lib/types'  
import {signalService} from '@/service/signal-service.ts'  
  
interface UseInfiniteSignalsOptions {  
  type?: SignalTypeRequestEnum  
  pageSize?: number  
  enabled?: boolean  
  autoRefresh?: boolean  
  refreshInterval?: number  
}  
  
interface UseInfiniteSignalsResult {  
  data: SignalListResponse[] | undefined  
  fetchNextPage: () => void  
  hasNextPage: boolean  
  isFetchingNextPage: boolean  
  isLoading: boolean  
  isError: boolean  
  error: Error | null  
  refetch: () => void  
}  
  
/**  
 * ë¬´í•œ ìŠ¤í¬ë¡¤ ì‹œê·¸ë„ ëª©ë¡ì„ ê´€ë¦¬í•˜ëŠ” í›…  
 * ìë™ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥ê³¼ ì¤‘ë³µ ë°ì´í„° ì œê±° ê¸°ëŠ¥ì„ í¬í•¨  
 */  
export const useInfiniteSignals = ({  
                                     type = 'ALL',  
                                     pageSize = 10,  
                                     enabled = true,  
                                     autoRefresh = true,  
                                     refreshInterval = 5000  
                                   }: UseInfiniteSignalsOptions = {}): UseInfiniteSignalsResult => {  
  
  const {  
    data,  
    fetchNextPage,  
    hasNextPage,  
    isFetchingNextPage,  
    isLoading,  
    isError,  
    error,  
    refetch  
  } = useInfiniteQuery({  
    queryKey: ['useInfiniteSignals', type, pageSize],  
  
    queryFn: async ({pageParam = 1}) => {  
      const response = await signalService.getSignals({  
        type,  
        nowPage: pageParam,  
        pageSize  
      })  
  
      return response  
    },  
  
    getNextPageParam: (lastPage: PagingResult<SignalListResponse>, allPages) => {  
      const currentPage = allPages.length  
      const totalPages = lastPage.lastPage  
  
      return currentPage < totalPages ? currentPage + 1 : undefined  
    },  
  
    initialPageParam: 1,  
    enabled,  
    refetchInterval: autoRefresh ? refreshInterval : false,  
    refetchIntervalInBackground: true,  
    refetchOnWindowFocus: false,  
  })  
  
  /**  
   * ëª¨ë“  í˜ì´ì§€ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ ë³‘í•©  
   * ê° ì•„ì´í…œì— ê³ ìœ í•œ ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ React key ì¤‘ë³µ ë¬¸ì œ í•´ê²°  
   */  
  const flattenedData = useMemo(() => {  
    if (!data?.pages) return []  
  
    return data.pages.flatMap((page, pageIndex) =>  
      page.items.map((item, itemIndex) => ({  
        ...item,  
        // ê³ ìœ í•œ í‚¤ë¥¼ ìœ„í•´ í˜ì´ì§€ ì¸ë±ìŠ¤ì™€ ì•„ì´í…œ ì¸ë±ìŠ¤ ì¡°í•©  
        _uniqueKey: `${pageIndex}-${itemIndex}-${item.id || itemIndex}`,  
      }))  
    )  
  }, [data?.pages])  
  
  return {  
    data: flattenedData,  
    fetchNextPage,  
    hasNextPage,  
    isFetchingNextPage,  
    isLoading,  
    isError,  
    error,  
    refetch  
  }  
}
```
---

## ğŸ§  í•µì‹¬ ê°œë…

### ğŸŒŠ ë¬´í•œ ìŠ¤í¬ë¡¤ (Infinite Scroll)

#### ê¸°ë³¸ ì›ë¦¬

```
ğŸ“± ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ë‹¤ìš´
    â†“
ğŸ” ìƒˆë¡œìš´ í˜ì´ì§€ ë°ì´í„° ìš”ì²­
    â†“
ğŸ“‹ ê¸°ì¡´ ë°ì´í„°ì— ìƒˆ ë°ì´í„° ì¶”ê°€
    â†“
ğŸ¯ ì‚¬ìš©ìì—ê²Œ ì—°ì†ëœ ê²½í—˜ ì œê³µ
```

#### ì¼ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ vs ë¬´í•œ ìŠ¤í¬ë¡¤

|êµ¬ë¶„|ì¼ë°˜ í˜ì´ì§€ë„¤ì´ì…˜|ë¬´í•œ ìŠ¤í¬ë¡¤|
|---|---|---|
|**ì‚¬ìš©ì ê²½í—˜**|í˜ì´ì§€ ë²ˆí˜¸ í´ë¦­ í•„ìš”|ìì—°ìŠ¤ëŸ¬ìš´ ìŠ¤í¬ë¡¤|
|**ëª¨ë°”ì¼ ì¹œí™”ì„±**|ë¶ˆí¸í•¨|ë§¤ìš° í¸ë¦¬í•¨|
|**ë°ì´í„° ê´€ë¦¬**|í˜ì´ì§€ë³„ ë…ë¦½|ëˆ„ì  ê´€ë¦¬|
|**ì„±ëŠ¥**|ê°€ë²¼ì›€|ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€|

### ğŸ”„ React Queryì˜ useInfiniteQuery

#### ì¼ë°˜ ì¿¼ë¦¬ì™€ì˜ ì°¨ì´ì 

```typescript
// âŒ ì¼ë°˜ ì¿¼ë¦¬ - í•œ ë²ˆì— í•˜ë‚˜ì˜ í˜ì´ì§€ë§Œ
const { data } = useQuery(['signals'], () => getSignals(1))

// âœ… ë¬´í•œ ì¿¼ë¦¬ - ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ ëˆ„ì  ê´€ë¦¬
const { data, fetchNextPage } = useInfiniteQuery(
  ['signals'], 
  ({ pageParam }) => getSignals(pageParam)
)
```

---

## âš™ï¸ ì˜µì…˜ ì„¤ì •

### ğŸ”§ ê¸°ë³¸ ì„¤ì •ê°’

```typescript
const defaultOptions = {
  type: 'ALL',                     // ğŸŒ ëª¨ë“  ì‹ í˜¸ íƒ€ì…
  pageSize: 10,                    // ğŸ“„ í•œ í˜ì´ì§€ì— 10ê°œ
  enabled: true,                   // âœ… ì¦‰ì‹œ ë°ì´í„° ìš”ì²­ ì‹œì‘
  autoRefresh: true,               // ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ í™œì„±í™”
  refreshInterval: 5 * 60 * 1000   // â° 5ë¶„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨
}
```

### ğŸ›ï¸ React Query ë‚´ë¶€ ì˜µì…˜ë“¤

#### 1ï¸âƒ£ queryKey - ìºì‹œ ì‹ë³„ì

```typescript
queryKey: ['useInfiniteSignals', type, pageSize]
```

- **ì—­í• **: ìºì‹œì˜ ê³ ìœ  ì‹ë³„ì
- **ë™ì‘**: í‚¤ê°€ ë³€ê²½ë˜ë©´ ìƒˆë¡œìš´ ì¿¼ë¦¬ë¡œ ì¸ì‹
- **ì˜ˆì‹œ**: `type`ì´ 'ALL' â†’ 'BUY'ë¡œ ë³€ê²½ ì‹œ ìƒˆ ë°ì´í„° ìš”ì²­

#### 2ï¸âƒ£ queryFn - API í˜¸ì¶œ í•¨ìˆ˜

- `queryFn`ì€ ì„œë¹„ìŠ¤ íŒŒì¼ ë¡œì§ apië¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼  returní•©ë‹ˆë‹¤.
- ì „ë‹¬ë°›ì€ `refetchInterval` ë§ˆë‹¤ ìƒˆë¡œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```typescript
queryFn: async ({ pageParam = 1 }) => {
  return await signalService.getSignals({
    type,
    nowPage: pageParam,  // ğŸ“– í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
    pageSize
  })
}
```

#### 3ï¸âƒ£ getNextPageParam - ë‹¤ìŒ í˜ì´ì§€ ê²°ì •

- `getNextPageParam` í•¨ìˆ˜ëŠ”ë‹¤ìŒ í˜ì´ì§€ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆëŠ”ì§€ íŒë‹¨í•©ë‹ˆë‹¤.
	- í˜„ì¬ í˜ì´ì§€ ìˆ˜ì™€ ì „ì²´ í˜ì´ì§€ ìˆ˜ë¥¼ ë¹„êµí•´, ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆìœ¼ë©´ ê·¸ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

- React Queryì˜ `useInfiniteQuery`ëŠ” ë‹¤ìŒ ìƒí™©ì—ì„œ `getNextPageParam`ì„ í˜¸ì¶œ
	- `queryFn`ìœ¼ë¡œ í•œ í˜ì´ì§€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„
	- **ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆëŠ”ì§€** í™•ì¸í•˜ê¸° ìœ„í•´ ìë™ìœ¼ë¡œ `getNextPageParam`ì„ ì‹¤í–‰

- íŒŒë¼ë¯¸í„° ì •ë³´
	- `lastPage`: `queryFn`ì—ì„œ **ê°€ì¥ ë§ˆì§€ë§‰ì— ë¶ˆëŸ¬ì˜¨ í˜ì´ì§€ì˜ ê²°ê³¼**
	- `allPages`: ì§€ê¸ˆê¹Œì§€ ë¶ˆëŸ¬ì˜¨ ëª¨ë“  í˜ì´ì§€ì˜ ë°°ì—´ (ì˜ˆ: `[1í˜ì´ì§€, 2í˜ì´ì§€, ...]`)

```typescript
getNextPageParam: (lastPage, allPages) => {
  const currentPage = allPages.length           // ğŸ“Š í˜„ì¬ê¹Œì§€ ë¡œë“œëœ í˜ì´ì§€ ìˆ˜
  const totalPages = Math.ceil(                 // ğŸ“ˆ ì „ì²´ í˜ì´ì§€ ìˆ˜ ê³„ì‚°
    lastPage.totalCount / pageSize
  )
  
  // ğŸ¯ ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆìœ¼ë©´ í˜ì´ì§€ ë²ˆí˜¸, ì—†ìœ¼ë©´ undefined
  return currentPage < totalPages ? currentPage + 1 : undefined
}
```

#### 4ï¸âƒ£ ìë™ ìƒˆë¡œê³ ì¹¨ ì˜µì…˜

```typescript
refetchInterval: autoRefresh ? refreshInterval : false,          // ğŸ”„ ì£¼ê¸°ì  ìƒˆë¡œê³ ì¹¨
refetchIntervalInBackground: false,                              // ğŸš« ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨ ê¸ˆì§€
refetchOnWindowFocus: true,                                      // ğŸ‘€ í¬ì»¤ìŠ¤ ì‹œ ìƒˆë¡œê³ ì¹¨
```

|ì˜µì…˜|ì„¤ëª…|ë™ì‘|
|---|---|---|
|`refetchInterval`|ìë™ ìƒˆë¡œê³ ì¹¨ ì£¼ê¸°|ì§€ì •ëœ ì‹œê°„ë§ˆë‹¤ ë°ì´í„° ì—…ë°ì´íŠ¸|
|`refetchIntervalInBackground`|ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨|`false`: íƒ­ ë¹„í™œì„± ì‹œ ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨|
|`refetchOnWindowFocus`|í¬ì»¤ìŠ¤ ìƒˆë¡œê³ ì¹¨|`true`: ë¸Œë¼ìš°ì € ì°½ í´ë¦­ ì‹œ ìƒˆë¡œê³ ì¹¨|

---

## ğŸ“¤ ë°˜í™˜ê°’

### ğŸ“‹ ë°ì´í„° ê´€ë ¨

- **`data`**: ëª¨ë“  í˜ì´ì§€ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ í•©ì¹œ ê²°ê³¼
- **`flattenedData`**: ì¤‘ì²©ëœ í˜ì´ì§€ êµ¬ì¡°ë¥¼ í‰í‰í•˜ê²Œ ë³€í™˜í•œ ìµœì¢… ë°ì´í„°

### â–¶ï¸ í˜ì´ì§€ë„¤ì´ì…˜ ê´€ë ¨

- **`fetchNextPage()`**: ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„° ìš”ì²­ í•¨ìˆ˜
- **`hasNextPage`**: ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (boolean)
- **`isFetchingNextPage`**: ë‹¤ìŒ í˜ì´ì§€ ë¡œë”© ì¤‘ ì—¬ë¶€ (boolean)

### ğŸ”„ ìƒíƒœ ê´€ë¦¬

- **`isLoading`**: ì²« ë²ˆì§¸ í˜ì´ì§€ ë¡œë”© ì¤‘ ì—¬ë¶€
- **`isError`**: ì—ëŸ¬ ë°œìƒ ì—¬ë¶€
- **`error`**: ì—ëŸ¬ ê°ì²´ (ìƒì„¸ ì •ë³´ í¬í•¨)
- **`refetch()`**: ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜

---

## ğŸ’» ì‹¤ì œ ì‚¬ìš©ë²•

### ğŸ¯ ì™„ì „í•œ êµ¬í˜„ ì˜ˆì‹œ

```typescript
import {useCallback, useEffect, useRef} from 'react'
import type {SignalTypeRequestEnum} from "@/pages/signal/types"
import {useInfiniteSignals} from "@/pages/signal/hooks/use-infinite-signals.ts";
import NewSignalCard from "@/pages/signal/_components/new/new-signal-card.tsx";

interface SignalListProps {
  signalType: SignalTypeRequestEnum    // ğŸ“Š ì‹ í˜¸ íƒ€ì…
  expandedCards: number[]              // ğŸ“‚ í™•ì¥ëœ ì¹´ë“œ ID ëª©ë¡
  onToggleChart: (id: number) => void  // ğŸ“ˆ ì°¨íŠ¸ í† ê¸€ í•¨ìˆ˜
  isActive: boolean                    // ğŸ”˜ ì»´í¬ë„ŒíŠ¸ í™œì„± ìƒíƒœ
}

export default function NewSignalList({
  signalType,
  expandedCards,
  onToggleChart,
  isActive
}: SignalListProps) {
  const loadMoreRef = useRef<HTMLDivElement>(null)

  // ğŸš€ useInfiniteSignals í›… ì‚¬ìš©
  const {
    data: signals,        // ğŸ“‹ ëª¨ë“  ì‹ í˜¸ ë°ì´í„°
    fetchNextPage,        // â–¶ï¸ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ
    hasNextPage,          // â“ ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
    isFetchingNextPage,   // â³ ë‹¤ìŒ í˜ì´ì§€ ë¡œë”© ì¤‘
    isLoading,            // ğŸ”„ ì²« ë¡œë”© ì¤‘
    isError,              // âŒ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€
    error                 // ğŸš¨ ì—ëŸ¬ ê°ì²´
  } = useInfiniteSignals({
    type: signalType,     // ğŸ“Š ë¶€ëª¨ì—ì„œ ë°›ì€ ì‹ í˜¸ íƒ€ì…
    pageSize: 10,         // ğŸ“„ í•œ í˜ì´ì§€ë‹¹ 10ê°œ
    enabled: isActive,    // ğŸ”˜ í™œì„± ìƒíƒœì¼ ë•Œë§Œ ë°ì´í„° ìš”ì²­
    autoRefresh: true     // ğŸ”„ 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
  })

  // ğŸ¯ ìë™ ë¬´í•œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ Intersection Observer
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting &&    // ğŸ‘€ í™”ë©´ì— ë³´ì„
            hasNextPage &&                  // âœ… ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬
            !isFetchingNextPage) {          // ğŸš« ë¡œë”© ì¤‘ ì•„ë‹˜
          fetchNextPage()                   // â–¶ï¸ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ
        }
      },
      { threshold: 0.1 }  // ğŸ“ 10%ë§Œ ë³´ì—¬ë„ íŠ¸ë¦¬ê±°
    )

    if (loadMoreRef.current) {
      observer.observe(loadMoreRef.current)
    }

    return () => observer.disconnect()
  }, [hasNextPage, isFetchingNextPage, fetchNextPage])

  // ğŸ–±ï¸ ìˆ˜ë™ "ë” ë³´ê¸°" ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const handleLoadMore = useCallback(() => {
    if (hasNextPage && !isFetchingNextPage) {
      fetchNextPage()
    }
  }, [hasNextPage, isFetchingNextPage, fetchNextPage])

  // ğŸ”„ ì²« ë¡œë”© ìƒíƒœ
  if (isLoading) {
    return (
      <div className="flex justify-center items-center p-8">
        <div className="text-gray-500">ğŸ“¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    )
  }

  // âŒ ì—ëŸ¬ ìƒíƒœ
  if (isError) {
    return (
      <div className="flex justify-center items-center p-8">
        <div className="text-red-500">
          ğŸš¨ ì˜¤ë¥˜ ë°œìƒ: {error?.message}
        </div>
      </div>
    )
  }

  // ğŸ“­ ë¹ˆ ë°ì´í„° ìƒíƒœ
  if (!signals || signals.length === 0) {
    return (
      <div className="flex justify-center items-center p-8">
        <div className="text-gray-500">ğŸ“‹ í‘œì‹œí•  ì‹œê·¸ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    )
  }

  return (
    <div className="space-y-3">
      {/* ğŸ“‹ ì‹ í˜¸ ì¹´ë“œ ëª©ë¡ ë Œë”ë§ */}
      {signals.map((signal) => (
        <NewSignalCard
          key={signal.id}
          signal={signal}
          isExpanded={expandedCards.includes(signal.id)}
          onToggleChart={() => onToggleChart(signal.id)}
        />
      ))}

      {/* ğŸ¯ ìë™ ìŠ¤í¬ë¡¤ íŠ¸ë¦¬ê±° + ìˆ˜ë™ ë²„íŠ¼ */}
      {hasNextPage && (
        <div ref={loadMoreRef} className="flex justify-center mt-4">
          <button
            onClick={handleLoadMore}
            disabled={isFetchingNextPage}
            className="px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            {isFetchingNextPage ? 'â³ ë¡œë”© ì¤‘...' : 'ğŸ“„ ë” ë³´ê¸°'}
          </button>
        </div>
      )}

      {/* â³ ì¶”ê°€ ë¡œë”© ì¸ë””ì¼€ì´í„° */}
      {isFetchingNextPage && (
        <div className="flex justify-center py-4">
          <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
        </div>
      )}
    </div>
  )
}
```

### ğŸ›ï¸ ë‹¤ì–‘í•œ ì‚¬ìš© ë°©ë²•

#### 1ï¸âƒ£ ìë™ ìƒˆë¡œê³ ì¹¨ ë¹„í™œì„±í™”

```typescript
const { data } = useInfiniteSignals({
  type: 'ALL',
  autoRefresh: false  // ğŸš« ìë™ ìƒˆë¡œê³ ì¹¨ ë„ê¸°
})
```

#### 2ï¸âƒ£ ìƒˆë¡œê³ ì¹¨ ì£¼ê¸° ë³€ê²½

```typescript
const { data } = useInfiniteSignals({
  type: 'BUY',
  refreshInterval: 2 * 60 * 1000  // â° 2ë¶„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨
})
```

#### 3ï¸âƒ£ ì¡°ê±´ë¶€ ì¿¼ë¦¬ ì‹¤í–‰

```typescript
const [shouldFetch, setShouldFetch] = useState(false)

const { data } = useInfiniteSignals({
  type: 'SELL',
  enabled: shouldFetch  // ğŸ”˜ ì¡°ê±´ë¶€ ì‹¤í–‰
})
```

#### 4ï¸âƒ£ í° í˜ì´ì§€ ì‚¬ì´ì¦ˆ

```typescript
const { data } = useInfiniteSignals({
  type: 'ALL',
  pageSize: 50  // ğŸ“„ í•œ ë²ˆì— 50ê°œì”© ë¡œë“œ
})
```

---

## ğŸ”§ ë™ì‘ ì›ë¦¬

### ğŸ“– 1ë‹¨ê³„: ì²« ë²ˆì§¸ í˜ì´ì§€ ë¡œë“œ

```
ğŸ‘¤ ì‚¬ìš©ìê°€ ì»´í¬ë„ŒíŠ¸ ì ‘ê·¼
    â†“
ğŸš€ useInfiniteQuery ì‹¤í–‰
    â†“
ğŸ“¡ pageParam=1ë¡œ ì²« ë²ˆì§¸ API í˜¸ì¶œ
    â†“
ğŸ“‹ ë°ì´í„° ë°˜í™˜ ë° í™”ë©´ í‘œì‹œ
```

### â–¶ï¸ 2ë‹¨ê³„: ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ

```
ğŸ‘† ì‚¬ìš©ìê°€ "ë” ë³´ê¸°" í´ë¦­ ë˜ëŠ” ìŠ¤í¬ë¡¤
    â†“
ğŸ¯ fetchNextPage() ì‹¤í–‰
    â†“
ğŸ§® getNextPageParamìœ¼ë¡œ ë‹¤ìŒ í˜ì´ì§€ ë²ˆí˜¸ ê³„ì‚°
    â†“
ğŸ“¡ ìƒˆë¡œìš´ pageParamìœ¼ë¡œ API í˜¸ì¶œ
    â†“
ğŸ“‹ ê¸°ì¡´ ë°ì´í„°ì— ìƒˆ ë°ì´í„° ì¶”ê°€
```

### ğŸ”„ 3ë‹¨ê³„: ìë™ ìƒˆë¡œê³ ì¹¨

```
â° 5ë¶„ ê²½ê³¼
    â†“
ğŸ”„ refetchInterval íŠ¸ë¦¬ê±°
    â†“
ğŸ“¡ ì²« ë²ˆì§¸ í˜ì´ì§€ë¶€í„° ë‹¤ì‹œ ë¡œë“œ
    â†“
ğŸ”„ ê¸°ì¡´ ë°ì´í„° ì™„ì „ êµì²´
```

### ğŸ—ï¸ 4ë‹¨ê³„: ë°ì´í„° êµ¬ì¡° ë³€í™˜

```typescript
// ğŸ“Š APIì—ì„œ ë°›ì€ ì›ë³¸ ë°ì´í„° (í˜ì´ì§€ë³„ ë¶„ë¦¬)
data = {
  pages: [
    { items: [ì‹ í˜¸1, ì‹ í˜¸2, ì‹ í˜¸3] },  // ğŸ“„ 1í˜ì´ì§€
    { items: [ì‹ í˜¸4, ì‹ í˜¸5, ì‹ í˜¸6] },  // ğŸ“„ 2í˜ì´ì§€
  ]
}

// ğŸ¯ flatMapìœ¼ë¡œ ë³€í™˜ëœ ìµœì¢… ë°ì´í„°
flattenedData = [ì‹ í˜¸1, ì‹ í˜¸2, ì‹ í˜¸3, ì‹ í˜¸4, ì‹ í˜¸5, ì‹ í˜¸6]
```

### ğŸ‘€ 5ë‹¨ê³„: Intersection Observer ë™ì‘

```
ğŸ“± ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ë‹¤ìš´
    â†“
ğŸ¯ loadMoreRef ìš”ì†Œê°€ í™”ë©´ì— 10% ë…¸ì¶œ
    â†“
ğŸ“¡ isIntersecting = true
    â†“
âœ… hasNextPage && !isFetchingNextPage ì¡°ê±´ í™•ì¸
    â†“
â–¶ï¸ fetchNextPage() ìë™ ì‹¤í–‰
```

---

## ğŸ¯ ê¸°íƒ€: ì¤‘ë³µì œê±°

### ìë™ ìƒˆë¡œê³ ì¹¨ ë°œìƒ ì‹œ ë¬¸ì œ

- ì•„ë˜ ì½”ë“œì—ì„œ ìƒˆë¡œ ë‹¤ìŒ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ì„œ key ì—ëŸ¬ê°€ ìƒê¹ë‹ˆë‹¤. ì´ëŸ´ ë•ŒëŠ” ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ê¹Œìš”?
```tsx
import {useInfiniteQuery} from '@tanstack/react-query'
import type {SignalListResponse, SignalTypeRequestEnum} from '@/pages/signal/types'
import type {PagingResult} from '@/lib/types'
import {signalService} from "@/service/signal-service.ts";

interface UseInfiniteSignalsOptions {
  type?: SignalTypeRequestEnum
  pageSize?: number
  enabled?: boolean                // ì¿¼ë¦¬ í™œì„±í™” ì—¬ë¶€
  autoRefresh?: boolean            // ìë™ ìƒˆë¡œê³ ì¹¨ ì‚¬ìš©í• ì§€ ì—¬ë¶€
  refreshInterval?: number         // ìƒˆë¡œê³ ì¹¨ ì£¼ê¸° (ë°€ë¦¬ì´ˆ)
}

interface UseInfiniteSignalsResult {
  data: SignalListResponse[] | undefined
  fetchNextPage: () => void
  hasNextPage: boolean
  isFetchingNextPage: boolean
  isLoading: boolean
  isError: boolean
  error: Error | null
  refetch: () => void
}

export const useInfiniteSignals = ({
                                     type = 'ALL',
                                     pageSize = 10,
                                     enabled = true,
                                     autoRefresh = true, // ê¸°ë³¸ê°’: ìë™ ìƒˆë¡œê³ ì¹¨ í™œì„±í™”
                                     refreshInterval = 5 * 60 * 1000 // ê¸°ë³¸ê°’: 5ë¶„ (300,000ms)
                                   }: UseInfiniteSignalsOptions = {}): UseInfiniteSignalsResult => {
  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    isLoading,
    isError,
    error,
    refetch
  } = useInfiniteQuery({
    queryKey: ['useInfiniteSignals', type, pageSize], // ìºì‹± ë° ë°ì´í„° ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•œ ê³ ìœ  í‚¤
    queryFn: async ({ pageParam = 1 }) => {
      return await signalService.getSignals({
        type,
        nowPage: pageParam,
        pageSize
      })
    },
    getNextPageParam: (lastPage: PagingResult<SignalListResponse>, allPages) => {
      console.log('lastPage ', lastPage)
      console.log('allPages ', allPages)

      // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ ê³„ì‚°
      const currentPage = allPages.length

      // ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
      const totalPages = Math.ceil(lastPage.totalCount / pageSize)

      // í˜„ì¬ í˜ì´ì§€ê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ë³´ë‹¤ ì‘ìœ¼ë©´ ë‹¤ìŒ í˜ì´ì§€ ë²ˆí˜¸ ë°˜í™˜
      return currentPage < totalPages ? currentPage + 1 : undefined
    },
    initialPageParam: 1,
    enabled,
    refetchInterval: autoRefresh ? refreshInterval : false, // autoRefreshê°€ trueë©´ refreshIntervalë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨.
    refetchIntervalInBackground: false, // falseë©´ íƒ­ì´ ë°±ê·¸ë¼ìš´ë“œì¼ ë•ŒëŠ” ìƒˆë¡œê³ ì¹¨ ì•ˆí•¨.
    refetchOnWindowFocus: true, // ë¸Œë¼ìš°ì € ì°½ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ìë™ ìƒˆë¡œê³ ì¹¨.
  })

  // ëª¨ë“  í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í‰í‰í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë°˜í™˜
  const flattenedData = data?.pages.flatMap(page => page.items) || []

  return {
    data: flattenedData,
    fetchNextPage,
    hasNextPage: hasNextPage,
    isFetchingNextPage,
    isLoading,
    isError,
    error,
    refetch
  }
}
```

```plaintext
Encountered two children with the same key, `2105`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted â€” the behavior is unsupported and could change in a future version.
```

### í•´ê²°

- ìœ„ ì½”ë“œì—ì„œëŠ” ìë™ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥ì´ ë¬´í•œ ìŠ¤í¬ë¡¤ê³¼ ì¶©ëŒí•˜ì—¬ ë°ì´í„° ì¤‘ë³µì„ ì¼ìœ¼í‚¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.
- ìë™ ìƒˆë¡œê³ ì¹¨ì´ ë°œìƒí•˜ë©´ ì•„ë˜ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
	1. **ê¸°ì¡´ ìºì‹œëœ ë°ì´í„°ê°€ ìƒˆ ë°ì´í„°ë¡œ êµì²´ë¨**
	2. **í•˜ì§€ë§Œ êµì²´ ê³¼ì •ì—ì„œ ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë³µì´ ë°œìƒí•  ìˆ˜ ìˆìŒ**

- ì¦‰ ì•„ë§ˆ, ì•„ë˜ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë°œìƒí•œ ê²ƒìœ¼ë¡œ ë³´ì•„ì•¼ í•©ë‹ˆë‹¤.
	- ê¸°ì¡´ í˜ì´ì§€ 1, 2ê°€ ë¡œë“œëœ ìƒíƒœ
	- ìë™ ìƒˆë¡œê³ ì¹¨ì´ ë°œìƒí•˜ì—¬ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
	- ìƒˆ ë°ì´í„°ì™€ ê¸°ì¡´ ë°ì´í„°ê°€ í•©ì³ì§€ë©´ì„œ **ê°™ì€ IDë¥¼ ê°€ì§„ í•­ëª©ë“¤ì´ ì¤‘ë³µ**ë¨
	- ReactëŠ” ê°™ì€ key(`2105`)ë¥¼ ê°€ì§„ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°œê²¬í•˜ê³  ì—ëŸ¬ ë°œìƒ

- ì´ ë•Œ, ì¤‘ì ì ìœ¼ë¡œ ë´ì•¼í•  ë¶€ë¶„ì€ "ë°ì´í„°ê°€ ë’¤ì— ë¶™ëŠ”ë‹¤"ê°€ ì•„ë‹ˆë¼, "**í˜ì´ì§€ ê²½ê³„ì—ì„œ ë°ì´í„°ê°€ ì´ë™í•˜ê±°ë‚˜ ìë™ ìƒˆë¡œê³ ì¹¨ê³¼ ë¬´í•œ ìŠ¤í¬ë¡¤ì˜ ë™ì‹œ ì‹¤í–‰ìœ¼ë¡œ ì¸í•œ ì¼ì‹œì  ì¤‘ë³µ**"ì´ ë¬¸ì œê°€ ëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
	- ë”°ë¼ì„œ ì•„ë˜ì˜ ì¤‘ë³µì œê±° ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.
```ts
// ëª¨ë“  í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í‰í‰í•˜ê²Œ ë§Œë“¤ì–´ì„œ ë°˜í™˜  
// ì´ ë•Œ, ìë™ ìƒˆë¡œê³ ì¹¨ê³¼ ë¬´í•œ ìŠ¤í¬ë¡¤ì´ ë™ì‹œì— ì‘ë™í•˜ê¸° ì• ë¬¸ì— ìƒˆ ë°ì´í„°ì™€ ê¸°ì¡´ ë°ì´í„°ê°€ ì¼ì‹œì  ì¤‘ë³µì´ ë°œìƒí•  ìˆ˜ ìˆìŒ (ê°™ì€ idë¥¼ ê°€ì§„ ìš”ì†Œ ì¤‘ë³µ)  
// ë”°ë¼ì„œ, ê°™ì€ IDë¥¼ ê°€ì§„ í•­ëª© ì¤‘ ì²« ë²ˆì§¸ë§Œ ìœ ì§€í•˜ë„ë¡ í•¨  
const flattenedData = useMemo(() => {  
  if (!data?.pages) return []  
  
  const allItems = data.pages.flatMap(page => page.items)  
  
  // ID ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µ ì œê±°: ê°™ì€ IDë¥¼ ê°€ì§„ í•­ëª© ì¤‘ ì²« ë²ˆì§¸ë§Œ ìœ ì§€  
  // self: ì „ì²´ ë°°ì—´ (allItemsì™€ ë™ì¼)  
  return allItems.filter((item, index, self) =>  
    index === self.findIndex(t => t.id === item.id)  
  )  
}, [data?.pages])
```

### ì˜ˆì‹œ
```ts
const allItems = [
  { id: 1, name: 'A' },
  { id: 2, name: 'B' }, 
  { id: 1, name: 'Aì¤‘ë³µ' },  // id: 1ì´ ì¤‘ë³µ!
  { id: 3, name: 'C' },
  { id: 2, name: 'Bì¤‘ë³µ' }   // id: 2ê°€ ì¤‘ë³µ!
]

// ì¤‘ë³µ ì œê±° ê³¼ì •
allItems.filter((item, index, self) => {
  console.log(`í˜„ì¬ ì•„ì´í…œ: ${item.name}, ì¸ë±ìŠ¤: ${index}`)
  
  const firstIndex = self.findIndex(t => t.id === item.id)
  console.log(`ID ${item.id}ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: ${firstIndex}`)
  console.log(`í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? ${index === firstIndex}`)
  
  return index === firstIndex
})
```

```
í˜„ì¬ ì•„ì´í…œ: A, ì¸ë±ìŠ¤: 0
ID 1ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: 0
í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? true âœ… (ìœ ì§€)

í˜„ì¬ ì•„ì´í…œ: B, ì¸ë±ìŠ¤: 1  
ID 2ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: 1
í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? true âœ… (ìœ ì§€)

í˜„ì¬ ì•„ì´í…œ: Aì¤‘ë³µ, ì¸ë±ìŠ¤: 2
ID 1ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: 0
í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? false âŒ (ì œê±°)

í˜„ì¬ ì•„ì´í…œ: C, ì¸ë±ìŠ¤: 3
ID 3ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: 3  
í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? true âœ… (ìœ ì§€)

í˜„ì¬ ì•„ì´í…œ: Bì¤‘ë³µ, ì¸ë±ìŠ¤: 4
ID 2ì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜: 1
í˜„ì¬ ìœ„ì¹˜ === ì²« ë²ˆì§¸ ìœ„ì¹˜? false âŒ (ì œê±°)
```
