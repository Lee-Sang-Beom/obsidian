
#### 엑셀 다운로드

- 엑셀 다운로드는 React처럼 특정 DOM요소에 연결하여 작업하지 않는 것으로 보인다.
- `AjaxPopupManager`를 이용하며, 아래의 내용을 인자로 전달해야 한다.
	- `PopupUrl.EXPORT_DOWNLOAD_PROGRES`: 고유 리소스 자원을 연결
	- `object` :  엑셀 다운로드를 위한 부가객체
		- `ApiUrl` : `project.js`에 정리해놓은 엑셀다운로드 전용 API
		- `requestMap` : 엑셀 다운로드 전용 API에서 요구하는 parameter
```javascript
(function () {
  return {
    // html, css 파일 로드 미수행
    htmlLoading: false,
    cssLoading: false,

    onConstruct: function (jLayout, path, object, jPopupListLayout) {
      var popup = this;

      // 팝업 기본 레이아웃 및 title 영역 추가
      PopupHelper.appendLayout(popup, {
        title: "전임교원 참여현황 상세",
        css: { width: "1500px" },
      });
    },

    onInit: function (jLayout, path, object, jPopupListLayout) {
      var page = this;
      var popup = this;

      // object는 아래예시처럼, 리소스 파일 호출위치에서 전달한 item
      //   currentDetailTable.appendRow({
      //     css: {'cursor' : 'pointer'},
      //     item: item,
      //     onClick: function (e) {
      //         AjaxPopupManager.show(ProjectPopupUrl.ASSOCIATE_PROFESSOR_DETAIL_POPUP,{
      //             item : e.data.item});
      //     }
      // });
      page.item = Lia.p(object, "item");
      var id = Lia.p(object, "item", "id");

      var jContent = popup.find(".popup_content");

      var section = new Triton.Section({
        appendTo: jContent,
      });

      var panel = new Triton.Panel({
        appendTo: section,
        css: { "max-height": "400px", overflow: "auto" },
      });

      var listTable = new Triton.ListTable({
        appendTo: panel,
      });

      // 단순 리스트만 출력하는 테이블의 row를 선언하고, column 추가
      listTable.appendHeaderRow({});
      listTable.appendHeaderColumn({ content: "연번", css: { width: "60px" } });
      listTable.appendHeaderColumn({
        content: "사업유형",
        css: { width: "130px" },
      });
      listTable.appendHeaderColumn({ content: "권역", css: { width: "70px" } });
      listTable.appendHeaderColumn({
        content: "대학",
        css: { width: "100px" },
      });
      listTable.appendHeaderColumn({
        content: "전입교원 성명",
        css: { width: "100px" },
      });
      listTable.appendHeaderColumn({
        content: "단과 대학(학부)",
        css: { width: "130px" },
      });
      listTable.appendHeaderColumn({
        content: "학과(부,전공)",
        css: { width: "150px" },
      });
      listTable.appendHeaderColumn({
        content: "세부연번",
        css: { width: "80px" },
      });
      listTable.appendHeaderColumn({
        content: "참여구분",
        css: { width: "100px" },
      });
      listTable.appendHeaderColumn({ content: "참여 실적 내역" });
      listTable.appendHeaderColumn({
        content: "실적환산",
        css: { width: "65px" },
      });

      // 로딩팝업 on
      LoadingPopupManager.show();

      // 특정 id 에 대한 데이터를 요청하는 api로 추정
      // parameterMap: {id: id}
      Requester.awb(
        ProjectApiUrl.Project.GET_TEACHER_PARTICIPATION_STATUS_SUMMARY,
        { id: id },
        function (status, data, request) {
          // 로딩팝업 off
          LoadingPopupManager.hide();

          if (status != Requester.Status.SUCCESS) {
            return;
          }

          var list = Lia.p(data, "body", "list");

          if (Array.isNotEmpty(list)) {
            for (var i = 0, l = list.length; i < l; i++) {
              var item = list[i];
              var subjectGubunName = Lia.pcd("-", item, "subject_gubun_name");
              var subjectGubunNameCount = 1;

              if (subjectGubunName != null) {
                subjectGubunNameCount = subjectGubunName.split("/").length;
              }

              for (var idx = 0; idx < subjectGubunNameCount; idx++) {
                listTable.appendRow({});
                listTable.appendColumn({ content: i + 1 });
                listTable.appendColumn({ content: "수요맟춤성장형" });
                listTable.appendColumn({ content: "동남권" });
                listTable.appendColumn({ content: "경남대학교" });
                listTable.appendColumn({
                  content: Lia.pcd("-", page.item, "name"),
                });
                listTable.appendColumn({
                  content: Lia.pcd("-", page.item, "college"),
                });
                listTable.appendColumn({
                  content: Lia.pcd("-", page.item, "department"),
                });
                listTable.appendColumn({
                  content:
                    Lia.pcd("-", page.item, "row_number") + "-" + (i + 1),
                });
                listTable.appendColumn({
                  content: Lia.pcd("-", item, "gubun_name"),
                });
                var content = "-";
                switch (Lia.pcd("-", item, "type")) {
                  case 1:
                    content =
                      "[" +
                      Lia.pcd("-", item, "gubun_name") +
                      "] " +
                      Lia.pcd("-", item, "subject_gubun_name") +
                      "(" +
                      Lia.pcd("-", item, "subject_nm") +
                      ", " +
                      Lia.pcd("-", item, "year") +
                      "-" +
                      Lia.pcd("-", item, "term") +
                      ", " +
                      Lia.pcd("-", item, "subject_credit") +
                      ")";
                    if (Lia.p(item, "team_teaching") != 0) {
                      content +=
                        "/ 팀티칭(" + Lia.pcd(1, item, "team_teaching") + ")";
                    }
                    break;

                  case 2:
                    var educationDate = "-";
                    var educationTimeFirst = String.isNotBlank(
                      Lia.pcd("", item, "education_time_first")
                    )
                      ? JSON.parse(Lia.pcd("", item, "education_time_first"))
                      : "";
                    var educationTimeSecond = String.isNotBlank(
                      Lia.pcd("", item, "education_time_second")
                    )
                      ? JSON.parse(Lia.pcd("", item, "education_time_second"))
                      : "";
                    var educationTimeThird = String.isNotBlank(
                      Lia.pcd("", item, "education_time_third")
                    )
                      ? JSON.parse(Lia.pcd("", item, "education_time_third"))
                      : "";
                    if (Array.isNotEmpty(educationTimeFirst)) {
                      educationDate = DateHelper.dateStringToYY_MM_DD(
                        Lia.p(educationTimeFirst, "startTime")
                      );
                    }
                    if (Array.isNotEmpty(educationTimeSecond)) {
                      educationDate =
                        educationDate +
                        ", " +
                        DateHelper.dateStringToYY_MM_DD(
                          Lia.p(educationTimeSecond, "startTime")
                        );
                    }
                    if (Array.isNotEmpty(educationTimeThird)) {
                      educationDate =
                        educationDate +
                        ", " +
                        DateHelper.dateStringToYY_MM_DD(
                          Lia.p(educationTimeThird, "startTime")
                        );
                    }
                    content =
                      "[" +
                      Lia.pcd("-", item, "gubun_name") +
                      "] " +
                      Lia.pcd("-", item, "education_name") +
                      "(" +
                      Lia.pcd("-", item, "education_type") +
                      ", 교육일자:" +
                      educationDate +
                      ", " +
                      Lia.pcd("-", item, "teaching_time") +
                      "교육, " +
                      Lia.pcd("-", item, "number_of_completed_students") +
                      "명 수강, " +
                      Lia.pcd("-", item, "company_name") +
                      ")";
                    break;

                  case 3:
                    var startDate = Lia.pcd("", item, "start_date");
                    var endDate = Lia.pcd("", item, "end_date");
                    if (String.isNotBlank(startDate)) {
                      startDate = DateHelper.dateStringToYY_MM_DD(startDate);
                    }
                    if (String.isNotBlank(endDate)) {
                      endDate = DateHelper.dateStringToYY_MM_DD(endDate);
                    }
                    content =
                      "[" +
                      Lia.pcd("-", item, "gubun_name") +
                      "] " +
                      Lia.pcd("-", item, "project_name") +
                      "(연구기간: " +
                      startDate +
                      " ~ " +
                      endDate +
                      ")";
                    break;

                  case 4:
                    content =
                      "[" +
                      Lia.pcd("-", item, "gubun_name") +
                      "] (" +
                      Lia.pcd("-", item, "subject_nm") +
                      ", " +
                      Lia.pcd("-", item, "year") +
                      "-학기, 학점, " +
                      Lia.pcd("-", item, "company") +
                      ")";
                    break;
                }
                listTable.appendColumn({ content: content });
                listTable.appendColumn({
                  content: Lia.pcd("-", item, "credit").toFixed(2),
                });
              }
            }

            // 테이블 아래에 엑셀 다운로드가 위치할 section을 만듦
            var categorySection = (page.categorySection = new Triton.Section({
              theme: Triton.Section.Theme.Category,
              appendTo: panel,
              css: { "margin-top": "10px", "margin-bottom": "10px" },
            }));

            new Triton.FlatButton({
              appendTo: categorySection,
              content: "엑셀 다운로드",
              theme: Triton.FlatButton.Theme.Normal,
              css: {
                "border-radius": "10px",
                float: "right",
                "margin-right": "5px",
              },
              page: page,
              onClick: function (e) {
                // page.item은 팝업 리소스로 받은 object (전달 파일에서는 item으로 보냄)로,
                // e.data.page.item은 특정 유저에 대한 상세한 내용임
                var page = e.data.page;

                // PopupUrl.EXPORT_DOWNLOAD_PROGRESS는 읽기전용파일로, 액셀 다운로드 시 발생하는 팝업 템플릿 파일이다.
                AjaxPopupManager.show(PopupUrl.EXPORT_DOWNLOAD_PROGRESS, {
                  // 엑셀 다운로드를 위한 전용 API
                  url: ProjectApiUrl.Excel
                    .GET_TEACHER_PARTICIPATION_STATUS_SUMMARY_EXCEL_DOWNLOAD,

                  // 엑셀 다운로드를 위한 전용 API에서 요구하는 requestMap
                  requestMap: {
                    id: id,
                    name: Lia.pcd("-", page.item, "name"),
                    college: Lia.pcd("-", page.item, "college"),
                    department: Lia.pcd("-", page.item, "department"),
                    rowNumber: Lia.pcd("-", page.item, "row_number"),
                    gubunName: Lia.pcd("-", page.item, "gubun_name"),
                  },
                });
              },
            });
          } else {
            new Triton.Section({
              appendTo: panel,
              theme: Triton.Section.Theme.ListMessage,
              content: "표시할 목록이 없습니다.",
            });
            return;
          }
        }
      );

      // 팝업 UI조정
      popup.adjustPopup();
    },

    onShow: function (jLayout, path, parameterMap, jPopupListLayout) {
      var popup = this;
    },
    onHide: function (jLayout, path, parameterMap, jPopupListLayout) {},
  };
})();

```


#### 엑셀 업로드
- 엑셀 업로드는 ...

```javascript
```