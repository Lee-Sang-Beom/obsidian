https://www.daleseo.com/http-cookies/

#### 내일와서 할것(2/9)
 - 지도 시큐리티 및 정확도 추가
 - 리포트 오류 추가
 - 사고대응정보 화학물질란 수정


#### 오류
- 확산 미선택 시, 증기밀도 유효성을 검사하는 오류


#### 임시저장

- 리포트
```tsx
"use client";
import { DmgeEfctDetailResponse } from "@/types/sub/Ca/CrisisMessage";
import styles from "./Report.module.scss";
import Table, { TableHeader } from "@/components/common/Table/Table";
import React, { useEffect, useMemo, useRef, useState } from "react";
import {
  DmgeEfctEvlResponse,
  DmgeEfctStdResponse,
} from "@/types/sub/Ca/Simulation/Simulation";
import moment from "moment";
import Chip from "@/components/common/Chip/Chip";
import Image from "next/image";
import { Button } from "@/components/common/Button/Button";
import { useRouter } from "next/navigation";
import exceljs from "exceljs";
import html2canvas from "html2canvas";
import { position } from "html2canvas/dist/types/css/property-descriptors/position";
import { FileDto } from "@/types/common/commonType";

interface IProps {
  id: string;
  data: DmgeEfctDetailResponse;
}

export default function ReportClient({ id, data }: IProps) {
  const router = useRouter();
  const [isMounted, setIsMounted] = useState<boolean>(false);

  const expImgRef = useRef<HTMLImageElement>(null);
  const fireImgRef = useRef<HTMLImageElement>(null);
  const dfsnImgRef = useRef<HTMLImageElement>(null);

  const [fireImg, setFireImg] = useState<FileDto | null>(null);
  const [explImg, setExplImg] = useState<FileDto | null>(null);
  const [dfsnImg, setDfsnImg] = useState<FileDto | null>(null);
  let position = [
    {
      tl: { col: 1, row: 2 }, // top, left
      br: { col: 4, row: 9 }, // bottom, right
    },
    {
      tl: { col: 5, row: 2 },
      br: { col: 8, row: 9 },
    },
    {
      tl: { col: 9, row: 2 },
      br: { col: 12, row: 9 },
    },
  ];
  // STEP1
  const step1InputListHeader: TableHeader[] = useMemo(() => {
    return [
      {
        name: "사업장명",
        value: "companyNm",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.companyNm || ""}</p>;
        },
        width: "30%",
      },
      {
        name: "사업자등록번호",
        value: "companyBizNo",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return (
            <p>
              {tr.companyBizNo
                ? tr.companyBizNo.replace(/(\d{3})(\d{2})(\d{5})/, "$1-$2-$3")
                : ""}
            </p>
          );
        },
      },
      {
        name: "업종",
        value: "companyTpbizNm",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.companyTpbizNm ? tr.companyTpbizNm : ""}</p>;
        },
      },
      {
        name: "대표자",
        value: "companyRprsvNm",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.companyRprsvNm ? tr.companyRprsvNm : ""}</p>;
        },
      },
      {
        name: "주소",
        value: "companyRoadNmAddr",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.companyRoadNmAddr ? tr.companyRoadNmAddr : ""}</p>;
        },
      },
      {
        name: "연락처",
        value: "companyTelNo",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return (
            <p>
              {tr.companyTelNo
                ? tr.companyTelNo.replace(
                    /(\d{2,3})(\d{3,4})(\d{4})/,
                    "$1-$2-$3"
                  )
                : ""}
            </p>
          );
        },
      },
      {
        name: "면적",
        value: "companyLdar",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return (
            <p>
              {tr.companyLdar !== null && tr.companyLdar !== undefined
                ? `${tr.companyLdar}㎡`
                : ""}
            </p>
          );
        },
      },
    ];
  }, [data]);

  // STEP2
  const step2InputListHeader: TableHeader[] = useMemo(() => {
    return [
      {
        name: "화학물질명(국문)",
        value: "mttrnmkor",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.mttrnmkor || ""}</p>;
        },
        width: "30%",
      },
      {
        name: "화학물질명(영문)",
        value: "mttrnmeng",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.mttrnmeng ? tr.mttrnmeng : ""}</p>;
        },
      },
      {
        name: "CAS 번호",
        value: "casNo",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.casNo ? tr.casNo : ""}</p>;
        },
      },
      {
        name: "성상",
        value: "i0202",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i0202 ? tr.i0202 : ""}</p>;
        },
      },
      {
        name: "색상",
        value: "i0204",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i0204 ? tr.i0204 : ""}</p>;
        },
      },
      {
        name: "냄새",
        value: "i04",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i04 ? tr.i04 : ""}</p>;
        },
      },
      {
        name: "인화점",
        value: "i14",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i14 ? tr.i14 : ""}</p>;
        },
      },
      {
        name: "밀도(kg/m3)",
        value: "i26",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i26 ? tr.i26 : ""}</p>;
        },
      },
      {
        name: "점도(kg/m-s)",
        value: "i36",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i36 ? tr.i36 : ""}</p>;
        },
      },
      {
        name: "자연발화온도",
        value: "i32",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.i32 ? tr.i32 : ""}</p>;
        },
      },
      {
        name: "저장탱크용량",
        value: "strgTnkSz",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.strgTnkSz ? tr.strgTnkSz : ""}</p>;
        },
      },
      {
        name: "누출량",
        value: "lkgSz",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.lkgSz ? tr.lkgSz : ""}</p>;
        },
      },
      {
        name: "누출시간(초)",
        value: "lkgTime",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.lkgTime !== null ? tr.lkgTime.toString() : ""}</p>;
        },
      },
      {
        name: "분자량",
        value: "mass",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.mass !== null ? tr.mass.toString() : ""}</p>;
        },
      },
      {
        name: "pac2(ppm)",
        value: "pac2",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.pac2 !== null ? tr.pac2.toString() : ""}</p>;
        },
      },
    ];
  }, [data]);

  // STEP3
  const step3InputListHeader: TableHeader[] = useMemo(() => {
    return [
      {
        name: "기준일시",
        value: "mttrnmkor",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return (
            <p>
              {tr.stdDt
                ? moment(tr.stdDt, "YYYYMMDDHHmm").format("YYYY-MM-DD HH:mm")
                : ""}
            </p>
          );
        },
        width: "30%",
      },
      {
        name: "기온(℃)",
        value: "tmpr",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.tmpr ? tr.tmpr : ""}</p>;
        },
      },
      {
        name: "습도(%)",
        value: "hmdt",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.hmdt ? tr.hmdt : ""}</p>;
        },
      },
      {
        name: "풍속(m/s)",
        value: "wsd",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.wsd ? tr.wsd : ""}</p>;
        },
      },
      {
        name: "1시간 후 풍속(m/s)",
        value: "wsd1h",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.wsd1h ? tr.wsd1h : ""}</p>;
        },
      },
      {
        name: "4시간 후 풍속(m/s)",
        value: "wsd4h",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.wsd4h ? tr.wsd4h : ""}</p>;
        },
      },
      {
        name: "8시간 후 풍속(m/s)",
        value: "wsd8h",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.wsd8h ? tr.wsd8h : ""}</p>;
        },
      },
      {
        name: "풍향",
        value: "vec",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.vec ? tr.vec : ""}</p>;
        },
      },
      {
        name: "대기안정도",
        value: "atmsStblPct",
        accessFn: (tr: DmgeEfctStdResponse, index: number) => {
          return <p>{tr.atmsStblPct ? tr.atmsStblPct : ""}</p>;
        },
      },
    ];
  }, [data]);

  // STEP4
  const [simulationDivisionList, setSimulationDivisionList] = useState<
    string[]
  >([
    "피해영향범위",
    "피해영향면적",
    "피해영향 인원 수",
    "피해 영향지역",
    "주변 대피소",
  ]);

  const [fireEvlResponseList, setFireEvlResponseList] = useState<
    DmgeEfctEvlResponse[] | null
  >(null);
  const [explEvlResponseList, setExplEvlResponseList] = useState<
    DmgeEfctEvlResponse[] | null
  >(null);
  const [dfsnEvlResponseList, setDfsnEvlResponseList] = useState<
    DmgeEfctEvlResponse[] | null
  >(null);

  // 위의 데이터가 바뀔때마다 엑셀용 지역, 대피소 string[] 만들기
  const [excelFireAreaList, setExcelFireAreaList] = useState<string[]>([]);
  const [excelExplAreaList, setExcelExplAreaList] = useState<string[]>([]);
  // const [excelDfsnAreaList, setExcelDfsnAreaList] = useState<string[]>([]);

  const [excelFireShelterList, setExcelFireShelterList] = useState<string[]>(
    []
  );
  const [excelExplShelterList, setExcelExplShelterList] = useState<string[]>(
    []
  );
  // const [excelDfsnShelterList, setExcelDfsnShelterList] = useState<string[]>(
  //   []
  // );

  // 겹치지않는 확산 피해영향지역, 대피소 chip출력 텍스트 string[] state
  const [nonDupDfsnAreaList, setNonDupDfsnAreaList] = useState<string[]>([]);
  const [nonDupDfsnShelterList, setNonDupDfsnShelterList] = useState<string[]>(
    []
  );

  useEffect(() => {
    let fireList: any[] = [];
    let explList: any[] = [];
    let dfsnList: any[] = [];

    let fireShelters: any[] = [];
    let explShelters: any[] = [];
    let dfsnShelters: any[] = [];

    // 화재
    fireEvlResponseList?.map((fire) => {
      fire.dmgeEfctAreaResponseList?.map((area) => {
        fireList.push(area);
      });
      fire.dmgeEfctShelterResponsesList?.map((shelter) => {
        fireShelters.push(shelter);
      });
    });

    setExcelFireAreaList(() => {
      const list = fireList.map((l) => {
        if (l.stdgNm) {
          return l.stdgNm;
        } else {
          return;
        }
      });
      return list;
    });
    setExcelFireShelterList(() => {
      const list = fireShelters.map((s) => {
        if (s.shelterNm) {
          return s.shelterNm;
        } else {
          return;
        }
      });
      return list;
    });

    explEvlResponseList?.map((expl) => {
      expl.dmgeEfctAreaResponseList?.map((area) => {
        explList.push(area);
      });
      expl.dmgeEfctShelterResponsesList?.map((shelter) => {
        explShelters.push(shelter);
      });
    });
    setExcelExplAreaList(() => {
      const list: any = explList.map((l) => {
        if (l.stdgNm) {
          return l.stdgNm;
        } else {
          return;
        }
      });
      return list;
    });
    setExcelExplShelterList(() => {
      const list = explShelters.map((s) => {
        if (s.shelterNm) {
          return s.shelterNm;
        } else {
          return;
        }
      });
      return list;
    });

    const totalDmgeAreaList: string[] = [];
    const totalShelterList: string[] = [];
    dfsnEvlResponseList?.map((dfsn) => {
      // 확산 - 대피소
      if (
        dfsn.dmgeEfctShelterResponsesList &&
        dfsn.dmgeEfctShelterResponsesList.length
      ) {
        dfsn.dmgeEfctShelterResponsesList.map((dfsnShelterItem, idx) => {
          if (!dfsnShelterItem.shelterNm) {
            return;
          }
          totalShelterList.push(dfsnShelterItem.shelterNm);
        });
      }
      // 확산 - 피해예상지역
      if (
        dfsn.dmgeEfctAreaResponseList &&
        dfsn.dmgeEfctAreaResponseList.length
      ) {
        dfsn.dmgeEfctAreaResponseList.map((dfsnAreaItem, idx) => {
          if (!dfsnAreaItem.stdgNm) {
            return;
          }
          totalDmgeAreaList.push(dfsnAreaItem.stdgNm);
        });
      }
      dfsn.dmgeEfctAreaResponseList?.map((area) => {
        dfsnList.push(area);
      });
      dfsn.dmgeEfctShelterResponsesList?.map((shelter) => {
        dfsnShelters.push(shelter);
      });
    });
    const uniqueSetArea = new Set(totalDmgeAreaList);
    const uniqueAreaArray: string[] = Array.from(uniqueSetArea).map(String);
    const uniqueSetShelter = new Set(totalShelterList);
    const uniqueShelterArray: string[] =
      Array.from(uniqueSetShelter).map(String);

    setNonDupDfsnAreaList(uniqueAreaArray);
    setNonDupDfsnShelterList(uniqueShelterArray);
    // setExcelDfsnAreaList(() => {
    //   const list: any = dfsnList.map((l) => {
    //     if (l.stdgNm) {
    //       return l.stdgNm;
    //     } else {
    //       return;
    //     }
    //   });
    //   return list;
    // });
    // setExcelDfsnShelterList(() => {
    //   const list = dfsnShelters.map((s) => {
    //     if (s.shelterNm) {
    //       return s.shelterNm;
    //     } else {
    //       return;
    //     }
    //   });
    //   return list;
    // });
  }, [fireEvlResponseList, explEvlResponseList, dfsnEvlResponseList]);

  // fire, expl, dfsn 데이터 세팅
  useEffect(() => {
    if (data && data.evlResponseList && data.evlResponseList.length) {
      const filtedFireDmgeResData = data.evlResponseList.filter((item) => {
        return item.acdntTypeEnu.type === "FIRE";
      });
      const filtedExplDmgeResData = data.evlResponseList.filter((item) => {
        return item.acdntTypeEnu.type === "EXPL";
      });
      const filtedDfsnDmgeResData = data.evlResponseList
        .filter((item) => {
          return item.acdntTypeEnu.type === "DFSN";
        })
        .sort((a, b) => {
          // const efctRngA =
          //   a.efctRng !== null && parseFloat(a.efctRng) > 0
          //     ? parseFloat(a.efctRng)
          //     : 0;
          // const efctRngB =
          //   b.efctRng !== null && parseFloat(b.efctRng) > 0
          //     ? parseFloat(b.efctRng)
          //     : 0;

          const efctRngA = a.attr01 ? parseInt(a.attr01) : 1;
          const efctRngB = b.attr01 ? parseInt(b.attr01) : 1;
          return efctRngA - efctRngB;
        });

      setFireEvlResponseList(
        filtedFireDmgeResData && filtedFireDmgeResData.length
          ? filtedFireDmgeResData
          : null
      );
      setExplEvlResponseList(
        filtedExplDmgeResData && filtedExplDmgeResData.length
          ? filtedExplDmgeResData
          : null
      );
      setDfsnEvlResponseList(
        filtedDfsnDmgeResData && filtedDfsnDmgeResData.length
          ? filtedDfsnDmgeResData
          : null
      );

      // console.log("filtedFireDmgeResData is ", filtedFireDmgeResData);
      // console.log("filtedExplDmgeResData is ", filtedExplDmgeResData);
      // console.log("filtedDfsnDmgeResData is ", filtedDfsnDmgeResData);
      setIsMounted(true);
    } else {
      setFireEvlResponseList(null);
      setExplEvlResponseList(null);
      setDfsnEvlResponseList(null);
      setIsMounted(true);
    }

    if (data.fileDtoList && data.fileDtoList.length) {
      data.fileDtoList.map((item) => {
        if (item.cliFileNm.includes("firemap")) {
          setFireImg(item);
        } else if (item.cliFileNm.includes("explmap")) {
          setExplImg(item);
        } else {
          setDfsnImg(item);
        }
      });
    }
  }, [data]);

  useEffect(() => {}, []);
  // 엑셀에 들어갈 1.사업장 일반정보
  const table1Layout = {
    name: "table1",
    ref: "A2",
    // headerRow: true,
    // totalsRow: true,
    style: {
      theme: null,
      showRowStripes: false,
    },
    columns: [
      { name: "사업장명" },
      { name: "사업자등록번호" },
      { name: "업종" },
      { name: "대표자" },
      { name: "주소" },
      { name: "연락처" },
      { name: "면적" },
    ],
    rows: [
      [
        data.dmgeEfctStdResponse.companyNm,
        data.dmgeEfctStdResponse.companyBizNo,
        data.dmgeEfctStdResponse.companyTpbizNm,
        data.dmgeEfctStdResponse.companyRprsvNm,
        data.dmgeEfctStdResponse.companyRoadNmAddr,
        data.dmgeEfctStdResponse.companyTelNo.replace(
          /(\d{2,3})(\d{3,4})(\d{4})/,
          "$1-$2-$3"
        ),
        data.dmgeEfctStdResponse.companyLdar + "㎡",
      ],
    ],
  };

  // 엑셀에 들어갈 2.화학물질 정보
  const table2Layout = {
    name: "table2",
    ref: "A6",
    style: {
      theme: null,
      showRowStripes: false,
    },
    columns: [
      { name: "화학물질명(국문)" },
      { name: "화학물질명(영문)" },
      { name: "CAS 번호" },
      { name: "성상" },
      { name: "색상" },
      { name: "냄새" },
      { name: "인화점" },
      { name: "밀도" },
      { name: "점도" },
      { name: "자연발화온도" },
      { name: "저장탱크용량" },
      { name: "누출량" },
      { name: "누출시간(초)" },
      { name: "분자량" },
      { name: "pac2(ppm)" },
    ],
    rows: [
      [
        data.dmgeEfctStdResponse.mttrnmkor,
        data.dmgeEfctStdResponse.mttrnmeng,
        data.dmgeEfctStdResponse.casNo,
        data.dmgeEfctStdResponse.i0202,
        data.dmgeEfctStdResponse.i0204,
        data.dmgeEfctStdResponse.i04,
        data.dmgeEfctStdResponse.i14,
        data.dmgeEfctStdResponse.i26,
        data.dmgeEfctStdResponse.i36,
        data.dmgeEfctStdResponse.i32,
        data.dmgeEfctStdResponse.strgTnkSz,
        data.dmgeEfctStdResponse.lkgSz,
        data.dmgeEfctStdResponse.lkgTime.toString(),
        data.dmgeEfctStdResponse.mass.toString(),
        data.dmgeEfctStdResponse.pac2.toString(),
      ],
    ],
  };
  // 엑셀에 들어갈 3. 피해영향범위 기상 입력정보
  const table3Layout = {
    name: "table3",
    ref: "A10",
    style: {
      theme: null,
      showRowStripes: false,
    },
    columns: [
      { name: "기준일시" },
      { name: "기온(℃)" },
      { name: "습도(%)" },
      { name: "풍속(m/s)" },
      { name: "1시간 후 풍속(m/s)" },
      { name: "4시간 후 풍속(m/s)" },
      { name: "8시간 후 풍속(m/s)" },
      { name: "풍향" },
      { name: "대기안정도" },
    ],
    rows: [
      [
        moment(data.dmgeEfctStdResponse.stdDt, "YYYYMMDDHHmm").format(
          "YYYY-MM-DD HH:mm"
        ),
        data.dmgeEfctStdResponse.tmpr,
        data.dmgeEfctStdResponse.hmdt,
        data.dmgeEfctStdResponse.wsd,
        data.dmgeEfctStdResponse.wsd1h,
        data.dmgeEfctStdResponse.wsd4h,
        data.dmgeEfctStdResponse.wsd8h,
        data.dmgeEfctStdResponse.vec,
        data.dmgeEfctStdResponse.atmsStblPct,
      ],
    ],
  };
  // 엑셀에 들어갈 4. 피해영향범위 평가 정보
  const table4Layout = {
    name: "table4",
    ref: "A14",
    style: {
      theme: null,
      showRowStripes: false,
    },
    columns: [
      { name: "구분" },
      { name: "화재" },
      { name: "폭발" },
      { name: "누출(1H/4H/8H)" },
    ],
    rows: [
      [
        "피해영향범위",
        fireEvlResponseList
          ?.map((fire) => (fire.efctRng ? fire.efctRng + "㎡" : ""))
          .join(),
        explEvlResponseList
          ?.map((expl) => (expl.efctRng ? expl.efctRng + "m" : ""))
          .join(),
        dfsnEvlResponseList
          ?.map((dfsn) => (dfsn.efctRng ? dfsn.efctRng + "m" : ""))
          .join(),
      ],
      [
        "피해영향면적",
        fireEvlResponseList
          ?.map((fire) => (fire.efctLdar ? fire.efctLdar + "㎡" : ""))
          .join(),
        explEvlResponseList
          ?.map((expl) => (expl.efctLdar ? expl.efctLdar + "㎡" : ""))
          .join(),
        dfsnEvlResponseList
          ?.map((dfsn) => (dfsn.efctLdar ? dfsn.efctLdar + "㎡" : ""))
          .join(),
      ],
      // [
      //   "피해영향 인원 수",
      //   fireEvlResponseList?.map((fire) => fire.dmgeEfctNope + "명").join(),
      //   explEvlResponseList?.map((expl) => expl.dmgeEfctNope + "명").join(),
      //   dfsnEvlResponseList?.map((dfsn) => dfsn.dmgeEfctNope + "명").join(),
      // ],
      [
        "피해 영향지역",
        excelFireAreaList.join(),
        excelExplAreaList.join(),
        nonDupDfsnAreaList.join(),
      ],
      [
        "주변 대피소",
        excelFireShelterList.join(),
        excelExplShelterList.join(),
        nonDupDfsnShelterList.join(),
      ],
    ],
  };

  function returnSimulationTrData(item: string, index: number) {
    if (!isMounted) {
      return <></>;
    }

    switch (index) {
      case 0:
        return (
          <tr>
            <td>{item}</td>

            {/* 화재 */}
            <td>
              {fireEvlResponseList !== null ? (
                <>
                  {fireEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`fireEvl_${idx}_EfctRng`}
                      >
                        {item.efctRng !== null && item.efctRng !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctRng.toString()}㎡`,
                              value: `${item.efctRng.toString()}㎡`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 폭발 */}
            <td>
              {explEvlResponseList !== null ? (
                <>
                  {explEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`explEvl_${idx}_EfctRng`}
                      >
                        {item.efctRng !== null && item.efctRng !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctRng.toString()}m`,
                              value: `${item.efctRng.toString()}m`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 누출 */}
            <td>
              {dfsnEvlResponseList !== null ? (
                <>
                  {dfsnEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`dfsnEvl_${idx}_EfctRng`}
                      >
                        {item.efctRng !== null && item.efctRng !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctRng.toString()}m`,
                              value: `${item.efctRng.toString()}m`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>
          </tr>
        );
        break;

      case 1:
        return (
          <tr>
            <td>{item}</td>

            {/* 화재 */}
            <td>
              {fireEvlResponseList !== null ? (
                <>
                  {fireEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`fireEvl_${idx}_efctLdar`}
                      >
                        {item.efctLdar !== null &&
                        item.efctLdar !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctLdar.toString()}㎡`,
                              value: `${item.efctLdar.toString()}㎡`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 폭발 */}
            <td>
              {explEvlResponseList !== null ? (
                <>
                  {explEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`explEvl_${idx}_efctLdar`}
                      >
                        {item.efctLdar !== null &&
                        item.efctLdar !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctLdar.toString()}㎡`,
                              value: `${item.efctLdar.toString()}㎡`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 누출 */}
            <td>
              {dfsnEvlResponseList !== null ? (
                <>
                  {dfsnEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`dfsneEvl_${idx}_efctLdar`}
                      >
                        {item.efctLdar !== null &&
                        item.efctLdar !== undefined ? (
                          <Chip
                            chipData={{
                              name: `${item.efctLdar.toString()}㎡`,
                              value: `${item.efctLdar.toString()}㎡`,
                              group: "",
                            }}
                            chipStyle="round"
                            bgColor="white"
                            color="black"
                            borderColor="black"
                          />
                        ) : (
                          <></>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>
          </tr>
        );
        break;

      case 2:
        // return (
        //   <tr>
        //     <td>{item}</td>
        //
        //     {/* 화재 */}
        //     <td>
        //       {fireEvlResponseList !== null ? (
        //         <>
        //           {fireEvlResponseList.map((item, idx) => {
        //             return (
        //               <p key={`fireEvl_${idx}_dmgeEfctNope`}>
        //                 {item.dmgeEfctNope !== null &&
        //                 item.dmgeEfctNope !== undefined
        //                   ? `${
        //                       idx !== 0 ? " / " : ""
        //                     }${item.dmgeEfctNope.toString()}명`
        //                   : ""}
        //               </p>
        //             );
        //           })}
        //         </>
        //       ) : (
        //         <></>
        //       )}
        //     </td>
        //
        //     {/* 폭발 */}
        //     <td>
        //       {explEvlResponseList !== null ? (
        //         <>
        //           {explEvlResponseList.map((item, idx) => {
        //             return (
        //               <p key={`explEvl_${idx}_dmgeEfctNope`}>
        //                 {item.dmgeEfctNope !== null &&
        //                 item.dmgeEfctNope !== undefined
        //                   ? `${
        //                       idx !== 0 ? " / " : ""
        //                     }${item.dmgeEfctNope.toString()}명`
        //                   : ""}
        //               </p>
        //             );
        //           })}
        //         </>
        //       ) : (
        //         <></>
        //       )}
        //     </td>
        //
        //     {/* 누출 */}
        //     <td>
        //       {dfsnEvlResponseList !== null ? (
        //         <>
        //           {dfsnEvlResponseList.map((item, idx) => {
        //             return (
        //               <p key={`dfsnEvl_${idx}_dmgeEfctNope`}>
        //                 {item.dmgeEfctNope !== null &&
        //                 item.dmgeEfctNope !== undefined
        //                   ? `${
        //                       idx !== 0 ? " / " : ""
        //                     }${item.dmgeEfctNope.toString()}명`
        //                   : ""}
        //               </p>
        //             );
        //           })}
        //         </>
        //       ) : (
        //         <></>
        //       )}
        //     </td>
        //   </tr>
        // );
        break;

      case 3:
        return (
          <tr>
            <td>{item}</td>

            {/* 화재 */}
            <td>
              {fireEvlResponseList !== null ? (
                <>
                  {fireEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`fireEvl_${idx}_dmgeEfctAreaResponseList`}
                      >
                        {item.dmgeEfctAreaResponseList !== null &&
                        item.dmgeEfctAreaResponseList.length ? (
                          <>
                            {item.dmgeEfctAreaResponseList.map(
                              (item2, idx2) => {
                                if (!item2.stdgNm) {
                                  return (
                                    <React.Fragment
                                      key={`fireEvl_${idx}_dmgeEfctAreaResponseList_${idx2}`}
                                    ></React.Fragment>
                                  );
                                }

                                return (
                                  <Chip
                                    key={`fireEvl_${idx}_dmgeEfctAreaResponseList_${idx2}`}
                                    chipData={{
                                      name: item2.stdgNm || "",
                                      value: item2.stdgNm || "",
                                      group: "",
                                    }}
                                    chipStyle="round"
                                    bgColor="white"
                                    color="black"
                                    borderColor="black"
                                  />
                                );
                              }
                            )}
                          </>
                        ) : (
                          <> </>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 폭발 */}
            <td>
              {explEvlResponseList !== null ? (
                <>
                  {explEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`explEvl_${idx}_dmgeEfctAreaResponseList`}
                      >
                        {item.dmgeEfctAreaResponseList !== null &&
                        item.dmgeEfctAreaResponseList.length ? (
                          <>
                            {item.dmgeEfctAreaResponseList.map(
                              (item2, idx2) => {
                                if (!item2.stdgNm) {
                                  return (
                                    <React.Fragment
                                      key={`explEvl_${idx}_dmgeEfctAreaResponseList_${idx2}`}
                                    ></React.Fragment>
                                  );
                                }

                                return (
                                  <Chip
                                    key={`explEvl_${idx}_dmgeEfctAreaResponseList_${idx2}`}
                                    chipData={{
                                      name: item2.stdgNm || "",
                                      value: item2.stdgNm || "",
                                      group: "",
                                    }}
                                    chipStyle="round"
                                    bgColor="white"
                                    color="black"
                                    borderColor="black"
                                  />
                                );
                              }
                            )}
                          </>
                        ) : (
                          <> </>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 누출 */}
            <td>
              {nonDupDfsnAreaList && nonDupDfsnAreaList.length ? (
                <>
                  {nonDupDfsnAreaList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`dfsnEvl_${idx}_dmgeEfctAreaResponseList`}
                      >
                        <Chip
                          chipData={{
                            name: item,
                            value: item,
                            group: "",
                          }}
                          chipStyle="round"
                          bgColor="white"
                          color="black"
                          borderColor="black"
                        />
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>
          </tr>
        );
        break;

      default:
        return (
          <tr>
            <td>{item}</td>

            {/* 화재 */}
            <td>
              {fireEvlResponseList !== null ? (
                <>
                  {fireEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`fireEvl_${idx}_dmgeEfctShelterResponsesList`}
                      >
                        {item.dmgeEfctShelterResponsesList !== null &&
                        item.dmgeEfctShelterResponsesList.length ? (
                          <>
                            {item.dmgeEfctShelterResponsesList.map(
                              (item2, idx2) => {
                                if (!item2.shelterNm) {
                                  return (
                                    <React.Fragment
                                      key={`fireEvl_${idx}_dmgeEfctShelterResponsesList_${idx2}`}
                                    ></React.Fragment>
                                  );
                                }

                                return (
                                  <Chip
                                    key={`fireEvl_${idx}_dmgeEfctShelterResponsesList_${idx2}`}
                                    chipData={{
                                      name: item2.shelterNm || "",
                                      value: item2.shelterNm || "",
                                      group: "",
                                    }}
                                    chipStyle="round"
                                    bgColor="white"
                                    color="black"
                                    borderColor="black"
                                  />
                                );
                              }
                            )}
                          </>
                        ) : (
                          <> </>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 폭발 */}
            <td>
              {explEvlResponseList !== null ? (
                <>
                  {explEvlResponseList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`explEvl_${idx}_dmgeEfctShelterResponsesList`}
                      >
                        {item.dmgeEfctShelterResponsesList !== null &&
                        item.dmgeEfctShelterResponsesList.length ? (
                          <>
                            {item.dmgeEfctShelterResponsesList.map(
                              (item2, idx2) => {
                                if (!item2.shelterNm) {
                                  return (
                                    <React.Fragment
                                      key={`explEvl_${idx}_dmgeEfctShelterResponsesList_${idx2}`}
                                    ></React.Fragment>
                                  );
                                }

                                return (
                                  <Chip
                                    key={`explEvl_${idx}_dmgeEfctShelterResponsesList_${idx2}`}
                                    chipData={{
                                      name: item2.shelterNm || "",
                                      value: item2.shelterNm || "",
                                      group: "",
                                    }}
                                    chipStyle="round"
                                    bgColor="white"
                                    color="black"
                                    borderColor="black"
                                  />
                                );
                              }
                            )}
                          </>
                        ) : (
                          <> </>
                        )}
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>

            {/* 누출 */}
            <td>
              {nonDupDfsnShelterList && nonDupDfsnShelterList.length ? (
                <>
                  {nonDupDfsnShelterList.map((item, idx) => {
                    return (
                      <div
                        className={styles.chip_box}
                        key={`dfsnEvl_${idx}_dmgeEfctShelterResponseList`}
                      >
                        <Chip
                          chipData={{
                            name: item,
                            value: item,
                            group: "",
                          }}
                          chipStyle="round"
                          bgColor="white"
                          color="black"
                          borderColor="black"
                        />
                      </div>
                    );
                  })}
                </>
              ) : (
                <></>
              )}
            </td>
          </tr>
        );
        break;
    }
  }

  return (
    <>
      {isMounted ? (
        <div className={styles.report_wrap}>
          <div className={styles.report_group_left}>
            {/* STEP1 */}
            <div className={styles.box_group}>
              <p className={styles.sub_title}>1. 사업장 일반정보</p>
              <Table<DmgeEfctStdResponse>
                tableCaption="사업장 정보 리스트"
                data={[data.dmgeEfctStdResponse]}
                headers={step1InputListHeader}
                tableType={"horizontal"}
                itemTitle={""}
                ref={null}
              />
            </div>

            {/* STEP2 */}
            <div className={styles.box_group}>
              <p className={styles.sub_title}>2. 화학물질 정보</p>
              <Table<DmgeEfctStdResponse>
                tableCaption="화학물질 상세정보 리스트"
                data={[data.dmgeEfctStdResponse]}
                headers={step2InputListHeader}
                tableType={"horizontal"}
                itemTitle={""}
                ref={null}
              />
            </div>

            {/* STEP3 */}
            <div className={styles.box_group}>
              <p className={styles.sub_title}>3. 피해영향범위 기상 입력정보</p>
              <Table<DmgeEfctStdResponse>
                tableCaption="화학물질 상세정보 리스트"
                data={[data.dmgeEfctStdResponse]}
                headers={step3InputListHeader}
                tableType={"horizontal"}
                itemTitle={""}
                ref={null}
              />
            </div>
          </div>

          <div className={styles.report_group_right}>
            {/* Simulation */}
            <div className={styles.box_group}>
              <p className={styles.sub_title}>
                4. 피해영향범위 평가 정보
                <span>{`(피해영향범위평가 No.${id})`}</span>
              </p>
              <table className={styles.tb_st1}>
                <colgroup>
                  <col style={{ width: "25%" }} />
                  <col style={{ width: "25%" }} />
                  <col style={{ width: "25%" }} />
                  <col style={{ width: "25%" }} />
                </colgroup>
                <caption>피해영향범위평가 리스트</caption>
                <thead>
                  <tr>
                    <th scope="col" key={"구분"}>
                      {`구분`}
                    </th>
                    <th scope="col" key={"화재"}>
                      {`화재`}
                    </th>
                    <th scope="col" key={"폭발"}>
                      {`폭발`}
                    </th>
                    <th scope="col" key={"누출"}>
                      {`누출(1H/4H/8H)`}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {!data ||
                  !data.evlResponseList ||
                  data.evlResponseList.length === 0 ? (
                    <tr>
                      <td scope="row" colSpan={12} className={styles.non_data}>
                        데이터가 없습니다.
                      </td>
                    </tr>
                  ) : (
                    simulationDivisionList.map(
                      (item: string, trIndex: number) => {
                        // console.log("trIndex : ", trIndex);
                        return (
                          <React.Fragment key={item}>
                            {returnSimulationTrData(item, trIndex)}
                          </React.Fragment>
                        );
                      }
                    )
                  )}
                </tbody>
                <tfoot></tfoot>
              </table>
            </div>

            {/* 피해영향범위 평가 */}
            <div className={styles.box_group}>
              <p className={styles.sub_title}>
                5. 피해영향범위 평가 시각화 정보
              </p>
              <table className={styles.tb_st1}>
                <colgroup>
                  <col style={{ width: "33.3%" }} />
                  <col style={{ width: "33.3%" }} />
                  <col style={{ width: "33.4%" }} />
                </colgroup>
                <caption>피해영향범위 평가 이미지</caption>
                <thead>
                  <tr>
                    <th scope="col" key={"화재 이미지"}>
                      {`화재`}
                    </th>
                    <th scope="col" key={"폭발 이미지"}>
                      {`폭발`}
                    </th>
                    <th scope="col" key={"누출 이미지"}>
                      {`누출`}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td className={styles.img_td}>
                      {fireImg !== null && (
                        <Image
                          ref={fireImgRef}
                          src={
                            process.env.NEXT_PUBLIC_HOST +
                            "/bapi/common/files/image/" +
                            fireImg.svrFileNm
                          }
                          alt="화재 이미지"
                          width={250}
                          height={200}
                        />
                      )}
                    </td>
                    <td className={styles.img_td}>
                      {explImg && (
                        <Image
                          ref={expImgRef}
                          src={
                            // process.env.NEXT_PUBLIC_HOST + "/utils/files/image/" + data.fileDtoList[1].svrFileNm
                            process.env.NEXT_PUBLIC_HOST +
                            "/bapi/common/files/image/" +
                            explImg.svrFileNm
                          }
                          alt="폭발 이미지"
                          width={250}
                          height={200}
                        />
                      )}
                    </td>
                    <td className={styles.img_td}>
                      {dfsnImg && (
                        <Image
                          ref={dfsnImgRef}
                          src={
                            process.env.NEXT_PUBLIC_HOST +
                            "/bapi/common/files/image/" +
                            dfsnImg.svrFileNm
                          }
                          alt="누출 이미지"
                          width={250}
                          height={200}
                        />
                      )}
                    </td>
                  </tr>
                </tbody>
                <tfoot></tfoot>
              </table>
            </div>

            <div className={styles.btn_box}>
              <div>
                <Button
                  title={"피해영향범위평가 바로가기"}
                  btnColor={"white"}
                  btnSize={"md"}
                  btnStyle={"br_6"}
                  onClick={() => {
                    window.location.href = `/Ca/Simulation/${id}`;
                  }}
                >
                  피해영향범위평가 바로가기
                </Button>
              </div>
              <div>
                <Button
                  title={"Excel 내보내기"}
                  btnColor={"black"}
                  btnSize={"md"}
                  btnStyle={"br_6"}
                  onClick={() => {
                    let workbook = new exceljs.Workbook();

                    // 엑셀에 들어갈 5. 피해영향범위 이미지 (지워야함)
                    const table5Layout = {
                      name: "table5",
                      ref: "A20",
                      style: {
                        theme: null,
                        showRowStripes: false,
                      },
                      columns: [
                        { name: "화재" },
                        { name: "폭발" },
                        { name: "누출" },
                      ],
                      rows: [[], [], [], []],
                    };

                    //이미지 넣을 시트와 데이터 넣을 시트를 추가하기
                    const imageSheet = workbook.addWorksheet(
                      "5. 피해영향범위 평가 시각화 정보"
                    );
                    const dataSheet =
                      workbook.addWorksheet("피해영향범위 리포트 데이터");

                    // TODO
                    //데이터 테이블에 데이터 넣기 - 여기에 데이터 넣으면 됨

                    dataSheet.getCell("A1").value = "1. 사업장 일반정보";
                    dataSheet.getCell("A5").value = "2. 화학물질 정보";
                    dataSheet.getCell("A9").value =
                      "3. 피해영향범위 기상 입력정보";
                    dataSheet.getCell(
                      "A13"
                    ).value = `4. 피해영향범위 평가 정보 (피해영향범위평가 No.${id})`;
                    dataSheet.mergeCells("A1:C1");
                    dataSheet.mergeCells("A5:C5");
                    dataSheet.mergeCells("A9:C9");
                    dataSheet.mergeCells("A13:C13");
                    // @ts-ignore
                    dataSheet.addTable(table1Layout);
                    // @ts-ignore
                    dataSheet.addTable(table2Layout);
                    // @ts-ignore
                    dataSheet.addTable(table3Layout);
                    // @ts-ignore
                    dataSheet.addTable(table4Layout);

                    imageSheet.getCell("B1").value = "화재";
                    imageSheet.getCell("B1").alignment = {
                      horizontal: "center",
                    };
                    imageSheet.getCell("F1").value = "폭발";
                    imageSheet.getCell("F1").alignment = {
                      horizontal: "center",
                    };
                    imageSheet.getCell("J1").value = "누출";
                    imageSheet.getCell("J1").alignment = {
                      horizontal: "center",
                    };
                    imageSheet.mergeCells("B1:D1");
                    imageSheet.mergeCells("F1:H1");
                    imageSheet.mergeCells("J1:L1");

                    //화재, 폭발, 누출 이미지를 html2canvas로 바꾼 후 imageSheet 에 넣기
                    let imges: any = [];
                    if (
                      fireImgRef.current &&
                      expImgRef.current &&
                      dfsnImgRef.current
                    ) {
                      [
                        fireImgRef.current,
                        expImgRef.current,
                        dfsnImgRef.current,
                      ].map((img, index) => {
                        imges.push(
                          html2canvas(img, {
                            scale: 3,
                          }).then((item) => {
                            let image = item.toDataURL();
                            const imageId2 = workbook.addImage({
                              base64: image,
                              extension: "png",
                            });
                            // @ts-ignore
                            imageSheet.addImage(imageId2, position[index]);
                          })
                        );
                      });

                      // excel로 만드는건 비동기처리로
                      Promise.all(imges).then(() => {
                        workbook.xlsx.writeBuffer().then((b) => {
                          let a = new Blob([b]);
                          let url = window.URL.createObjectURL(a);

                          let elem = document.createElement("a");
                          elem.href = url;
                          elem.download = `창원산단 화학물질 알리미 서비스_피해영향범위 리포트.xlsx`;
                          document.body.appendChild(elem);
                          elem.style.display = "none";
                          elem.click();
                          elem.remove();
                        });
                      });

                      return workbook;
                    }
                  }}
                >
                  Excel 내보내기
                </Button>
              </div>

              <div>
                <Button
                  title={"비상대응메시지 생성"}
                  btnColor={"white"}
                  btnSize={"md"}
                  btnStyle={"br_6"}
                  onClick={() => {
                    router.push("/Ca/CrisisMessage/AddCrisisMessage");
                  }}
                >
                  비상대응메시지 생성
                </Button>
              </div>
            </div>
          </div>
        </div>
      ) : (
        <></>
      )}
    </>
  );
}

```

- 사고대응

```tsx
"use client";
import Input from "@/components/common/Input/Input";
import styles from "./AddCrisisResponse.module.scss";
import {
  AcdntInfoDetailResponse,
  RegisterAcdntInfoCommand,
  SearchCompanyChemWithFilterCommand,
} from "@/types/sub/Ca/CrisisResponse";
import { useForm } from "react-hook-form";
import DateTimeInput from "@/components/common/DateInput/DateTimeInput";
import moment from "moment";
import TextArea from "@/components/common/TextArea/TextArea";
import { Button } from "@/components/common/Button/Button";
import { useRouter } from "next/navigation";
import { EnumType, InputErrorMsgType } from "@/types/common/commonType";
import { SetStateAction, useEffect, useRef, useState } from "react";
import { useAutoAlert } from "@/hooks/Alert/useAutoAlert";
import Table, { TableHeader } from "@/components/common/Table/Table";
import Dialog from "@/components/common/Dialog/Dialog";
import {
  CompanyChemResponse,
  CompanyResponse,
  SearchCompanyCommand,
} from "@/types/sub/Sm/SysCompany";
import SearchBox from "@/components/common/SearchBox/SearchBox";
import CommonSelect, {
  commonSelectType,
} from "@/components/common/CommonSelect/CommonSelect";
import SearchBoxLine from "@/components/common/SearchBox/SearchBoxLine";
import { useCompanyPage } from "@/hooks/sub/Sm/useCompanyPage";
import { CommonCheckBox } from "@/components/common/CommonCheckBox/CommonCheckBox";
import PagingComponent from "@/components/common/pagingComponent/PagingComponent";
import { chemicalSelectSearchFilter } from "@/types/common/filter/filter";
import { useCompanyChemPage } from "@/hooks/sub/Ca/useCompanyChemPage";
import ChipButton from "@/components/common/Chip/ChipButton";

interface IProps {
  modi: boolean;
  selectCompanyDataList: EnumType<string>[];
  selectChemDataList: EnumType<string>[];
  data?: AcdntInfoDetailResponse | null;
  onlyRead: string;
}
export default function AddCrisisResponseClient({
  modi,
  data,
  onlyRead,
  selectCompanyDataList,
  selectChemDataList,
}: IProps) {
  const router = useRouter();
  const { setIsChange, setText, setStatus } = useAutoAlert();

  // 다이얼로그
  const [openCompany, setOpenCompany] = useState<boolean>(false);
  const [openChem, setOpenChem] = useState<boolean>(false);
  const companyRef = useRef<any>(null);
  const chemRef1 = useRef<any>(null);

  /**
   * 1. 기본입력
   */
  const {
    register,
    formState: { errors },
    getValues,
    setValue,
    watch,
    trigger,
  } = useForm<RegisterAcdntInfoCommand>({
    mode: "all",
    defaultValues: {
      acdntDt: moment(new Date()).format("YYYY-MM-DD HH:mm"),
      acdntCn: "",
      acdntEntNm: "",
      entAddr: "",
      acdntType: "",
      acdntCause: "",
      acdntMttr: "",
      lkgSz: "",
      acdntPlc: "",
    },
  });

  const [acdntEntNmEffectiveness, setAcdntEntNmEffectiveness] =
    useState<InputErrorMsgType>({
      isSuccess: true,
      msg: "",
    });
  const [entAddrEffectiveness, setEntAddrEffectiveness] =
    useState<InputErrorMsgType>({
      isSuccess: true,
      msg: "",
    });
  const [acdntTypeEffectiveness, setAcdntTypeEffectiveness] =
    useState<InputErrorMsgType>({
      isSuccess: true,
      msg: "",
    });
  const [acdntCauseEffectiveness, setAcdntCauseEffectiveness] =
    useState<InputErrorMsgType>({
      isSuccess: true,
      msg: "",
    });
  const [acdntMttrEffectiveness, setAcdntMttrEffectiveness] =
    useState<InputErrorMsgType>({
      isSuccess: true,
      msg: "",
    });

  /**
   * 2. 취급업체 데이터
   */
  const [companySearchObj, setCompanySearchObj] =
    useState<SearchCompanyCommand>({
      page: 0,
      size: 5,
      sort: "companyNm",
      orderBy: "desc",
      companySearchType: "TPBIZ_NM",
      searchKeyWord: "",
    });
  const [searchTypeList, setSearchTypeList] = useState<commonSelectType[]>([]);
  const [selectCompanyData, setSelectCompanyData] = useState<
    "TPBIZ_NM" | "COMPANY_NM" | "BIZ_NO" | "ROAD_NM_ADDR"
  >("TPBIZ_NM");
  const [searchCompanyKeyWord, setSearchCompanyKeyWord] = useState<string>("");

  // 취급업체 데이터 Hook
  const companyQuery = useCompanyPage(companySearchObj);

  // 테이블에서 선택된 취급업체
  const [selectCompany, setSelectCompany] = useState<
    CompanyResponse | undefined
  >(undefined);

  // 화학물질 선택 전, company가 선택되었는지 검사
  const [checkSelectCompany, setCheckSelectCompany] = useState<boolean>(false);

  // 취급업체 검색방법 필터 타입을 commonSelctType으로 변경
  useEffect(() => {
    if (selectCompanyDataList) {
      const list: commonSelectType[] = selectCompanyDataList.map((item) => {
        return { group: "", name: item.name, value: item.type };
      });

      setSearchTypeList(list);
    }
    if (selectChemDataList) {
      const list: commonSelectType[] = selectChemDataList.map((item) => {
        return { group: "", name: item.name, value: item.type };
      });

      setSearchTypeList2(list);
    }
  }, [selectCompanyDataList, selectChemDataList]);

  /**
   * 3.화학물질 데이터
   */
  const [chemSearchObj, setChemSearchObj] =
    useState<SearchCompanyChemWithFilterCommand>({
      page: 0,
      size: 5,
      companySeq: selectCompany ? selectCompany.companySeq! : -1,
      companyChemSearchType: "ALL",
      searchKeyWord: "",
      orderBy: "casNo",
      sort: "DESC",
    });
  const [searchTypeList2, setSearchTypeList2] = useState<commonSelectType[]>(
    []
  );

  const [selectChemData, setSelectChemData] = useState<
    "MTTRNMKOR" | "MTTRNMENG" | "CASNO" | "ALL"
  >("ALL");
  const [searchChemKeyWord, setSearchChemKeyWord] = useState<string>("");

  // 취급업체의 화학물질 데이터 Hook
  const chemQuery = useCompanyChemPage(chemSearchObj, checkSelectCompany);

  // 테이블에서 선택된 취급업체의 화학물질
  const [selectChem, setSelectChem] = useState<CompanyChemResponse | undefined>(
    undefined
  );

  // 화학물질이 선택되었는지 검사 : 사실 취급업체 아니면 굳이 필요없는데 혹시모르니..
  const [checkSelectChem, setCheckSelectChem] = useState<boolean>(false);

  /**
   * 입력내용 validation check
   */
  function validCheck() {
    if (!getValues("acdntEntNm").length) {
      setAcdntEntNmEffectiveness({
        isSuccess: false,
        msg: "사고업체를 입력해주세요.",
      });
    } else {
      setAcdntEntNmEffectiveness({
        isSuccess: true,
        msg: "",
      });
    }
    if (!getValues("entAddr").length) {
      setEntAddrEffectiveness({
        isSuccess: false,
        msg: "주소를 입력해주세요.",
      });
    } else {
      setEntAddrEffectiveness({
        isSuccess: true,
        msg: "",
      });
    }
    if (!getValues("acdntType").length) {
      setAcdntTypeEffectiveness({
        isSuccess: false,
        msg: "사고유형을 입력해주세요.",
      });
    } else {
      setAcdntTypeEffectiveness({
        isSuccess: true,
        msg: "",
      });
    }
    if (!getValues("acdntCause").length) {
      setAcdntCauseEffectiveness({
        isSuccess: false,
        msg: "사고원인을 입력해주세요.",
      });
    } else {
      setAcdntCauseEffectiveness({
        isSuccess: true,
        msg: "",
      });
    }
    if (!getValues("acdntMttr").length) {
      setAcdntMttrEffectiveness({
        isSuccess: false,
        msg: "사고물질을 입력해주세요.",
      });
    } else {
      setAcdntMttrEffectiveness({
        isSuccess: true,
        msg: "",
      });
    }
  }

  // 메인 Input헤더
  const inputHeaders: TableHeader[] = [
    {
      name: "사고일시",
      value: "acdntDt",
      width: "20%",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntDt")}</p>
            ) : (
              <>
                <DateTimeInput
                  {...register("acdntDt", {
                    required: "사고일시를 입력해주세요.",
                  })}
                  labelTitle="사고일시"
                  dateSize="lg"
                  id={"acdntDt"}
                  dateSetter={(e) => {
                    setValue(
                      "acdntDt",
                      moment(e).format("YYYY-MM-DD HH:mm:ss")
                    );
                  }}
                  defaultDate={watch("acdntDt")}
                />
                <p style={{ padding: "6px 0 0 3px", color: "var(--m-blue02)" }}>
                  날짜, 시간, 분 단위를 정확히 입력해주세요.
                </p>
              </>
            )}
          </>
        );
      },
    },
    {
      name: "사고업체",
      value: "acdntEntNm",
      width: "200px",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntEntNm")}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("acdntEntNm", {
                    required: "사고업체명을 입력해주세요.",
                  })}
                  disabled
                  labelTitle="사고업체"
                  id={"acdntEntNm"}
                  value={watch("acdntEntNm")}
                  size="lg"
                  placeholder="사고업체 입력"
                  onChange={(e) => {
                    setValue("acdntEntNm", e.currentTarget.value.toString());
                  }}
                  effectivenessMsg={acdntEntNmEffectiveness}
                  fieldRightSlotElement={
                    <Dialog
                      openTriggerComponent={
                        <ChipButton
                          chipData={{
                            name: "업체 선택",
                            value: "업체 선택",
                            group: "",
                          }}
                          iconClickButtonTitle="업체 선택"
                          chipStyle="round"
                          bgColor="blue"
                          color="white"
                          borderColor="blue"
                          chipClick={() => {
                            setOpenCompany(true);
                          }}
                          ref={companyRef}
                        ></ChipButton>
                      }
                      open={openCompany}
                      setOpen={(value: SetStateAction<boolean>) => {
                        setOpenCompany(value);
                        if (companyRef && companyRef.current) {
                          companyRef.current.focus();
                        }
                      }}
                      width="60%"
                      title={"업체선택"}
                    >
                      <SearchBox>
                        <div className={styles.search_box_wrap}>
                          <span className={styles.label}>업체 검색</span>
                          <CommonSelect
                            items={searchTypeList}
                            width={"135px"}
                            placeHolder={"검색 조건"}
                            ariaLabel={"검색 조건 선택"}
                            id={"company_select_list"}
                            onValueChange={(
                              value: "TPBIZ_NM" | "COMPANY_NM" | "BIZ_NO"
                            ) => {
                              setSelectCompanyData(value);
                            }}
                            defaultValue="TPBIZ_NM"
                          ></CommonSelect>
                          <div className={styles.search_input_wrap}>
                            <Input
                              labelTitle="업체 검색"
                              size={"md"}
                              placeholder="검색어 입력"
                              id={"inDialog_company_search_input"}
                              value={searchCompanyKeyWord}
                              onChange={(e) => {
                                setSearchCompanyKeyWord(e.currentTarget.value);
                              }}
                              onKeyDown={(e) => {
                                if (e.key == "Enter") {
                                  setCompanySearchObj((prev) => {
                                    return {
                                      ...prev,
                                      page: 0,

                                      companySearchType: selectCompanyData,
                                      searchKeyWord: searchCompanyKeyWord,
                                    };
                                  });
                                }
                              }}
                            />
                          </div>
                          <div className={styles.search_btn_wrap}>
                            <Button
                              title={"업체 검색"}
                              btnColor={"black"}
                              btnSize={"md"}
                              btnStyle={"br_6"}
                              onClick={() => {
                                setCompanySearchObj((prev) => {
                                  return {
                                    ...prev,
                                    page: 0,

                                    companySearchType: selectCompanyData,
                                    searchKeyWord: searchCompanyKeyWord,
                                  };
                                });
                              }}
                            >
                              검색
                            </Button>
                          </div>
                        </div>
                      </SearchBox>

                      {/* 테이블 */}
                      <Table<CompanyResponse>
                        tableCaption="취급업체 리스트 테이블"
                        // data={[...tabelItem, ...execlTableItem]}
                        data={
                          companyQuery &&
                          companyQuery.data &&
                          companyQuery.data.content.length
                            ? companyQuery.data.content
                            : []
                        }
                        headers={header}
                        tableType={"vertical"}
                        itemTitle={"companyNm"}
                        ref={null}
                      />
                      <PagingComponent
                        onClickEvent={(num) => {
                          setCompanySearchObj((prev) => {
                            return {
                              ...prev,
                              page: num - 1,
                            };
                          });
                        }}
                        pagingData={{
                          first: companyQuery.data
                            ? companyQuery.data.first
                            : true,
                          last: companyQuery.data
                            ? companyQuery.data.last
                            : true,
                          size: companyQuery.data ? companyQuery.data.size : 10,
                          totalPages: companyQuery.data
                            ? companyQuery.data.totalPages
                            : 1,
                          totalElements: companyQuery.data
                            ? companyQuery.data.totalElements
                            : 0,
                          number: companyQuery.data
                            ? companyQuery.data.number
                            : 0,
                        }}
                      />

                      <div className={styles.bot_btn_box}>
                        <Button
                          title={"취급업체 선택 취소"}
                          btnColor={"white"}
                          btnSize={"sm"}
                          btnStyle={"br_6"}
                          style={{
                            height: "40px",
                          }}
                          onClick={() => {
                            setOpenCompany(false);
                            if (companyRef && companyRef.current) {
                              companyRef.current.focus();
                            }
                          }}
                        >
                          취소
                        </Button>
                        <Button
                          title={"취급업체 선택"}
                          btnColor={"black"}
                          btnSize={"sm"}
                          btnStyle={"br_6"}
                          style={{
                            height: "40px",
                          }}
                          onClick={() => {
                            if (selectCompany) {
                              setValue("acdntEntNm", selectCompany.companyNm);
                              setValue("entAddr", selectCompany.roadNmAddr);
                              setOpenCompany(false);
                              setCheckSelectCompany(true);

                              // 업체 선택 시, 모든 화학물질 데이터가 초기화되어야함
                              setChemSearchObj((prev) => {
                                return {
                                  ...prev,
                                  page: 0,
                                  companySeq: selectCompany.companySeq!,
                                };
                              });
                              setValue("acdntMttr", "");
                              setCheckSelectChem(false);
                              setSelectChem(undefined);
                              if (companyRef && companyRef.current) {
                                companyRef.current.focus();
                              }
                            } else {
                              setText("등록할 업체를 선택해야 합니다.");
                              setStatus("warning");
                              setIsChange(true);
                            }
                          }}
                        >
                          선택
                        </Button>
                      </div>
                    </Dialog>
                  }
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "주소",
      value: "entAddr",
      width: "200px",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("entAddr")}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("entAddr", {
                    required: "주소를 입력해주세요.",
                  })}
                  disabled
                  labelTitle="주소"
                  id={"entAddr"}
                  value={watch("entAddr")}
                  size="lg"
                  placeholder="주소 입력"
                  onChange={(e) => {
                    setValue("entAddr", e.currentTarget.value.toString());
                  }}
                  effectivenessMsg={entAddrEffectiveness}
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "사고유형",
      value: "acdntType",
      width: "200px",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntType")}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("acdntType", {
                    required: "사고유형을 입력해주세요.",
                  })}
                  labelTitle="사고유형"
                  id={"acdntType"}
                  value={watch("acdntType")}
                  size="lg"
                  placeholder="사고유형 입력"
                  onChange={(e) => {
                    setValue("acdntType", e.currentTarget.value.toString());
                  }}
                  effectivenessMsg={acdntTypeEffectiveness}
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "사고원인",
      value: "acdntCause",
      width: "200px",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntCause")}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("acdntCause", {
                    required: "사고원인을 입력해주세요.",
                  })}
                  labelTitle="사고원인"
                  id={"acdntCause"}
                  value={watch("acdntCause")}
                  size="lg"
                  placeholder="사고원인 입력"
                  onChange={(e) => {
                    setValue("acdntCause", e.currentTarget.value.toString());
                  }}
                  effectivenessMsg={acdntCauseEffectiveness}
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "사고물질",
      value: "acdntMttr",
      width: "200px",
      essential: onlyRead == "true" ? false : true,
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntMttr")}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("acdntMttr", {
                    required: "사고물질을 입력해주세요.",
                  })}
                  disabled
                  labelTitle="사고물질"
                  id={"acdntMttr"}
                  value={watch("acdntMttr")}
                  size="lg"
                  placeholder="사고물질 입력"
                  onChange={(e) => {
                    setValue("acdntMttr", e.currentTarget.value.toString());
                  }}
                  effectivenessMsg={acdntMttrEffectiveness}
                  fieldRightSlotElement={
                    <>
                      {checkSelectCompany ? (
                        <Dialog
                          openTriggerComponent={
                            <ChipButton
                              chipData={{
                                name: "물질 선택",
                                value: "물질 선택",
                                group: "",
                              }}
                              iconClickButtonTitle="화학물질 선택"
                              chipStyle="round"
                              bgColor="blue"
                              color="white"
                              borderColor="blue"
                              chipClick={() => {
                                setOpenChem(true);
                              }}
                              ref={chemRef1}
                            ></ChipButton>
                          }
                          open={openChem}
                          setOpen={(value: SetStateAction<boolean>) => {
                            setOpenChem(value);

                            if (chemRef1 && chemRef1.current) {
                              chemRef1.current.focus();
                            }
                          }}
                          width="60%"
                          title={"물질 선택"}
                        >
                          <SearchBox>
                            <div className={styles.search_box_wrap}>
                              <span className={styles.label}>
                                화학물질 검색
                              </span>
                              <CommonSelect
                                items={searchTypeList2}
                                width={"135px"}
                                placeHolder={"검색 조건"}
                                ariaLabel={"검색 조건 선택"}
                                id={"chem_select_list"}
                                onValueChange={(
                                  value:
                                    | "MTTRNMKOR"
                                    | "MTTRNMENG"
                                    | "CASNO"
                                    | "ALL"
                                ) => {
                                  setSelectChemData(value);
                                }}
                                defaultValue={selectChemData}
                              ></CommonSelect>
                              <div className={styles.search_input_wrap}>
                                <Input
                                  labelTitle="물질 검색"
                                  size={"md"}
                                  id={"inDialog_chem_search_input"}
                                  value={searchChemKeyWord}
                                  onChange={(e) => {
                                    setSearchChemKeyWord(e.currentTarget.value);
                                  }}
                                  placeholder="검색어 입력"
                                  onKeyDown={(e) => {
                                    if (e.key == "Enter") {
                                      setChemSearchObj((prev) => {
                                        return {
                                          ...prev,
                                          page: 0,
                                          companyChemSearchType: selectChemData,
                                          searchKeyWord: searchChemKeyWord,
                                        };
                                      });
                                    }
                                  }}
                                />
                              </div>
                              <div className={styles.search_btn_wrap}>
                                <Button
                                  title={"화학물질 검색"}
                                  btnColor={"black"}
                                  btnSize={"md"}
                                  btnStyle={"br_6"}
                                  onClick={() => {
                                    setChemSearchObj((prev) => {
                                      return {
                                        ...prev,
                                        page: 0,
                                        companyChemSearchType: selectChemData,
                                        searchKeyWord: searchChemKeyWord,
                                      };
                                    });
                                  }}
                                >
                                  검색
                                </Button>
                              </div>
                            </div>
                          </SearchBox>

                          {/* 테이블 */}
                          <Table<CompanyChemResponse>
                            tableCaption="취급업체 화학물질 리스트 테이블"
                            // data={[...tabelItem, ...execlTableItem]}
                            data={
                              chemQuery &&
                              chemQuery.data &&
                              chemQuery.data.content.length
                                ? chemQuery.data.content
                                : []
                            }
                            headers={header2}
                            tableType={"vertical"}
                            itemTitle={"companyChemSeq"}
                            ref={null}
                          />
                          <PagingComponent
                            onClickEvent={(num) => {
                              setChemSearchObj((prev) => {
                                return {
                                  ...prev,
                                  page: num - 1,
                                };
                              });
                            }}
                            pagingData={{
                              first: chemQuery.data
                                ? chemQuery.data.first
                                : true,
                              last: chemQuery.data ? chemQuery.data.last : true,
                              size: chemQuery.data ? chemQuery.data.size : 10,
                              totalPages: chemQuery.data
                                ? chemQuery.data.totalPages
                                : 1,
                              totalElements: chemQuery.data
                                ? chemQuery.data.totalElements
                                : 0,
                              number: chemQuery.data
                                ? chemQuery.data.number
                                : 0,
                            }}
                          />

                          <div className={styles.bot_btn_box}>
                            <Button
                              title={"화학물질 선택 취소"}
                              btnColor={"white"}
                              btnSize={"sm"}
                              btnStyle={"br_6"}
                              style={{
                                height: "40px",
                              }}
                              onClick={() => {
                                setOpenChem(false);
                                if (chemRef1 && chemRef1.current) {
                                  chemRef1.current.focus();
                                }
                              }}
                            >
                              취소
                            </Button>
                            <Button
                              title={"화학물질 선택"}
                              btnColor={"black"}
                              btnSize={"sm"}
                              btnStyle={"br_6"}
                              style={{
                                height: "40px",
                              }}
                              onClick={() => {
                                if (selectChem) {
                                  setValue(
                                    "acdntMttr",
                                    `${selectChem.chemResponse.mttrnmeng}${
                                      selectChem.chemResponse.mttrnmkor
                                        ? `(${selectChem.chemResponse.mttrnmkor})`
                                        : ""
                                    }`
                                  );
                                  setOpenChem(false);
                                  setCheckSelectChem(true);
                                  if (chemRef1 && chemRef1.current) {
                                    chemRef1.current.focus();
                                  }
                                } else {
                                  setText("등록할 화학물질을 선택해야 합니다.");
                                  setStatus("warning");
                                  setIsChange(true);
                                }
                              }}
                            >
                              선택
                            </Button>
                          </div>
                        </Dialog>
                      ) : (
                        <ChipButton
                          chipData={{
                            name: "물질 선택",
                            value: "물질 선택",
                            group: "",
                          }}
                          iconClickButtonTitle="물질 선택"
                          chipStyle="round"
                          bgColor="blue"
                          color="white"
                          borderColor="blue"
                          chipClick={() => {
                            setIsChange(true);
                            setText("사고업체를 먼저 선택해주세요.");
                            setStatus("warning");
                          }}
                        ></ChipButton>
                      )}
                    </>
                  }
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "누출량",
      value: "lkgSz",
      width: "200px",
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("lkgSz") || ""}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("lkgSz")}
                  labelTitle="누출량"
                  id={"lkgSz"}
                  value={watch("lkgSz") || ""}
                  size="lg"
                  placeholder="누출량 입력"
                  onChange={(e) => {
                    setValue("lkgSz", e.currentTarget.value.toString());
                  }}
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "발생장소",
      value: "acdntPlc",
      width: "200px",
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <p>{watch("acdntPlc") || ""}</p>
            ) : (
              <div className={styles.input_box}>
                <Input
                  {...register("acdntPlc")}
                  labelTitle="발생장소"
                  id={"acdntPlc"}
                  value={watch("acdntPlc") || ""}
                  size="lg"
                  placeholder="발생장소 입력"
                  onChange={(e) => {
                    setValue("acdntPlc", e.currentTarget.value.toString());
                  }}
                />
              </div>
            )}
          </>
        );
      },
    },
    {
      name: "사고개요",
      value: "acdntCn",
      width: "200px",
      accessFn: (row: any) => {
        return (
          <>
            {onlyRead == "true" ? (
              <pre
                style={{
                  maxWidth: "1050px",
                  whiteSpace: "pre-wrap",
                  wordWrap: "break-word",
                }}
              >
                {watch("acdntCn") || ""}
              </pre>
            ) : (
              <div className={styles.input_box}>
                <TextArea
                  defaultHeight="200px"
                  {...register("acdntCn")}
                  labelTitle="사고개요"
                  id={"acdntCn"}
                  value={watch("acdntCn") || ""}
                  placeholder="사고개요 입력"
                  onChange={(e) => {
                    setValue("acdntCn", e.currentTarget.value.toString());
                  }}
                />
              </div>
            )}
          </>
        );
      },
    },
  ];

  // 취급업체 출력 헤더
  const header: TableHeader[] = [
    {
      name: "선택",
      value: "companySeq",
      width: "5%",
      accessFn: (item: CompanyResponse, idx: number) => {
        return (
          <div className={styles.table_check_box}>
            <CommonCheckBox
              title={`${
                item.companySeq &&
                selectCompany &&
                selectCompany.companySeq &&
                selectCompany.companySeq === item.companySeq
                  ? `${item.companyNm}요소 체크됨`
                  : `${item.companyNm}요소 체크안됨`
              }`}
              id={
                item.companySeq
                  ? item.companySeq.toString()
                  : item.rowId.toString()
              }
              checked={
                item.companySeq &&
                selectCompany &&
                selectCompany.companySeq &&
                selectCompany.companySeq === item.companySeq
                  ? true
                  : false
              }
              onCheckedChange={(e: boolean) => {
                if (e === true) {
                  setSelectCompany(item);
                } else {
                  setSelectCompany(undefined);
                }
              }}
            />
          </div>
        );
      },
    },
    {
      name: "업체명",
      value: "companyNm",
      width: "15%",
    },
    {
      name: "업종",
      value: "tpbizNm",
      width: "10%",
    },
    {
      name: "주소",
      value: "roadNmAddr",
      width: "40%",
    },
    {
      name: "연락처",
      value: "telNo",
      width: "15%",
      accessFn: (row: CompanyResponse) => {
        return (
          <span className={styles.table_td}>
            {row.telNo
              ? row.telNo
                  .replace(/[^0-9]/g, "")
                  .replace(/^(\d{2,3})(\d{3,4})(\d{4})$/, `$1-$2-$3`)
              : ""}
          </span>
        );
      },
    },

    {
      name: "연간취급량",
      value: "yearTrtmntSz",
      width: "15%",
    },
  ];

  // 화학물질 출력 헤더
  const header2: TableHeader[] = [
    {
      name: "선택",
      value: "companyChemSeq",
      width: "5%",
      accessFn: (item: CompanyChemResponse, idx: number) => {
        return (
          <div className={styles.table_check_box}>
            <CommonCheckBox
              title={`${
                item.companyChemSeq &&
                selectChem &&
                selectChem.companyChemSeq &&
                selectChem.companyChemSeq === item.companyChemSeq
                  ? `${item.chemResponse.mttrnmeng}요소 체크됨`
                  : `${item.chemResponse.mttrnmeng}요소 체크안됨`
              }`}
              id={
                item.companyChemSeq
                  ? item.companyChemSeq.toString()
                  : item.rowId.toString()
              }
              checked={
                item.companyChemSeq &&
                selectChem &&
                selectChem.companyChemSeq &&
                selectChem.companyChemSeq === item.companyChemSeq
                  ? true
                  : false
              }
              onCheckedChange={(e: boolean) => {
                if (e === true) {
                  setSelectChem(item);
                } else {
                  setSelectChem(undefined);
                }
              }}
            />
          </div>
        );
      },
    },

    {
      name: "화학물질명(국문)",
      value: "chemResponse.mttrnmkor",
      width: "32.5%",
      align: "left",
      accessFn: (item: CompanyChemResponse, idx: number) => {
        return (
          <span className={styles.table_td}>
            {item.chemResponse.mttrnmkor || ""}
          </span>
        );
      },
    },
    {
      name: "화학물질명(영문)",
      value: "chemResponse.mttrnmeng",
      width: "32.5%",
      align: "left",
      accessFn: (item: CompanyChemResponse, idx: number) => {
        return (
          <span className={styles.table_td}>{item.chemResponse.mttrnmeng}</span>
        );
      },
    },
    {
      name: "CAS 번호",
      value: "casNo",
      width: "30%",
    },
  ];

  useEffect(() => {
    if (modi && data) {
      const formattedAcdntYmd = moment(data.acdntDt, "YYYY-MM-DD HH:mm").format(
        "YYYY-MM-DD HH:mm:ss"
      );

      setValue("acdntDt", formattedAcdntYmd);
      setValue("acdntCn", data.acdntCn || "");
      setValue("acdntEntNm", data.acdntEntNm || "");
      setValue("entAddr", data.entAddr || "");
      setValue("acdntType", data.acdntType || "");
      setValue("acdntCause", data.acdntCause || "");
      setValue("acdntMttr", data.acdntMttr || "");
      setValue("lkgSz", data.lkgSz || "");
      setValue("acdntPlc", data.acdntPlc || "");

      /**
       * 화학물질 선택을 위한 세팅필요
       *
       * 1. 화학물질 검색 obj 설정
       * 2. 취급업체 선택 상태값을 true로 설정 : setCheckSelectCompany(true)
       * 3. 화학물질도 기존에 입력된 게 있으면, 화학물질 선택 상태값도 true로 설정 : setCheckSelectChem(true);
       */

      setChemSearchObj((prev) => {
        return {
          ...prev,
          companySeq: data.companySeq!,
        };
      });

      setCheckSelectCompany(true);
      setCheckSelectChem(true);
    } else {
    }
  }, []);

  return (
    <>
      <Table<RegisterAcdntInfoCommand>
        tableCaption="사고대응정보 등록"
        data={[getValues()]}
        headers={inputHeaders}
        tableType={"horizontal"}
        itemTitle={"acdntEntNm"}
        ref={null}
      />
      {onlyRead != "true" ? (
        <p className={styles.desc_txt}>
          ※ 필수항목을 모두 입력하셔야 저장이 가능합니다.
        </p>
      ) : (
        <></>
      )}
      {/* 저장/취소 */}
      <div className={`${styles.bot_btn_box}`}>
        {onlyRead == "true" ? (
          <>
            <Button
              title="목록"
              btnColor="black"
              btnSize="md"
              btnStyle="br_6"
              onClick={() => {
                router.back();
                router.refresh();
              }}
            >
              목록
            </Button>
          </>
        ) : (
          <>
            <Button
              title="취소"
              btnColor="white"
              btnSize="md"
              btnStyle="br_6"
              onClick={() => {
                router.back();
                router.refresh();
              }}
            >
              취소
            </Button>
            <Button
              title="저장"
              btnColor="black"
              btnSize="md"
              btnStyle="br_6"
              onClick={async () => {
                const result = await trigger(
                  [
                    "acdntDt",
                    "acdntEntNm",
                    "entAddr",
                    "acdntType",
                    "acdntCause",
                    "acdntMttr",
                  ],
                  {
                    shouldFocus: true,
                  }
                );
                validCheck();

                if (!result) {
                  return;
                } else {
                  const inputData = getValues();

                  if (modi && data) {
                    // 수정단계

                    const postData = {
                      ...inputData,
                      acdntInfoSeq: data.acdntInfoSeq,
                      acdntDt: moment(inputData.acdntDt).format("YYYYMMDDHHmm"),
                      companySeq: selectCompany
                        ? selectCompany.companySeq
                        : data.companySeq,
                      chemSeq: selectChem
                        ? selectChem.companyChemSeq
                        : data.chemSeq,
                    };

                    fetch("/api/accident/modifyAcdntInfo", {
                      method: "POST",
                      body: JSON.stringify(postData),
                    })
                      .then((res) => res.json())
                      .then((result) => {
                        if (result.code == "OK") {
                          setStatus("success");
                          setText("수정되었습니다.");
                          setIsChange(true);
                          setTimeout(() => {
                            router.push("/Ca/CrisisResponse");
                            router.refresh();
                          }, 600);
                          return;
                        } else {
                          setStatus("error");
                          setText(
                            `수정 과정에서 오류가 발생했습니다. ${
                              result.description || result.msg || ""
                            }`
                          );
                          setIsChange(true);
                          return;
                        }
                      })
                      .catch((err) => {
                        setStatus("error");
                        setText("수정 과정에서 오류가 발생했습니다.");
                        setIsChange(true);
                        return;
                      });
                  } else {
                    // 등록단계
                    const postData = {
                      ...inputData,
                      acdntDt: moment(inputData.acdntDt).format("YYYYMMDDHHmm"),
                      companySeq: selectCompany!.companySeq,
                      chemSeq: selectChem!.companyChemSeq,
                      delYn: "N",
                    };

                    fetch("/api/accident/registerAcdntInfo", {
                      method: "POST",
                      body: JSON.stringify(postData),
                    })
                      .then((res) => res.json())
                      .then((result) => {
                        if (result.code == 200) {
                          setStatus("success");
                          setText("저장되었습니다.");
                          setIsChange(true);
                          setTimeout(() => {
                            router.push("/Ca/CrisisResponse");
                            router.refresh();
                          }, 600);
                          return;
                        } else {
                          setStatus("error");
                          setText(
                            `등록 과정에서 오류가 발생했습니다. ${
                              result.description || result.msg || ""
                            }`
                          );
                          setIsChange(true);
                          return;
                        }
                      })
                      .catch((err) => {
                        setStatus("error");
                        setText("저장 과정에서 오류가 발생했습니다.");
                        setIsChange(true);
                        return;
                      });
                  }
                }
              }}
            >
              저장
            </Button>
          </>
        )}
      </div>
    </>
  );
}

```