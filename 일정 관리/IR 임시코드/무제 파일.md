
```javascript

(function () {  
    return {  
        htmlLoading: false,
        cssLoading: false, 
        onInit: function (j) {  
  
            var page = this;  
  
            var container = new Triton.Container({  
                appendTo: j  
            });  
            var section = new Triton.Section({  
                appendTo: container  
            });  
            new Triton.Title({  
                appendTo: section,  
                content: PageConstructor.getCurrentMenuName(),  
            });  
  
            var tab = page.tab = new Triton.Tab({  
                appendTo: container,  
                theme : Triton.Tab.Theme.Normal,  
                contextmenuDisabled : true,  
                addButtonHidden: true,  
                listButtonHidden: true,  
                moveButtonHidden: true,  
                readOnly : false,  
                css : {'margin-top' : '20px'},  
                onAdd: function (options) {  
                },  
                onBind: function (options, index) {  
                    PageManager.cpcpm({index : index});  
                    page.tab.setTabIndex(PageManager.pcd(0, 'index'), true);  
                }  
            });  
            page.tab.addTabButton({  
                name : "현황",  
            }, true, true);  
  
            page.bodySection = new Triton.Section({  
                appendTo: container,  
                css: {  
                    'padding' : '20px 20px 20px 20px',  
                    'border' : '1px solid ' + TritonTheme.LIST_TABLE_BORDER_COLOR,  
                    'border-top' : 'none'  
                }  
            });  
  
            page.resultSection = new Triton.Section({ 
                appendTo: page.bodySection,  
                css: {  
                    'overflow' : 'hidden',  
                }  
            });  
  
            page.tab.setTabIndex(PageManager.pcd(0, 'index'), true);  
        },  
  
        onChange: function (jPage, jPageContainer, i, parameterMap, beforeParameterMap) {  
  
            var page = this;  
  
            Requester.func(function () {  
                var indexPage = PageManager.pcd('0', 'index');  
                page.resultSection.empty(); 
                
                if (indexPage == 0) {
	                page.detailPageOne(page.resultSection, parameterMap);   
                } else {
                    page.detailThree(page.resultSection, parameterMap);  
                }  
            });  
  
        },  
  
  
        detailPageOne: function (appendTo, parameterMap) {  
  
            var page = this;  
  
            var searchSection = new Triton.Section({  
                appendTo: appendTo  
            });  
  
            var searchPanel = new Triton.Panel({  
                appendTo: searchSection,  
                contentMinWidth: '900px'  
            });  
  
            var searchDetailTable = new Triton.DetailTable({  
                appendTo: searchPanel,  
            });  
  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '연도'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.yearComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'year'},  
                    optionList: [  
                        {                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '2022년',  
                            value: 2022  
                        },  
                        {  
                            name: '2023년',  
                            value: 2023  
                        },  
                        {  
                            name: '2024년',  
                            value: 2024  
                        },  
                        {  
                            name: '2025년',  
                            value: 2025  
                        },  
                        {  
                            name: '2026년',  
                            value: 2026  
                        },  
                        {  
                            name: '2027년',  
                            value: 2027  
                        }  
                    ],  
                    onKeyPress: function (e) {  
  
                        if (e.which == Lia.KeyCode.ENTER) {  
                            page.searchButton.trigger('click');  
                        }  
                    }  
                })  
            });  
            page.yearComboBox.setValue(PageManager.pc('year'))  
  
            searchDetailTable.appendKeyColumn({  
                content: '학기',  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.termComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'term'},  
                    optionList: [  
                        {                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '1학기',  
                            value: 10  
                        },  
                        {  
                            name: '하계 계절학기',  
                            value: 11  
                        },  
                        {  
                            name: '2학기',  
                            value: 20  
                        },  
                        {  
                            name: '동계 계절학기',  
                            value: 21  
                        }  
                    ],  
                    onKeyPress: function (e) {  
  
                        if (e.which == Lia.KeyCode.ENTER) {  
                            page.searchButton.trigger('click');  
                        }  
                    }  
                })  
            });  
            page.termComboBox.setValue(PageManager.pc('term'))  
  
            var searchButtonSection = new Triton.ButtonSection({  
                appendTo: searchPanel  
            });  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색 조건 초기화',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
  
                    for (var key in item) {  
                        item[key] = '';  
                    }  
  
                    item['page'] = 1;  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var page = e.data.page;  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
                    item['page'] = 1;  
  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
            new Triton.SubTitle({  
                appendTo: appendTo,  
                content: '캡스톤디자인 이수현황'  
            });  
  
  
            var resultSection = new Triton.Section({  
                appendTo: appendTo,  
            });  
  
            var topPanel = new Triton.Panel({  
                appendTo: resultSection  
            });  
  
            var detailTable = new Triton.DetailTable({  
                appendTo: topPanel  
            });  
  
            var bottomPanel = new Triton.Panel({  
                appendTo: resultSection,  
                css: {'margin-top': '20px'}  
            });  
  
            var detailTable2 = new Triton.DetailTable({  
                appendTo: bottomPanel,  
            });  
  
  
            if (PageManager.pc('year') == null) {  
  
                detailTable.appendRow({});  
                detailTable.appendKeyColumn({content: '목표값 (A)', css: {'width' : '33%'}});  
                detailTable.appendKeyColumn({content: '달성값 (B)', css: {'width' : '33%'}});  
                detailTable.appendKeyColumn({content: '달성률(%)<br/>(C=(B/A)*100)', css: {'width' : '33%'}});  
                detailTable.appendRow({});  
                detailTable.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendKeyColumn({content: '사업단 참여학과 재학생 수 (A)<br/>(정보공시 기준)', css: {'padding': '5px 0'}});  
                detailTable2.appendKeyColumn({content: '구분', css: {}});  
                detailTable2.appendKeyColumn({content: '3,4학년<br>이상 캡스톤디자인<br>이수학생 수(B)', css: {}});  
                detailTable2.appendKeyColumn({content: '캡스톤디자인 이수학생 비율(%)<br/>(C=B/Ax100)', css: {}});  
                detailTable2.appendKeyColumn({content: '가중치', css: {}});  
                detailTable2.appendKeyColumn({content: '합계', css: {}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: page.totalCapdeCount = new Triton.Span({  
                        content :0,  
                    }),css: {'text-align': 'center'},attr:{rowSpan: 3}  
                });  
                detailTable2.appendValueColumn({content: '일반', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '1.0', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '기업연계 기반', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '1.5', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '기업연계 기반 학제간 융합<br/>또는 글로벌', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '2.0', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '합계', css: {'text-align': 'center', 'font-weight':'bold'}, attr:{colSpan: 5}});  
                detailTable2.appendValueColumn({content: 0, css: {'text-align': 'center', 'font-weight':'bold'}});  
  
                return;  
            }  
  
  
  
            Requester.awb(ProjectApiUrl.Portal.GET_CAP_FOR_STUDENT_LIST_BY_DEPARTMENT, {  
                year: PageManager.pc('year'),  
                term: PageManager.pc('term'),  
                department: Server.userRoleCode == 21 ? Server.userName : null  
            }, function (status, data, request) {  
                LoadingPopupManager.hide();  
  
                if (status != Requester.Status.SUCCESS) {  
                    return;  
                }  
  
                var body = Lia.p(data, 'body');  
                var list = Lia.p(body, 'list')  
  
                var targetValue = 52.4;  
                switch (PageManager.pc('year')) {  
                    case '2022':  
                        targetValue = 56.5;  
                        break;  
                    case '2023':  
                        targetValue = 63.3;  
                        break;  
                    case '2024':  
                        targetValue = 70.5;  
                        break;  
                    case '2025':  
                        targetValue = 78;  
                        break;  
                    case '2026':  
                        targetValue = 85.6;  
                        break;  
                    case '2027':  
                        targetValue = 94.3;  
                        break;  
                }  
  
                // TODO Temp 값  
                var enrolledStudents = Lia.pcd(0,body,'cap_stone_design_participation_student_count');;  
                var generalCompletedStudents = Lia.pcd(0,body,'cap_design_general');  
                var companyCompletedStudents = Lia.pcd(0,body,'cap_design_business_linked');  
                var companyGlobalCompletedStudents = Lia.pcd(0,body,'cap_design_converged') +  Lia.pcd(0,body,'cap_design_global');  
  
                var generalTotal = ProjectFormatHelper.accomplishmentRate(enrolledStudents, generalCompletedStudents);  
                var companyTotal = ProjectFormatHelper.accomplishmentRate(enrolledStudents, companyCompletedStudents)*1.5;  
                var companyGlobalTotal = ProjectFormatHelper.accomplishmentRate(enrolledStudents, companyGlobalCompletedStudents)*2.0;  
  
                detailTable.appendRow({});  
                detailTable.appendKeyColumn({content: '목표값 (A)', css: {'width' : '33%'}});  
                detailTable.appendKeyColumn({content: '달성값 (B)', css: {'width' : '33%'}});  
                detailTable.appendKeyColumn({content: '달성률(%)<br/>(C=(B/A)*100)', css: {'width' : '33%'}});  
                detailTable.appendRow({});  
                detailTable.appendValueColumn({content: targetValue, css: {'text-align': 'center'}});  
                detailTable.appendValueColumn({content: ProjectFormatHelper.sum(generalTotal, companyTotal, companyGlobalTotal), css: {'text-align': 'center'}});  
                detailTable.appendValueColumn({content: ProjectFormatHelper.accomplishmentRate(targetValue,ProjectFormatHelper.sum(generalTotal, companyTotal, companyGlobalTotal))+'%', css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendKeyColumn({content: '사업단 참여학과 재학생 수 (A)<br/>(정보공시 기준)', css: {'padding': '5px 0'}});  
                detailTable2.appendKeyColumn({content: '구분', css: {}});  
                detailTable2.appendKeyColumn({content: '3,4학년<br>이상 캡스톤디자인<br>이수학생 수(B)', css: {}});  
                detailTable2.appendKeyColumn({content: '캡스톤디자인 이수학생 비율(%)<br/>(C=B/Ax100)', css: {}});  
                detailTable2.appendKeyColumn({content: '가중치', css: {}});  
                detailTable2.appendKeyColumn({content: '합계', css: {}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: page.totalCapdeCount = new Triton.Span({  
                        content : FormatHelper.toPrice(0),  
                    }),css: {'text-align': 'center'},attr:{rowSpan: 3}  
                });  
                detailTable2.appendValueColumn({content: '일반', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: FormatHelper.toPrice(generalCompletedStudents), css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: ProjectFormatHelper.accomplishmentRate(enrolledStudents, generalCompletedStudents)+'%', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '1.0', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: generalTotal.toFixed(2)+'%', css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '기업연계 기반', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: FormatHelper.toPrice(companyCompletedStudents), css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: ProjectFormatHelper.accomplishmentRate(enrolledStudents, companyCompletedStudents)+'%', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '1.5', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: companyTotal.toFixed(2)+'%', css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '기업연계 기반 학제간 융합<br/>또는 글로벌', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: FormatHelper.toPrice(companyGlobalCompletedStudents), css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: ProjectFormatHelper.accomplishmentRate(enrolledStudents, companyGlobalCompletedStudents)+'%', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: '2.0', css: {'text-align': 'center'}});  
                detailTable2.appendValueColumn({content: companyGlobalTotal.toFixed(2)+'%', css: {'text-align': 'center'}});  
  
                detailTable2.appendRow({});  
                detailTable2.appendValueColumn({content: '합계', css: {'text-align': 'center', 'font-weight':'bold'}, attr:{colSpan: 5}});  
                detailTable2.appendValueColumn({content: ProjectFormatHelper.sum(generalTotal, companyTotal, companyGlobalTotal)+'%', css: {'text-align': 'center', 'font-weight':'bold'}});  
  
                var categorySection = page.categorySection = new Triton.Section({  
                    theme: Triton.Section.Theme.Category,  
                    appendTo: appendTo,  
                    css: {'margin-top': '10px', 'margin-bottom' : '10px'}  
                });  
  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    content: '엑셀 다운로드',  
                    theme: Triton.FlatButton.Theme.Normal,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '5px'},  
                    page: page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
  
                        AjaxPopupManager.show(PopupUrl.EXPORT_DOWNLOAD_PROGRESS, {  
                            url: ProjectApiUrl.Excel.GET_CAP_STONE_DESIGN_DEPARTMENT_EXCEL_DOWNLOAD,  
                            requestMap: {year: PageManager.pc('year'), term: PageManager.pc('term') }  
                        });  
                    }  
                });  
  
                if(Server.userRoleCode == 10 || !Server.loggedIn) {  
                    new Triton.FlatButton({  
                        appendTo: categorySection,  
                        content: '엑셀 업로드',  
                        theme: Triton.FlatButton.Theme.Header,  
                        css: {'border-radius': '10px', 'float': 'right', 'margin-right': '5px'},  
                        page: page,  
                        onClick: function (e) {  
  
                            var page = e.data.page;  
  
                            AjaxPopupManager.show(PopupUrl.REGISTER_EXCEL, {  
  
                                parameterMap: {  
                                    courseId: page.courseId,  
                                    year: PageManager.pc('year')  
                                },  
                                title: '엑셀 업로드',  
                                uploadUrl: ProjectApiUrl.Excel.IMPORT_CAP_STONE_DESIGN_DEPARTMENT_TARGET,  
                                templateUrl: ProjectApiUrl.Excel.GET_CAP_STONE_DESIGN_DEPARTMENT_TARGET_TEMPLATE,  
  
                                onCompleted: function () {  
                                    Lia.refresh();  
                                }  
                            }, {});  
                        }  
                    });  
                }  
  
                var detailListPanel = new Triton.Panel({  
                    appendTo: appendTo  
                });  
  
                var detailListTable = new Triton.DetailTable({  
                    appendTo: detailListPanel,  
                });  
  
                detailListTable.appendRow({});  
                detailListTable.appendKeyColumn({  
                    content: '단과대학',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendKeyColumn({  
                    content: '학과',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendKeyColumn({  
                    content: '참여학과 재학생<br/>수*(명)',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendKeyColumn({  
                    content: '목표인원<br/>(A)',  
                    attr: {'rowspan' : '2'},  
                });  
  
                detailListTable.appendKeyColumn({  
                    content: '1학기',  
                    attr: {'colspan' : '2'}  
                });  
                detailListTable.appendKeyColumn({  
                    content: '2학기',  
                    attr: {'colspan' : '2'}  
                });  
  
                detailListTable.appendKeyColumn({  
                    content: '합계<br/>(가중치 반영)',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendKeyColumn({  
                    content: '미달및초과<br/>( B+C-A )',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendKeyColumn({  
                    content: '목표대비<br/>달성률',  
                    attr: {'rowspan' : '2'},  
                });  
                detailListTable.appendRow({});  
                detailListTable.appendKeyColumn({content: '일반'});  
                detailListTable.appendKeyColumn({content: '기업연계'});  
                detailListTable.appendKeyColumn({content: '일반'});  
                detailListTable.appendKeyColumn({content: '기업연계'});  
                detailListTable.appendRow({});  
  
                var deparmentCount = Lia.pcd(0, body, 'total_count');  
  
                var totalCapdeCount = 0  
                var totalTargetCount = 0  
                var totalFirstcapdesigngeneral = 0  
                var totalFirstcapdesignbusinesslinked = 0  
                var totalSecondcapdesigngeneral = 0  
                var totalSecondcapdesignbusinesslinked = 0  
                var totalDepartmentStudentTotalWeighted = 0  
                var totalPerformance = 0  
                var totalAccomplishmentRate = 0  
  
                if (list != null) {  
  
                    list = Lia.convertListToListMap(list, 'college_name');  
                    for (var k in list) {  
                        var row = list[k].length;  
                        detailListTable.appendKeyColumn({content: k, attr: {rowspan: row}});  
  
                        var departmentList = list[k];  
                        for (var i = 0; i < row; i++) {  
                            var departmentItem = departmentList[i]  
                            var capdeCount = Lia.pcd(0, departmentItem, 'capde_count')  
                            var targetCount = Lia.pcd(0, departmentItem, 'target_count')  
                            var firstcapdesigngeneral = Lia.pcd(0, departmentItem, 'first_cap_design_general')  
                            var firstcapdesignbusinesslinked = Lia.pcd(0, departmentItem, 'first_cap_design_business_linked')  
                            var secondcapdesigngeneral = Lia.pcd(0, departmentItem, 'second_cap_design_general')  
                            var secondcapdesignbusinesslinked = Lia.pcd(0, departmentItem, 'second_cap_design_business_linked')  
  
                            if (PageManager.pc('term') == '10') {  
                                secondcapdesigngeneral = 0  
                                secondcapdesignbusinesslinked = 0  
                            }  
                            if (PageManager.pc('term') == '20') {  
                                firstcapdesigngeneral = 0  
                                firstcapdesignbusinesslinked = 0  
                            }  
  
  
  
                            var departmentStudentTotalWeighted = firstcapdesigngeneral+firstcapdesignbusinesslinked*2+secondcapdesigngeneral+secondcapdesignbusinesslinked*2  
                            var performance =  (firstcapdesigngeneral+firstcapdesignbusinesslinked+secondcapdesigngeneral+secondcapdesignbusinesslinked)-targetCount  
  
                            var accomplishmentRate = ProjectFormatHelper.accomplishmentRate(targetCount,performance)  
  
                            totalCapdeCount += capdeCount  
                            totalTargetCount += targetCount  
                            totalFirstcapdesigngeneral += firstcapdesigngeneral  
                            totalFirstcapdesignbusinesslinked += firstcapdesignbusinesslinked  
                            totalSecondcapdesigngeneral += secondcapdesigngeneral  
                            totalSecondcapdesignbusinesslinked += secondcapdesignbusinesslinked  
                            totalDepartmentStudentTotalWeighted += departmentStudentTotalWeighted  
                            totalPerformance += performance  
                            totalAccomplishmentRate += accomplishmentRate  
  
                            detailListTable.appendKeyColumn({  
                                content: Lia.pcd('-', departmentItem, 'dept_nm'),  
                                css: {'cursor': 'pointer'},  
                                onClick: function () {  
                                    var jThis = $(this);  
                                    page.resultDataClickEvent(jThis.text());  
                                }  
                            });  
                            detailListTable.appendValueColumn({  
                                content: capdeCount,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: targetCount,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: firstcapdesigngeneral,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: firstcapdesignbusinesslinked,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: secondcapdesigngeneral,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: secondcapdesignbusinesslinked,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: departmentStudentTotalWeighted,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: performance,  
                                css: {'text-align': 'center'}  
                            });  
                            detailListTable.appendValueColumn({  
                                content: accomplishmentRate+'%',  
                                css: {'text-align': 'center'}  
                            });  
  
                            detailListTable.appendRow({});  
                        }  
                    }  
                }  
  
                detailListTable.appendKeyColumn({content: '합계(' + deparmentCount + '개 학과)', attr: {colSpan: 2}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalCapdeCount), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalTargetCount), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalFirstcapdesigngeneral), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalFirstcapdesignbusinesslinked), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalSecondcapdesigngeneral), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalSecondcapdesignbusinesslinked), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalDepartmentStudentTotalWeighted), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalPerformance), css: {'text-align': 'center'}});  
                detailListTable.appendValueColumn({content: FormatHelper.toPrice(totalAccomplishmentRate), css: {'text-align': 'center'}});  
  
                page.totalCapdeCount.setContent(FormatHelper.toPrice(totalCapdeCount))  
  
            })  
  
  
        },  
  
        listPage: function (appendTo, parameterMap) {  
  
            var page = this;  
  
            var searchSection = new Triton.Section({  
                appendTo: appendTo  
            });  
  
            var searchPanel = new Triton.Panel({  
                appendTo: searchSection,  
                contentMinWidth: '900px'  
            });  
  
            var searchDetailTable = new Triton.DetailTable({  
                appendTo: searchPanel,  
            });  
  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '연도'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.yearComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'year'},  
                    optionList: [  
                        {                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '2022년',  
                            value: 2022  
                        },  
                        {  
                            name: '2023년',  
                            value: 2023  
                        },  
                        {  
                            name: '2024년',  
                            value: 2024  
                        },  
                        {  
                            name: '2025년',  
                            value: 2025  
                        },  
                        {  
                            name: '2026년',  
                            value: 2026  
                        },  
                        {  
                            name: '2027년',  
                            value: 2027  
                        }  
                    ],  
                    onSelected: function (val) {  
  
                        page.departmentList = DepartmentList.createOptionList(val)  
  
                        Requester.func(function () {  
                            page.departmentComboBox.setOptionList(page.departmentList)  
                            page.departmentComboBox.setValue(PageManager.pc('department'));  
                        })  
                    }  
                })  
            });  
            page.yearComboBox.setValue(PageManager.pc('year'))  
  
            searchDetailTable.appendKeyColumn({  
                content: '학기',  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.hakgiComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'hakgi'},  
                    optionList: [  
                        {                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '1학기',  
                            value: 10  
                        },  
                        {  
                            name: '하계 계절학기',  
                            value: 11  
                        },  
                        {  
                            name: '2학기',  
                            value: 20  
                        },  
                        {  
                            name: '동계 계절학기',  
                            value: 21  
                        }  
                    ],  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
            page.hakgiComboBox.setValue(PageManager.pc('hakgi'))  
  
            searchDetailTable.appendKeyColumn({  
                content: '학점'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.searchByCredit = new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'search_by_credit'},  
                    value : PageManager.pc('search_by_credit'),  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '학과'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.departmentComboBox = new Triton.ComboBox({  
                    optionList: page.departmentList,  
                    form: {name: 'department'},  
                    value : PageManager.pc('department'),  
                })  
            });  
            searchDetailTable.appendKeyColumn({  
                content: '구분'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.projcetTypeComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'projcetType'},  
                    optionList: [  
                        {                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '일반',  
                            value: 1  
                        },  
                        {  
                            name: '기업연계',  
                            value: 2  
                        },  
                        {  
                            name: '융합',  
                            value: 3  
                        },  
                        {  
                            name: '글로벌',  
                            value: 4  
                        }  
                    ],  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
            page.projcetTypeComboBox.setValue(PageManager.pc('projcet_type'));  
  
            // searchDetailTable.appendRow({});  
            // searchDetailTable.appendKeyColumn({            //     content: '학생 학부(과)'  
            // });            // searchDetailTable.appendValueColumn({            //     content: page.seachByStudentDepartmentNameTextInput = new Triton.TextInput({            //         theme: Triton.TextInput.Theme.Normal,            //         form: {name: 'searchByStudentDepartmentName'},            //         onKeyPress: function (e) {            //            //             if (e.which == Lia.KeyCode.ENTER) {            //                 page.searchButton.trigger('click');            //             }            //         }            //     })            // });            searchDetailTable.appendKeyColumn({  
                content: '지도교수 명'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.searchByTeacherName = new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'searchByTeacherName'},  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '과목 명'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.subjectName = new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'subject_name'},  
                    value : PageManager.pc('subject_name'),  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
            searchDetailTable.appendKeyColumn({  
                content: '프로젝트 명'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.projectName = new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'project_name'},  
                    value : PageManager.pc('project_name'),  
                    // onKeyPress: function (e) {  
                    //                    //     if (e.which == Lia.KeyCode.ENTER) {                    //         page.searchButton.trigger('click');                    //     }                    // }                })  
            });  
  
            page.searchByTeacherName.setValue(PageManager.pc('search_by_teacher_name'))  
  
            var searchButtonSection = new Triton.ButtonSection({  
                appendTo: searchPanel  
            });  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색 조건 초기화',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
  
                    for (var key in item) {  
                        item[key] = '';  
                    }  
  
                    item['page'] = 1;  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var page = e.data.page;  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
                    item['page'] = 1;  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
            var categorySection = page.categorySection = new Triton.Section({  
                theme: Triton.Section.Theme.Category,  
                appendTo: appendTo,  
                css: {'margin-top': '10px', 'margin-bottom' : '10px'}  
            });  
  
            page.countComboBox = new Triton.ComboBox({  
                appendTo: categorySection,  
                theme: Triton.ComboBox.Theme.CategoryNotFirst,  
                form: {name: 'count'},  
                css: {'float': 'right'},  
                optionList: PolarisSettings.CountOptionList,  
                onSelected: function (val) {  
                    if(val != PageManager.pcd(20, 'count') ){  
                        PageManager.cpcpm({'page': 1, 'count': val});  
                    }  
                }  
            });  
  
  
            var map = FormatHelper.arrayKeyToCamel(Triton.extractFormData(page.get()));  
  
            var searchOption = new SearchOption();  
            var searchOptionList = null  
  
            if (String.isNotBlank(PageManager.pc('hakgi'))) {  
                searchOption.add(CapstoneDesignSearchOption.HAKGI, PageManager.pc('hakgi'));  
            }  
            if (String.isNotBlank(PageManager.pc('department'))) {  
                searchOption.add(CapstoneDesignSearchOption.DEPARTMENT, PageManager.pc('department'));  
            }  
            if (String.isNotBlank(PageManager.pc('search_by_teacher_name'))) {  
                searchOption.add(CapstoneDesignSearchOption.TEACHER_NAME, PageManager.pc('search_by_teacher_name'));  
            }  
            if (String.isNotBlank(PageManager.pc('search_by_credit'))) {  
                searchOption.add(CapstoneDesignSearchOption.CREDIT, PageManager.pc('search_by_credit'));  
            }  
            if (String.isNotBlank(PageManager.pc('projcet_type'))) {  
                searchOption.add(CapstoneDesignSearchOption.PROJCET_TYPE, PageManager.pc('projcet_type'));  
            }  
            if (String.isNotBlank(PageManager.pc('subject_name'))) {  
                searchOption.add(CapstoneDesignSearchOption.SUBJECT_NAME, PageManager.pc('subject_name'));  
            }  
            if (String.isNotBlank(PageManager.pc('project_name'))) {  
                searchOption.add(CapstoneDesignSearchOption.PROJECT_NAME, PageManager.pc('project_name'));  
            }  
            if(PageManager.pc('department') == null && Server.userRoleCode == 21){  
                searchOption.add(CapstoneDesignSearchOption.DEPARTMENT, Server.userName);  
            }  
  
            if (searchOption.size() > 0) {  
                map['searchOptionList'] = searchOption.get();  
            }  
  
            map['year'] = Lia.pd(null, parameterMap, 'year');  
            map['page'] = Lia.pd(1, parameterMap, 'page');  
            map['count'] = Lia.pd(20, parameterMap, 'count');  
  
  
            new Triton.FlatButton({  
                appendTo: categorySection,  
                content: '엑셀 다운로드',  
                theme: Triton.FlatButton.Theme.Normal,  
                css: {'border-radius': '10px', 'float': 'right'},  
                page: page,  
                onClick: function (e) {  
  
                    var page = e.data.page;  
  
                    var searchOption = new SearchOption();  
  
                    if (String.isNotBlank(PageManager.pc('hakgi'))) {  
                        searchOption.add(CapstoneDesignSearchOption.HAKGI, PageManager.pc('hakgi'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('department'))) {  
                        searchOption.add(CapstoneDesignSearchOption.DEPARTMENT, PageManager.pc('department'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('search_by_teacher_name'))) {  
                        searchOption.add(CapstoneDesignSearchOption.TEACHER_NAME, PageManager.pc('search_by_teacher_name'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('search_by_credit'))) {  
                        searchOption.add(CapstoneDesignSearchOption.CREDIT, PageManager.pc('search_by_credit'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('projcet_type'))) {  
                        searchOption.add(CapstoneDesignSearchOption.PROJCET_TYPE, PageManager.pc('projcet_type'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('subject_name'))) {  
                        searchOption.add(CapstoneDesignSearchOption.SUBJECT_NAME, PageManager.pc('subject_name'));  
                    }  
                    if (String.isNotBlank(PageManager.pc('project_name'))) {  
                        searchOption.add(CapstoneDesignSearchOption.PROJECT_NAME, PageManager.pc('project_name'));  
                    }  
                    if(PageManager.pc('department') == null && Server.userRoleCode == 21){  
                        searchOption.add(CapstoneDesignSearchOption.DEPARTMENT, Server.userName);  
                    }  
  
                    AjaxPopupManager.show(PopupUrl.EXPORT_DOWNLOAD_PROGRESS, {  
                        url: ProjectApiUrl.Excel.GET_CAP_STONE_DESIGN_EXCEL_DOWNLOAD,  
                        requestMap: {year: PageManager.pc('year'), searchOptionList: searchOption != null ? searchOption.get():null}  
                    });  
                }  
            });  
  
            var readOnly = true  
            if(Server.userRoleCode <= 11 && Server.loggedIn){  
                readOnly = page.readOnly = false  
            }  
  
            if(!readOnly) {  
  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    theme : Triton.FlatButton.Theme.Header,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '10px'},  
                    content: '추가',  
                    page : page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
                        AjaxPopupManager.show(ProjectPopupUrl.ADD_CAP_STONE_DESIGN_POPUP, {  
                            onSaved : function () {  
  
                                page.onChange();  
  
                            }  
                        });  
  
                    }  
                })  
  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    content: '삭제',  
                    theme: Triton.FlatButton.Theme.HeaderDelete,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '10px'},  
                    page: page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
  
                        var idList = [];  
                        var jCheckBox = page.find('.check_box');  
                        for (var i = 0, l = jCheckBox.length; i < l; i++) {  
                            if (jCheckBox.eq(i).getTriton().getPressed()) {  
  
                                var triton = jCheckBox.eq(i).closest('.' + Triton.ListTable.Row.NAME).getTriton();  
  
                                var item = Lia.p(triton.getOptions(), 'item');  
  
                                var jItem = JSON.stringify({  
                                    year : Lia.p(item, 'year'),  
                                    haggi : Lia.p(item, 'term'),  
                                    hagbeon : Lia.p(item, 'stud_id'),  
                                    sudjectId : Lia.p(item, 'subject_no'),  
                                    sudjectNm : Lia.p(item, 'subject_nm')  
                                })  
  
                                idList.push(jItem)  
                            }  
  
                        }  
  
                        if (Array.isEmpty(idList)) {  
                            PopupManager.alert('안내', '삭제할 데이터를 선택해주세요.');  
                            return;  
                        }  
  
                        Requester.awb(ProjectApiUrl.Project.DELETE_CAP_STONE_DESIGN, {  
                            idList : idList.join(';')  
                        }, function (status, data, request) {  
  
                            LoadingPopupManager.hide();  
  
                            if (status != Requester.Status.SUCCESS) {  
                                return;  
                            }  
                            page.onChange();  
                        });  
                    }  
                })  
  
  
            }  
  
            if(PageManager.pc('year') == null){  
                var contentPanel = new Triton.Panel({  
                    appendTo: appendTo,  
                    theme: Triton.Panel.Theme.List  
                });  
  
                var detailResultListTable = new Triton.ListTable({  
                    appendTo: contentPanel,  
                });  
  
                detailResultListTable.appendHeaderRow({});  
                if(!readOnly) {  
                    detailResultListTable.appendHeaderColumn({  
                        css: {width: '60px'},  
                        content: new Triton.CheckBox({  
                            addClass: 'header_check_box',  
                            listTable: detailResultListTable,  
                            onChecked: function (value) {  
  
                                var jThis = $(this);  
  
                                var triton = jThis.getTriton();  
                                var options = triton.getOptions();  
  
                                var listTable = Lia.p(options, 'listTable');  
  
                                var jCheckBox = listTable.find('.check_box');  
  
                                for (var i = 0, l = jCheckBox.length; i < l; i++) {  
                                    jCheckBox.eq(i).getTriton().setValue(value, true);  
                                }  
                            }  
                        })  
                    })  
                }  
                detailResultListTable.appendHeaderColumn({  
                    content: '연번',  
                    css: {'width': PolarisSettings.ListTableWith.ROW_NUMBER}  
                });  
                detailResultListTable.appendHeaderColumn({content: '연도', css: {width: '80px'}});  
                detailResultListTable.appendHeaderColumn({content: '학기', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '단과대학', css: {width: '150px'}});  
                detailResultListTable.appendHeaderColumn({content: '학과(부)', css: {width: '150px'}});  
                detailResultListTable.appendHeaderColumn({content: '학번', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '이름', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '학년', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '담당교수', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '강좌번호', css: {width: '120px'}});  
                detailResultListTable.appendHeaderColumn({content: '과목명'});  
                detailResultListTable.appendHeaderColumn({content: '프로젝트명'});  
                detailResultListTable.appendHeaderColumn({content: '기업연계유무', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '학점', css: {width: '100px'}});  
  
                    new Triton.Section({  
                        appendTo: contentPanel,  
                        theme: Triton.Section.Theme.ListMessage,  
                        content: '표시될 항목이 없습니다.'  
                    })  
  
                return;  
            }  
  
            LoadingPopupManager.show();  
  
            Requester.awb(ProjectApiUrl.Portal.GET_CAP_FOR_STUDENT,  
                    map , function (status, data, request) {  
  
                LoadingPopupManager.hide();  
  
                if (status != Requester.Status.SUCCESS) {  
                    return;  
                }  
  
  
                page.countComboBox.setValue(PageManager.pcd(20, 'count'));  
  
                var contentPanel = new Triton.Panel({  
                    appendTo: appendTo,  
                    theme: Triton.Panel.Theme.List  
                });  
  
                var detailResultListTable = new Triton.ListTable({  
                    appendTo: contentPanel,  
                });  
  
                detailResultListTable.appendHeaderRow({});  
                    if(!readOnly) {  
                        detailResultListTable.appendHeaderColumn({  
                            css: {width: '60px'},  
                            content: new Triton.CheckBox({  
                                addClass: 'header_check_box',  
                                listTable: detailResultListTable,  
                                onChecked: function (value) {  
  
                                    var jThis = $(this);  
  
                                    var triton = jThis.getTriton();  
                                    var options = triton.getOptions();  
  
                                    var listTable = Lia.p(options, 'listTable');  
  
                                    var jCheckBox = listTable.find('.check_box');  
  
                                    for (var i = 0, l = jCheckBox.length; i < l; i++) {  
                                        jCheckBox.eq(i).getTriton().setValue(value, true);  
                                    }  
                                }  
                            })  
                        })  
                    }  
                detailResultListTable.appendHeaderColumn({  
                    content: '연번',  
                    css: {'width': PolarisSettings.ListTableWith.ROW_NUMBER}  
                });  
                detailResultListTable.appendHeaderColumn({content: '연도', css: {width: '80px'}});  
                detailResultListTable.appendHeaderColumn({content: '학기', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '단과대학', css: {width: '150px'}});  
                detailResultListTable.appendHeaderColumn({content: '학과(부)', css: {width: '150px'}});  
                detailResultListTable.appendHeaderColumn({content: '학번', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '이름', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '학년', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '담당교수', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '강좌번호', css: {width: '120px'}});  
                detailResultListTable.appendHeaderColumn({content: '과목명'});  
                detailResultListTable.appendHeaderColumn({content: '프로젝트명'});  
                detailResultListTable.appendHeaderColumn({content: '기업연계유무', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '학점', css: {width: '100px'}});  
  
                //var list1 = DummyData.listData(PageManager.p('department'));  
  
                var list = Lia.p(data,'body', 'list');  
  
                if (Array.isNotEmpty(list)) {  
  
                    for (var k = 0, j = list.length; k < j; k++) {  
  
                        var item1 = list[k];  
                        var term = '-'  
                        switch (Lia.p(item1, 'term')) {  
                            case '1': term = '1학기'; break;  
                            case '2': term = '2학기'; break;  
                            case '3': term = '여름방학'; break;  
                            case '4': term = '겨울방학'; break;  
                        }  
  
                        var projectType = '-'  
                        switch (Lia.p(item1, 'project_type_code')) {  
                            case "1": projectType='일반'; break;  
                            case "2": projectType='기업연계'; break;  
                            case "3": projectType='융합'; break;  
                            case "4": projectType='글로벌'; break;  
                        }  
  
                        detailResultListTable.appendRow({  
                            item :item1,  
                            onClick: function (e) {  
                                AjaxPopupManager.show(ProjectPopupUrl.ADD_CAP_STONE_DESIGN_POPUP,{  
                                    item:e.data.item,  
                                    onSaved : function () {  
                                        page.onChange();  
                                    }  
                                });  
                            },css:{'cursor':'pointer'}  
                        });  
                        if(!readOnly) {  
                            detailResultListTable.appendColumn({  
                                content: new Triton.CheckBox({  
                                    addClass: 'check_box',  
                                    listTable: detailResultListTable,  
                                    onChecked: function (val) {  
  
                                        var jThis = $(this);  
                                        var triton = jThis.getTriton();  
                                        var options = triton.getOptions();  
                                        var listTable = Lia.p(options, 'listTable');  
  
                                        var checked = true;  
                                        var jCheckBox = listTable.find('.check_box');  
                                        var l = jCheckBox.length;  
                                        if (l == 0) {  
                                            checked = false;  
                                        } else {  
  
                                            for (var i = 0; i < l; i++) {  
  
                                                if (!jCheckBox.eq(i).getTriton().getPressed()) {  
                                                    checked = false;  
                                                    break;  
                                                }  
                                            }  
                                        }  
  
                                        var jHeaderCheckBox = listTable.find('.header_check_box');  
                                        jHeaderCheckBox.getTriton().setPressed(checked, true);  
                                    }  
                                })  
                            })  
                        }  
                        detailResultListTable.appendColumn({content: Lia.p(item1, 'row_number')});  
                        detailResultListTable.appendColumn({content: Lia.p(item1, 'year')});  
                        detailResultListTable.appendColumn({content: term});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'college_name')});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'dept_nm')});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'stud_id')});  
                        detailResultListTable.appendColumn({content: Lia.p(item1, 'stud_nm')});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'stu_grade')});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'emp_nm')});  
                        detailResultListTable.appendColumn({content: Lia.p(item1, 'subject_no')});  
                        detailResultListTable.appendColumn({content: Lia.p(item1, 'subject_nm')});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'project_nm')});  
                        detailResultListTable.appendColumn({content: projectType});  
                        detailResultListTable.appendColumn({content: Lia.pcd('-',item1, 'grade').replace(/[0-9]/g,"")});  
  
                    }  
  
                } else {  
  
                    new Triton.Section({  
                        appendTo: contentPanel,  
                        theme: Triton.Section.Theme.ListMessage,  
                        content: '표시될 항목이 없습니다.'  
                    })  
                }  
  
                var pagerSection = new Triton.Section({  
                    appendTo: appendTo,  
                    theme: Triton.Section.Theme.Pager  
                });  
  
                new Triton.Pager({  
                    appendTo: pagerSection,  
                    'pageNumber': Lia.p(request, 'parameterMap', 'page'),  
                    'countPerPage': Lia.p(request, 'parameterMap', 'count'),  
                    'totalCount': page.responseTotalCount = Lia.p(data, 'body', 'total_count'),  
                    'onPageSelected': function (pageNumber) {  
                        PageManager.goCurrentPageWithCurrentParameterMap({page: pageNumber});  
                    }  
                });  
  
            });  
  
  
        },  
  
  
        detailThree: function (appendTo, parameterMap) {  
  
            var page = this;  
  
            var searchSection = new Triton.Section({  
                appendTo: appendTo  
            });  
  
            var searchPanel = new Triton.Panel({  
                appendTo: searchSection,  
                contentMinWidth: '900px'  
            });  
  
            var searchDetailTable = new Triton.DetailTable({  
                appendTo: searchPanel,  
            });  
  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '연도'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.yearComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'year'},  
                    optionList: [  
                        {  
                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '2022년',  
                            value: 2022  
                        },  
                        {  
                            name: '2023년',  
                            value: 2023  
                        },  
                        {  
                            name: '2024년',  
                            value: 2024  
                        },  
                        {  
                            name: '2025년',  
                            value: 2025  
                        },  
                        {  
                            name: '2026년',  
                            value: 2026  
                        },  
                        {  
                            name: '2027년',  
                            value: 2027  
                        }  
                    ]  
                })  
            });  
  
            page.yearComboBox.setValue(PageManager.pc('year'));  
  
            searchDetailTable.appendKeyColumn({  
                content: '교과 명'  
            });  
            searchDetailTable.appendValueColumn({  
                content: new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'name'},  
                    value : PageManager.pc('name')  
                })  
            });  
            searchDetailTable.appendKeyColumn({  
                content: '교과 번호'  
            });  
            searchDetailTable.appendValueColumn({  
                content: new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'number'},  
                    value : PageManager.pc('number')  
                })  
            });  
  
            searchDetailTable.appendRow({});  
            searchDetailTable.appendKeyColumn({  
                content: '학기'  
            });  
            searchDetailTable.appendValueColumn({  
                content: page.termComboBox = new Triton.ComboBox({  
                    theme: Triton.ComboBox.Theme.Full,  
                    css: {'width': '150px'},  
                    form: {name: 'term'},  
                    optionList: [  
                        {  
                            name: '전체',  
                            value: ''  
                        },  
                        {  
                            name: '1학기',  
                            value: 1  
                        },  
                        {  
                            name: '하계 계절학기',  
                            value: 3  
                        },  
                        {  
                            name: '2학기',  
                            value: 2  
                        },  
                        {  
                            name: '동계 계절학기',  
                            value: 4  
                        }  
                    ],  
                })  
            });  
  
            page.termComboBox.setValue(PageManager.pc('term'));  
  
            searchDetailTable.appendKeyColumn({  
                content: '개설 학과'  
            });  
            searchDetailTable.appendValueColumn({  
                content: new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'department'},  
                    value : PageManager.pc('department')  
                })  
            });  
            searchDetailTable.appendKeyColumn({  
                content: '지도 교수'  
            });  
            searchDetailTable.appendValueColumn({  
                content: new Triton.TextInput({  
                    theme: Triton.TextInput.Theme.Normal,  
                    form: {name: 'emp_nm'},  
                    value : PageManager.pc('emp_nm')  
                })  
            });  
  
  
  
            var searchButtonSection = new Triton.ButtonSection({  
                appendTo: searchPanel,  
            });  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색 조건 초기화',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
  
                    for (var key in item) {  
                        item[key] = '';  
                    }  
  
                    item['page'] = 1;  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
            searchButtonSection.appendToRight(new Triton.FlatButton({  
                content: '검색',  
                theme: Triton.FlatButton.Theme.Normal,  
                page: page,  
                onClick: function (e) {  
  
                    var page = e.data.page;  
                    var item = FormatHelper.arrayKeyToUnderscore(Triton.extractFormData(page.get()));  
                    item['page2'] = 1;  
                    PageManager.cpcpm(item);  
                }  
            }));  
  
  
            var categorySection = page.categorySection = new Triton.Section({  
                theme: Triton.Section.Theme.Category,  
                appendTo: appendTo,  
                css: {'margin-top': '10px', 'margin-bottom' : '10px'}  
            });  
  
            page.countComboBox = new Triton.ComboBox({  
                appendTo: categorySection,  
                theme: Triton.ComboBox.Theme.CategoryNotFirst,  
                form: {name: 'count2'},  
                css: {'float': 'right'},  
                optionList: PolarisSettings.CountOptionList,  
                onSelected: function (val) {  
                    if(val != PageManager.pcd(20, 'count2') ){  
                        PageManager.cpcpm({'page2': 1, 'count2': val});  
                    }  
                }  
            });  
  
            var map = FormatHelper.arrayKeyToCamel(Triton.extractFormData(page.get()));  
  
            map['year'] = Lia.p(parameterMap, 'year');  
            map['page'] = Lia.pd(1, parameterMap, 'page2');  
            map['count'] = Lia.pd(20, parameterMap, 'count2');  
  
            var searchOptionList = new SearchOptionList();  
  
            if (String.isNotBlank(Lia.p(parameterMap, 'name'))) {  
                searchOptionList.add(CapStoneDesignLectureSearchOptionList.NAME, Lia.p(parameterMap, 'name'));  
            }  
            if (String.isNotBlank(Lia.p(parameterMap, 'number'))) {  
                searchOptionList.add(CapStoneDesignLectureSearchOptionList.NUMBER, Lia.p(parameterMap, 'number'));  
            }  
            if (String.isNotBlank(Lia.p(parameterMap, 'term'))) {  
                searchOptionList.add(CapStoneDesignLectureSearchOptionList.TERM, Lia.p(parameterMap, 'term'));  
            }  
            if (String.isNotBlank(Lia.p(parameterMap, 'department'))) {  
                searchOptionList.add(CapStoneDesignLectureSearchOptionList.DEPARTMENT, Lia.p(parameterMap, 'department'));  
            }  
            if (String.isNotBlank(Lia.p(parameterMap, 'emp_nm'))) {  
                searchOptionList.add(CapStoneDesignLectureSearchOptionList.EMP_NM, Lia.p(parameterMap, 'emp_nm'));  
            }  
  
            if (searchOptionList.size() > 0) {  
                map['searchOptionList'] = searchOptionList.get();  
            } else {  
                searchOptionList = null;  
            }  
  
            if(Server.userRoleCode <= 11 && Server.loggedIn){  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    content: '삭제',  
                    theme: Triton.FlatButton.Theme.HeaderDelete,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '10px'},  
                    page: page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
  
                        var idList = [];  
                        var jCheckBox = page.find('.comparison_division_lecture_check_box');  
                        for (var i = 0, l = jCheckBox.length; i < l; i++) {  
                            if (jCheckBox.eq(i).getTriton().getPressed()) {  
  
                                var triton = jCheckBox.eq(i).closest('.' + Triton.ListTable.Row.NAME).getTriton();  
  
                                var item = Lia.p(triton.getOptions(), 'item');  
  
                                idList.push(Lia.p(item, 'id'));  
                            }  
                        }  
  
                        if(Array.isEmpty(idList)){  
                            PopupManager.alert('안내', '삭제할 데이터를 선택해주세요.');  
                            return;  
                        }  
  
                        Requester.awb(ProjectApiUrl.Project.DELETE_CAP_STONE_DESIGN_LECTURE, {  
                            idList : idList.join(',')  
                        }, function (status, data, request) {  
  
                            LoadingPopupManager.hide();  
  
                            if (status != Requester.Status.SUCCESS) {  
                                return;  
                            }  
                            page.onChange();  
                        });  
                    }  
                })  
  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    content: '엑셀 다운로드',  
                    theme: Triton.FlatButton.Theme.Normal,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '10px'},  
                    page: page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
  
                        var map = FormatHelper.arrayKeyToCamel(Triton.extractFormData(page.get()));  
  
                        map['year'] = Lia.p(parameterMap, 'year');  
                        map['page'] = Lia.pd(1, parameterMap, 'page2');  
                        map['count'] = Lia.pd(20, parameterMap, 'count2');  
  
                        var searchOptionList = new SearchOptionList();  
  
                        if (String.isNotBlank(Lia.p(parameterMap, 'name'))) {  
                            searchOptionList.add(CapStoneDesignLectureSearchOptionList.NAME, Lia.p(parameterMap, 'name'));  
                        }  
                        if (String.isNotBlank(Lia.p(parameterMap, 'number'))) {  
                            searchOptionList.add(CapStoneDesignLectureSearchOptionList.NUMBER, Lia.p(parameterMap, 'number'));  
                        }  
                        if (String.isNotBlank(Lia.p(parameterMap, 'term'))) {  
                            searchOptionList.add(CapStoneDesignLectureSearchOptionList.TERM, Lia.p(parameterMap, 'term'));  
                        }  
                        if (String.isNotBlank(Lia.p(parameterMap, 'department'))) {  
                            searchOptionList.add(CapStoneDesignLectureSearchOptionList.DEPARTMENT, Lia.p(parameterMap, 'department'));  
                        }  
                        if (String.isNotBlank(Lia.p(parameterMap, 'emp_nm'))) {  
                            searchOptionList.add(CapStoneDesignLectureSearchOptionList.EMP_NM, Lia.p(parameterMap, 'emp_nm'));  
                        }  
  
                        if (searchOptionList.size() > 0) {  
                            map['searchOptionList'] = searchOptionList.get();  
                        }  
  
                        AjaxPopupManager.show(PopupUrl.EXPORT_DOWNLOAD_PROGRESS, {  
                            url: ProjectApiUrl.Excel.GET_CAP_STONE_DESIGN_LECTURE_EXCEL_DOWNLOAD,  
                            requestMap: {year: PageManager.pc('year'),searchOptionList: searchOptionList.size() > 0 ? searchOptionList.get():null}  
                        });  
  
  
                    }  
                });  
  
                new Triton.FlatButton({  
                    appendTo: categorySection,  
                    content: '엑셀 업로드',  
                    theme: Triton.FlatButton.Theme.Normal,  
                    css: {'border-radius': '10px', 'float': 'right', 'margin-right': '10px'},  
                    page: page,  
                    onClick: function (e) {  
  
                        var page = e.data.page;  
  
                        AjaxPopupManager.show(PopupUrl.REGISTER_EXCEL, {  
                            parameterMap: {  
                                courseId: page.courseId,  
                            },  
                            title: '엑셀 업로드',  
                            uploadUrl: ProjectApiUrl.Excel.IMPORT_CAP_STONE_DESIGN_LECTURE,  
                            templateUrl : ProjectApiUrl.Excel.GET_CAP_STONE_DESIGN_LECTURE_EXCEL_IMPORT_TEMPLATE,  
  
                            onCompleted: function () {  
                                Lia.refresh();  
                            }  
                        }, {});  
                    }  
                });  
            }  
  
            var panel = new Triton.Panel({  
                appendTo: appendTo  
            });  
  
            var detailTable = new Triton.DetailTable({  
                appendTo: panel  
            });  
  
            if(!PageManager.pc('year')){  
                detailTable.appendRow({});  
                detailTable.appendKeyColumn({content: '교과목수(명)', css: {'width' : '33.3%'}});  
                detailTable.appendKeyColumn({content: '참여학생수(명)', css: {'width' : '33.3%'}});  
                detailTable.appendKeyColumn({content: '이수학생수(명)', css: {'width' : '33.3%'}});  
                detailTable.appendRow({});  
                detailTable.appendValueColumn({content: '0', css: {'text-align' : 'center'}});  
                detailTable.appendValueColumn({content: '0', css: {'text-align' : 'center'}});  
                detailTable.appendValueColumn({content: '0', css: {'text-align' : 'center'}});  
                return;  
            }  
  
            LoadingPopupManager.show();  
  
            Requester.awb(ProjectApiUrl.Project.GET_CAP_STONE_DESIGN_LECTURE_LIST, map, function (status, data, request) {  
  
                LoadingPopupManager.hide();  
  
                if (status != Requester.Status.SUCCESS) {  
                    return;  
                }  
  
                detailTable.appendRow({});  
                detailTable.appendKeyColumn({content: '교과목 수', css: {'width' : '33.3%'}});  
                detailTable.appendKeyColumn({content: '참여학과 수', css: {'width' : '33.3%'}});  
                detailTable.appendKeyColumn({content: '이수학생 수(명)', css: {'width' : '33.3%'}});  
                detailTable.appendRow({});  
                detailTable.appendValueColumn({content: Lia.pcd(0,data,'body','total_lecture_count'), css: {'text-align' : 'center'}});  
                detailTable.appendValueColumn({content: Lia.pcd(0,data,'body','total_department_count'), css: {'text-align' : 'center'}});  
                detailTable.appendValueColumn({content: Lia.pcd(0,data,'body','student_count'), css: {'text-align' : 'center'}});  
  
                page.countComboBox.setValue(PageManager.pcd(20, 'count2'));  
  
                // 검색결과 - 테이블  
                var contentPanel = new Triton.Panel({  
                    appendTo: appendTo,  
                    theme: Triton.Panel.Theme.List  
                });  
  
                var detailResultListTable = new Triton.ListTable({  
                    appendTo: contentPanel,  
                });  
  
                detailResultListTable.appendHeaderRow({});  
                detailResultListTable.appendHeaderColumn({  
                    css: {width: '60px'},  
                    content: new Triton.CheckBox({  
                        addClass: 'comparison_division_lecture_header_check_box',  
                        listTable: detailResultListTable,  
                        onChecked: function (value) {  
  
                            var jThis = $(this);  
  
                            var triton = jThis.getTriton();  
                            var options = triton.getOptions();  
  
                            var listTable = Lia.p(options, 'listTable');  
  
                            var jCheckBox = listTable.find('.comparison_division_lecture_check_box');  
  
                            for (var i = 0, l = jCheckBox.length; i < l; i++) {  
                                jCheckBox.eq(i).getTriton().setValue(value, true);  
                            }  
                        }  
                    })  
                })  
                detailResultListTable.appendHeaderColumn({  
                    content: '연번',  
                    css: {'width': PolarisSettings.ListTableWith.ROW_NUMBER}  
                });  
                detailResultListTable.appendHeaderColumn({content: '연도', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '학기', css: {width: '100px'}});  
                detailResultListTable.appendHeaderColumn({content: '교과명', css: {width: '300px'}});  
                detailResultListTable.appendHeaderColumn({content: '교과번호'});  
                detailResultListTable.appendHeaderColumn({content: '개설학과', css: {width: '300px'}});  
                detailResultListTable.appendHeaderColumn({content: '지도교수', css: {width: '300px'}});  
  
                //var list1 = DummyData.listData(PageManager.p('department'));  
                var list = Lia.p(data,'body', 'list');  
                if (Array.isNotEmpty(list)) {  
  
                    for (var k = 0, j = list.length; k < j; k++) {  
  
                        var item = list[k];  
  
                        var term = '-'  
                        switch (Lia.p(item, 'term')) {  
                            case '1': term = '1학기'; break;  
                            case '2': term = '2학기'; break;  
                            case '3': term = '여름방학'; break;  
                            case '4': term = '겨울방학'; break;  
                        }  
  
                        detailResultListTable.appendRow({item :item});  
                        detailResultListTable.appendColumn({  
                            content :  new Triton.CheckBox({  
                                addClass: 'comparison_division_lecture_check_box',  
                                listTable: detailResultListTable,  
                                onChecked: function (val) {  
  
                                    var jThis = $(this);  
                                    var triton = jThis.getTriton();  
                                    var options = triton.getOptions();  
                                    var listTable = Lia.p(options, 'listTable');  
  
                                    var checked = true;  
                                    var jCheckBox = listTable.find('.comparison_division_lecture_check_box');  
                                    var l = jCheckBox.length;  
                                    if (l == 0) {  
                                        checked = false;  
                                    } else {  
  
                                        for (var i = 0; i < l; i++) {  
  
                                            if (!jCheckBox.eq(i).getTriton().getPressed()) {  
                                                checked = false;  
                                                break;  
                                            }  
                                        }  
                                    }  
  
                                    var jHeaderCheckBox = listTable.find('.comparison_division_lecture_header_check_box');  
                                    jHeaderCheckBox.getTriton().setPressed(checked, true);  
                                }  
                            })  
                        })  
                        detailResultListTable.appendColumn({content: Lia.p(item, 'row_number')});  
                        detailResultListTable.appendColumn({content: Lia.p(item, 'year')});  
                        detailResultListTable.appendColumn({content: term});  
                        detailResultListTable.appendColumn({content: Lia.p(item, 'name')});  
                        detailResultListTable.appendColumn({content: Lia.p(item, 'number')});  
                        detailResultListTable.appendColumn({content: Lia.pcd("-",item, 'department')});  
                        detailResultListTable.appendColumn({content: Lia.pcd("-",item, 'emp_nm')});  
  
                        /*  var startDate = '';  
  
                          var year = RandomNumberData.randomNumber(2022, 2022);                          var month = RandomNumberData.randomNumber(12);                          if (month < 10) {                              month = '0' + month;                          }                          var day = RandomNumberData.randomNumber(30);                          if (day < 10) {                              day = '0' + day;                          }  
                          startDate = year + '-' + month + '-' + day  
                          detailResultListTable.appendColumn({                              content: startDate                          });  
                          var endDate = '';  
                          var year2 = RandomNumberData.randomNumber(2022, 2022);                          var month2 = RandomNumberData.randomNumber(12);                          if (month2 < 10) {                              month2 = '0' + month2;                          }                          var day2 = RandomNumberData.randomNumber(30);                          if (day2 < 10) {                              day2 = '0' + day2;                          }  
                          endDate = year2 + '-' + month2 + '-' + day2  
                          detailResultListTable.appendColumn({                              content: endDate                          });  
                          detailResultListTable.appendColumn({content: Lia.p(item1, '지도교수')});  
                          detailResultListTable.appendColumn({content: Lia.p(item1, '수강필요과목')});  
                          detailResultListTable.appendColumn({                              content: RandomNumberData.randomNumber(6)                          });*/  
                    }  
  
                } else {  
  
                    new Triton.Section({  
                        appendTo: contentPanel,  
                        theme: Triton.Section.Theme.ListMessage,  
                        content: '표시될 항목이 없습니다.'  
                    })  
                }  
  
                var pagerSection = new Triton.Section({  
                    appendTo: contentPanel,  
                    theme: Triton.Section.Theme.Pager  
                });  
  
                new Triton.Pager({  
                    appendTo: pagerSection,  
                    'pageNumber': Lia.pd(1, parameterMap, 'page2'),  
                    'countPerPage': Lia.pd(20, parameterMap, 'count2'),  
                    'totalCount': page.responseTotalCount = Lia.p(data, 'body', 'total_count'),  
                    'onPageSelected': function (pageNumber) {  
                        PageManager.goCurrentPageWithCurrentParameterMap({page2: pageNumber});  
                    }  
                });  
  
            });  
  
  
        },  
  
        onRelease: function (j) {  
        }  
    };  
})();
```