```java

   private List<Long> findAllDepartments() {
        List<Long> departmentSeqList = new ArrayList<>();
        departmentSeqList = select(department.departmentSeq)
                .from(department)
                .fetch();

        return departmentSeqList;
    }
    public Page<MemberInfoResponse> findMemberAndDepartmentPageBySearch(Long departmentSeq, String searchKeyword, MemberAndDepartmentSearchType memberAndDepartmentSearchType, Pageable pageable) {

        // 1. 하위 부서를 찾기 위한 재귀 쿼리
        List<Long> departmentSeqList = new ArrayList<>();

        if(departmentSeq == null) {
            departmentSeqList = findAllDepartments();
        } else {
            departmentSeqList = findAllChildDepartments(departmentSeq);
        }

        // 2. 검색어 조건 설정
        BooleanBuilder searchBuilder = new BooleanBuilder();

        if (searchKeyword == null) {
            searchKeyword = "";
        }

        switch (memberAndDepartmentSearchType) {
            case EMAIL:
                searchBuilder.and(user.userEmail.like('%' + searchKeyword + '%'));
                break;
            case TEL_NO:
                searchBuilder.and(user.userTelno.like('%' + searchKeyword + '%'));
                break;
            case ALL:
                searchBuilder.and(user.userId.like('%' + searchKeyword + '%'))
                        .or(user.userNm.like('%' + searchKeyword + '%'))
                        .or(user.userEmail.like('%' + searchKeyword + '%'))
                        .or(user.userTelno.like('%' + searchKeyword + '%'));
                break;
        }

        BooleanBuilder conditionBuilder = new BooleanBuilder();
        conditionBuilder.and(user.delYn.eq("N").or(user.delYn.isNull()).or(user.whdwlYn.eq("N")));
//        conditionBuilder.and(searchBuilder);
//        if (!departmentSeqList.isEmpty()) {
//            conditionBuilder.and(user.departmentSeq.in(departmentSeqList));
//        }

        Long totalCount =
                select(user.userSeq.countDistinct())
                        .from(user)
                        .where(conditionBuilder)
                        .fetchOne();

        if (totalCount == null) {
            totalCount = 0L;
        }
        
        List<MemberInfoResponse> pagingList =
                select(Projections.bean(MemberInfoResponse.class,
                        user.userTypeEnu,
                        user.userSeq,
                        user.userId,
                        user.userNm,
                        user.userBirth,
                        user.userTelno,
                        user.userEmail,
                        user.whdwlReason,
                        user.hireDt,
                        user.resignDt,
                        user.whdwlYn,
                        user.userEngNm,
                        Projections.bean(DepartmentResponse.class,
                                user.departmentSeq,
                                department.deptNm).as("department"),
                        Projections.bean(PositionResponse.class,
                                user.positionSeq,
                                position.positionNm).as("position")
                ))
                        .from(user)
                        .innerJoin(department).on(user.departmentSeq.eq(department.departmentSeq))
                        .innerJoin(position).on(user.positionSeq.eq(position.positionSeq))
                        .where(conditionBuilder)
                        .orderBy(user.userId.asc())
                        .offset(pageable.getOffset()) /*offset*/
                        .limit(pageable.getPageSize())/*limit*/
                        .fetch();

        for (MemberInfoResponse memberInfoResponse : pagingList) {
            // select authrtseq, nm, expln, ...
            List<AuthorityInfoResponse> authList = select(Projections.bean(AuthorityInfoResponse.class,
                    auth.authrtSeq,
                    auth.authrtNm,
                    auth.authrtExpln,
                    auth.authrtCd,
                    auth.sortNo,
                    auth.useYn
            ))
                    .from(userAuth)
                    .join(userAuth.auth, auth)
                    .where(userAuth.userSeq.eq(memberInfoResponse.getUserSeq()))
                    .fetch();
            String authNms = authList.stream().map(AuthorityInfoResponse::getAuthrtNm)
                    .collect(Collectors.joining(", "));
            memberInfoResponse.setAuthNm(authNms);

            // 리스트.
            memberInfoResponse.setAuthList(authList);
        }

        return new PageImpl<>(pagingList, pageable, totalCount == null ? 0 : totalCount);
    }


```