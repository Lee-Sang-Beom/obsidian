
#### 1. User Type 재정의하기

- nextauth는 기본적으로 `DefaultUser`라는 인터페이스를 상속받는 `User`라는 Interface가 존재한다.
```ts
export interface DefaultUser {
  id: string
  name?: string | null
  email?: string | null
  image?: string | null
}

// 여기!
export interface User extends DefaultUser {}
```

- nextauth에서 관리되어야 할 `User` Interface를 재정의하기 위해서는 `types/next-auth.d.ts`에서 수정을 진행해야 한다.
```tsx
// 본인은 파일경로를 다음과 같이 지정함: types/nextAuth/next-auth.ts
import NextAuth from "next-auth";

interface AuthListType {
  authrtNm: string;
  authrtExpln: string;
}

// next-auth 모듈의 기본 타입을 확장한다.
// NextAuth에서 제공하는 `User` 및 `Session` type을 확장한다.
declare module "next-auth" {
  interface User {
    userSeq: number;
    userNm: string;
    userBirth: string | null;
    userTelno: string;
    userSxdcEnu: string | null;
    userId: string;
    userEmail: string;
    userTypeEnu: {
      type: "NORMAL" | "ADMIN";
      name: string;
    };
    jwtAuthToken: string;
    jwtRefreshToken: string;
  }

  // Session의 user필드 type은 User
  interface Session {
    user: User;
  }
}

// JWT (JSON Web Token) 모듈에서 사용되는 `JWT` 인터페이스를 확장한다.
// 확장한 `JWT` 인터페이스는 `user` 필드를 가지며, 이 필드는 위에서 정의한 `User` 타입을 가지게 된다.
declare module "next-auth/jwt" {
  // jwt의 user필드 type은 User
  interface JWT {
    user: User;
  }
}

```


#### 2. 환경변수 설정하기

1. `NEXTAUTH_URL`
	- 사이트의 **정규 URL**을 나타내며, **애플리케이션의 주소를 설정**하는 데 사용된다.
	- Production 환경으로 배포할 때 `NEXTAUTH_URL` 환경 변수를 사이트의 정규 URL로 설정해야 함을 나타낸다
		- . 즉, 배포할 사이트의 주소를 `NEXTAUTH_URL`에 지정하면 된다.

```null

# 프로젝트 구현을 위한 환경변수
NEXT_PUBLIC_HOST=...
NEXT_VWORLD_LOCAL_SECRET=...
NEXT_VWORLD_DEV_SECRET=...

# next-auth 사용을 위한 환경변수
NEXTAUTH_URL=...
NEXTAUTH_SECRET=...
```

2. `NEXTAUTH_SECRET`
	- `secret`은 `token`을 해싱하고 쿠키를 서명하며 암호 키를 생성하는 데 사용되는 무작위 문자열이다.
		- 이 값을 알고 있는 사람만이 토큰을 올바르게 해독할 수 있으며, 이를 통해 사용자 세션의 무결성을 유지할 수 있다.
		- `secret`의 기본값은 `options` 객체의 **SHA 해시 문자열**이다. 이것은 토큰을 해싱하고 쿠키를 서명하는 데 사용된다.

	- `secret`은 명시적으로 지정되지 않으면 기본값으로 설정되어 필수 사항은 아니지만, 사용자 세션을 무효화하는 것을 피하기 위해 명시적으로 값을 지정하는 것이 강력히 권장된다.

	- 요약하면, `secret`은 보안적인 목적을 위해 사용되는 무작위 문자열로, 애플리케이션의 보안성을 강화하고 사용자 세션의 무결성을 유지하는 데 중요한 역할을 한다.

- **위 2가지 환경변수는 꼭 빌드 시, 입력하도록 하자.**


#### 3. 미들웨어(`middleware.ts | .js`) 설정하기

- Next.js의 미들웨어 파일은`(middleware.ts|.js)`, 클라이언트 요청이 완료되기 전에 서버 측에서 실행되는 함수이다.
	- **클라이언트의 요청이 서버에 도착하기 전에 실행**되어, 서버가 **요청을 처리하기 전에 특정 작업을 할 수 있도록 실행되는 파일**이다.
	- 요청이나 응답을 변경하거나, 추가적인 로직을 실행하거나, redirection을 처리하거나, 요청/응답 헤더를 수정하는 등의 작업을 할 수 있다.
	- 라우트가 렌더링되기 이전에 실행되어, 사용자 정의 서버 측 로직을 구현하는 데에 유용하다.

- 파일은 프로젝트 root에 위치하여, `middleware.ts` 혹은 `middleware.js`의 이름을 가져야 한다.
![[middleware.ts.png]]

- nextautj

