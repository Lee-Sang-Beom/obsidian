
#### 1. 로그인 구현하기

- 해당 프로젝트에서는, 어디에서든 로그인할 수 있도록 **헤더**에 로그인 버튼을 두되, 로그인 성공 시 `/` 위치로 이동하게끔 구현하였다.
	- `vworld` map을 출력하기 위해서는, 페이지 이동 시, 전체 새로고침되어야 하는 문제가 있었기에 routing은 `window` 객체를 사용하였다

- 먼저 필요변수를 다음과 같이 선언하였다. (`id, pw`)
```tsx
// ...

const [userId, setUserId] = useState<string>("");
const [userPw, setUserPw] = useState<string>("");

//...
```

- 다음으로 `@radix-ui/react-dialog`를 필요에 맞게 확장한 별도의 컴포넌트인 `<Dialog/>`를 사용하여, 팝업 내 로그인 Form을 띄울 수 있도록 했다.
```tsx
 <Dialog
              open={loginPopup}
              width="20%"
              setOpen={(open) => {
                setLoginPopup(open);
              }}
              openTriggerComponent={
                <button
                  className="tbtn_login"
                  type="button"
                  title="로그인하기"
                >
                  관리자 로그인
                </button>
              }
              title={"로그인"}
            >
              <>
                <div className={style.m_login}>
                  <ul className={style.m_login_ul}>
                    <li>
                      <Input
                        labelTitle="아이디"
                        size={"md"}
                        id={"user_id"}
                        value={userId}
                        onChange={(e) => {
                          setUserId(e.currentTarget.value);
                        }}
                        placeholder="아이디 입력"
                      ></Input>
                    </li>
                    <li>
                      <Input
                        id={"user_pw"}
                        size={"md"}
                        type={"password"}
                        labelTitle="비밀번호"
                        placeholder="비밀번호 입력"
                        value={userPw}
                        onChange={(e) => {
                          setUserPw(e.currentTarget.value);
                        }}
                        onKeyDown={async (e) => {
                          if (e.key === "Enter") {
                            if (!userId.length) {
                              setStatus("error");
                              setText("아이디를 입력해주세요.");
                              setIsChange(true);
                              return;
                            }
                            if (!userPw.length) {
                              setStatus("error");
                              setText("비밀번호를 입력해주세요.");
                              setIsChange(true);
                              return;
                            }
  
                            const result = await signIn("credentials", {
                              userId: userId,
                              userPswd: userPw,
                              redirect: false,
                            });
  
                            if (result) {
                              if (result.status == 200) {
                                // 지도 출력 시, 완전히 페이지가 새로고침
                                window.location.href = "/";
  
                                // router.push("/");
                                // router.refresh();
                              } else {
                                setText(
                                  "아이디와 비밀번호를 다시 확인해주세요."
                                );
                                setStatus("error");
                                setIsChange(true);
                              }
                            }
                          }
                        }}
                      />
                    </li>
                  </ul>
  
                  <button
                    type="button"
                    className={style.btn_login}
                    title={"로그인"}
                    onClick={async (e) => {
                      e.preventDefault();
  
                      if (!userId.length) {
                        setStatus("error");
                        setText("아이디를 입력해주세요.");
                        setIsChange(true);
                        return;
                      }
                      if (!userPw.length) {
                        setStatus("error");
                        setText("비밀번호를 입력해주세요.");
                        setIsChange(true);
                        return;
                      }
  
                      const result = await signIn("credentials", {
                        userId: userId,
                        userPswd: userPw,
                        redirect: false,
                      });
  
                      if (result) {
                        if (result.status == 200) {
                          window.location.href = "/";
  
                          // router.push("/");
                          // router.refresh();
                        } else {
                          setText("아이디와 비밀번호를 다시 확인해주세요.");
                          setStatus("error");
                          setIsChange(true);
                        }
                      }
                    }}
                  >
                    로그인
                  </button>
                  <div className={style.login_bot}>
                    <span className={style.al_right}>
                      <Link
                        href={"/Ma/findId"}
                        prefetch={false}
                        title="아이디 찾기 페이지 이동"
                        onClick={() => {
                          setLoginPopup(false);
                        }}
                      >
                        아이디 찾기
                      </Link>
                      <span>|</span>
                      <Link
                        href={"/Ma/findPw"}
                        prefetch={false}
                        title="비밀번호 찾기 페이지 이동"
                        onClick={() => {
                          setLoginPopup(false);
                        }}
                      >
                        비밀번호 찾기
                      </Link>
                    </span>
                  </div>
                </div>
              </>
            </Dialog>
```

- nextauth에서 제공하는 로그인 메소드는 클라이언트 측에서 호출할 수 있으며, 메소드명은 `signIn`이다.
	- OAuth의 로그인 흐름은 아래와 같은 방식으로 사용하면 된다.
```tsx
// google
<button onClick={() => signIn("google")}>로그인</button>

// email
<button onClick={() => signIn("email", { email })}>이메일로 로그인</button>
```

- 본 프로젝트에서는 `credentials`