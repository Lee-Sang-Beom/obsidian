
#### 1. 지도 부가기능 수행용도의 컴포넌트 구현을 위한 요구사항 알아보기 

- 지도 사용을 위한 필수적이라고도 할 수 있는 부가 기능 버튼을 만들어보자. 만들 기능은 아래와 같다.
	1. 현재 위치로 지도 포커스 이동하기
	2. 확대하기
	3. 축소하기
	4. 일반지도 확인하기
	5. 위성지도 확인하기

- 컴포넌트 구현 결과의 이미지는 아래와 같다.
![[MapControl Component.png]]


#### 2. `<MapControl/>` 컴포넌트 구현하기

##### 2-1. `props`

- 컨트롤 대상인 모든 map을 전달하여, 한 번의 클릭으로 모든 map이 똑같은 동작결과가 나오도록 구현하기 위해 아래와 같이 `props`를 전달한다.
```tsx
<MapControl map={map} map2={firemap} map3={explmap} map4={dfsnmap} />
```

```tsx
interface IProps {
  map: any;
  map2?: any;
  map3?: any;
  map4?: any;
  style?: React.CSSProperties;
}

export function MapControl({ map, map2, map3, map4, style }: IProps) {
	// ...
	
	return (
		{/* ... */}
	)
}
```

##### 2-2. 필요 `state`

- 필요 `state`는 아래와 같다.
	- 현재 컴포넌트가 마운트되었는지를 확인하는 `isMounted`
	- 현재 선택된 지도 `view`가 일반인지 위성인지를 구분하기 위한 `curMap`
```tsx
// 선택된 지도의 표시상태가 일반인지 위성인지를 구분 : default: 일반(base-vworld)
const [curMap, setcurMap] = useState<string>("base-vworld");

// 현재 컴포넌트가 마운트되었는지를 확인
// map 객체가 있으면 useEffect callback func에서 setIsMounted Dispatch동작을 수행한다.
const [isMounted, setIsMounted] = useState(false);

```

##### 2-3. 동작: 레이어 변경

- `button element`를 return하는 부분은 아래와 같다.
	- `curMap` 상태에 따라, className이 바뀌면서 선택된 `view layer`가 무엇인지 시각적으로 확인 가능하다.

- 이 동작은 해당 컴포넌트가 **마운트**되고, 정상적으로 이벤트를 받을 수 있는 상태에서 동작해야 한다.
```tsx
<div className={styles.version_wrap}>
  <button
	className={`${styles.version_btn} ${
	  curMap === "base-vworld" ? styles.curMap : ``
	}`}
	onClick={() => {
	  // 컴포넌트 is Mounted?
	  if (isMounted) {
		setcurMap("base-vworld");
	  }
	}}
	title="일반 지도로 뷰 변경"
  >
	일반
  </button>
  <button
	className={`${styles.version_btn} ${
	  curMap === "base-vworld-Satellite" ? styles.curMap : ``
	}`}
	onClick={() => {
	  // 컴포넌트 is Mounted?
	  if (isMounted) {
		setcurMap("base-vworld-Satellite");
	  }
	}}
	title="위성 지도로 뷰 변경"
  >
	위성
  </button>
</div>
```

- 다음으로, 사용자가 `일반/위성` 버튼을 클릭했을 때, 지도의 `Layer`를 바꿔주는 작업이 요구된다.
	- `curMap` state가 바뀔 때마다, 자동으로 수행될 수 있도록 `useEffect()`을 사용한다.
	- 여기서는, 사용자가 선택한 `일반/위성`에 해당하는 `Layer`를 지도에 쌓아주고, 기존의 `Layer`는 삭제하는 방법을 사용했다.
```tsx
  // 레이어 변경 이벤트 - 일반/위성 전환
  useEffect(() => {
    if (isMounted) {
      // 사용자가 선택한 지도타입이 '일반'인가?
      if (curMap === "base-vworld") {
        // '일반'에 해당하는 'base-vworld' layer 추가
        map.addLayer(getVWorldLayer());
        
        // '일반'에 해당하지 않는 모든 레이어 제거
        map.getAllLayers().map((m: any) => {
          if (
            m.get("name") &&
            (m.get("name") === "base-vworld-Satellite" ||
              m.get("name") === "base-vworld-hybrid")
          ) {
            map.removeLayer(m);
          }
        });

        if (map2 && map3 && map4) {
          map2.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld-Satellite" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map2.removeLayer(m);
            }
          });
          map3.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld-Satellite" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map3.removeLayer(m);
            }
          });
          map4.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld-Satellite" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map4.removeLayer(m);
            }
          });
          map2.addLayer(getVWorldLayer());
          map3.addLayer(getVWorldLayer());
          map4.addLayer(getVWorldLayer());
        }
      } else if (curMap === "base-vworld-Satellite") {
        // '위성'에 해당하는 'base-vworld-Satellite' layer 추가
        map.addLayer(getVWorldSatelliteLayer());

		// '위성'에 해당하지 않는 layer 제거
        map.getAllLayers().map((m: any) => {
          if (
            m.get("name") &&
            (m.get("name") === "base-vworld" ||
              m.get("name") === "base-vworld-hybrid")
          ) {
            map.removeLayer(m);
          }
        });

        if (map2 && map3 && map4) {
          map2.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map2.removeLayer(m);
            }
          });
          map3.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map3.removeLayer(m);
            }
          });
          map3.getAllLayers().map((m: any) => {
            if (
              m.get("name") &&
              (m.get("name") === "base-vworld" ||
                m.get("name") === "base-vworld-hybrid")
            ) {
              map3.removeLayer(m);
            }
          });
          map2.addLayer(getVWorldSatelliteLayer());
          map3.addLayer(getVWorldSatelliteLayer());
          map4.addLayer(getVWorldSatelliteLayer());
        }
      } else {
       //...
      }
    }
  }, [curMap]);
```


#### 2-4. 동작: 확대 및 축소

- `button element`를 return하는 부분은 아래와 같다.
	- 마찬가지로 이 동작은 해당 컴포넌트가 **마운트**되고, 정상적으로 이벤트를 받을 수 있는 상태에서 동작해야 한다.
```tsx
 <div className={styles.zoom_wrap}>
          <button
            className={styles.zoom_in}
            title={"확대하기"}
            onClick={() => {
              if (isMounted) {
                const zoom = map.getView().getZoom() + 1;
                map.getView().animate({
                  zoom,
                  duration: 500,
                });
              }
            }}
          >
            <RiAddFill size={22} role="img" aria-label="더하기 아이콘" />
          </button>

          <button
            className={styles.zoom_out}
            title={"축소하기"}
            onClick={() => {
              if (isMounted) {
                const zoom = map.getView().getZoom() - 1;
                map.getView().animate({
                  zoom,
                  duration: 500,
                });
              }
            }}
          >
            <RiSubtractFill size={22} role="img" aria-label="빼기 아이콘" />
          </button>
        </div>
```

#### 2-5. 동작: 현재 위치로 지도 포커싱