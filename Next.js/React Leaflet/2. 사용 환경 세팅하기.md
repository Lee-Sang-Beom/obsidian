
#### 1. 설치 라이브러리 알아보기

- 본 Next.js and React Leaflet 사용해보기 시리즈에서는 아래의 라이브러리를 사용한다.
	- 아래 이미지는 `package.json` 의 일부이다.
![[package.json.png]]


#### 2. page.tsx 파일 구성하기

- Next.js는 기본적으로 SSR 방식을 사용하는데, **SSR 방식의 가장 큰 특징은 서버에서 컴포넌트를 해석한 다음, 요청이 들어온 매 페이지마다 즉시 렌더링 가능한 HTML 파일을 만들어 클라이언트로 전송한다는 점이다.** 
	- 이후 클라이언트는 자바스크립트 번들을 다운로드 받아, 사용자 조작에 대한 이벤트를 수행할 수 있도록 한다.
	- 이 때, 서버에서 **컴포넌트를 해석**하는 과정에서 `react-leaflet` 라이브러리 내에서 `window`객체를 참조한다.
		- 당연히 서버 측에서는 `window` 객체를 참조할 수 없으므로 아래와 같은 ReferenceError가 등장한다.

```tsx
import MapComponent from "@/components/Map/MapComponent";

export default function Page() {
  return <MapComponent />;
}
```
![[Pasted image 20240613152244.png]]

- 그럼 어떻게 해야할까?
	- 해당 문제는 서버 측에서 `window`객체를 참조하려 하여 발생하는 오류이다.
	- 따라서, 해당 페이지에서는 SSR 방식을 사용하여 서버 측에서 `window`객체에 접근하지 못하도록 해야 한다는 것이다.
	- 그래서, 아래와 같이 `dynamic import`를 사용하여, 모듈을 빌드 타임이 아닌 런타임에 불러오도록 했다.
```tsx
import dynamic from "next/dynamic";

const DynamicMapComponent = dynamic(
  () => import("@/components/Map/MapComponent"),
  {
    ssr: false,
  }
);

export default function Page() {
  return <DynamicMapComponent />;
}
```


#### 3. react-leaflet import 및 지도 화면 띄워보기

- 먼저, 구현을 위해 참조한 문서는 [다음](https://leafletjs.com/reference.html#map-methods-for-getting-map-state)과 같다.

- `react-leaflet`을 사용하여, 웹 페이지에 지도를 띄우기 위해서는 `MapContainer` 컴포넌트를 사용해야 한다.
	- 예시 코드는 아래와 같다.
```tsx
const MapComponent = () => {
  const mapRef = useRef<any>(null);
  const position = { lat: 35.22783, lng: 128.679315 };

  return (
    <>
      <div className="map_wrap">
        <MapContainer
          // https://leafletjs.com/reference.html#map-methods-for-getting-map-state
          center={position}
          zoom={DEFAULT_LEAFLET_ZOOM_LEVEL}
          minZoom={DEFAULT_LEAFLET_ZOOM_MIN_ZOOM}
          maxZoom={DEFAULT_LEAFLET_ZOOM_MAX_ZOOM}
          zoomControl={true}
          scrollWheelZoom={true}
          closePopupOnClick={true}
          ref={mapRef}
        >
         // ...
        </MapContainer>
      </div>
    </>
  );
};
```

- 여기서, `M`