
#### 1. 프로젝트 배경 설명

- 이번에, `map obj`는 화학물질의 정보를 기반으로 **화재**, **폭발**, **누출** 시 어떤 영역에 피해가 갈 것인가를 시각적으로 확인할 수 있도록 하는 데에 사용된다.
	- 정보 입력에는 **3개의 STEP**이 있고, 마지막 STEP은 결과를 확인하고 저장하는 과정을 거친다.
	- 이번에 진행할 내용은은 결과를 시각적으로 보여주기 위해, 결과 지도를 출력하는 **마지막 STEP**에 대해 다뤄볼 것이다.

```tsx
"use client";

import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import AddSimulationStep1 from "./Step1/AddSimulationStep1";
import AddSimulationStep2 from "./Step2/AddSimulationStep2";
import AddSimulationStep3 from "./Step3/AddSimulationStep3";
import AddSimulationStep4 from "./Step4/AddSimulationStep4";
import SimulationTab from "../SimulationTab";
import { useAutoAlert } from "@/hooks/Alert/useAutoAlert";
import { EnumType } from "@/types/common/commonType";
import {
  ChemSubstanceAvgResponse,
  RegisterDmgeEfctEvlCommand,
  RegisterDmgeEfctStdCommandStep1,
  RegisterDmgeEfctStdCommandStep2,
  RegisterDmgeEfctStdCommandStep3,
  SimulateCommand,
  SimulateResultResponse,
} from "@/types/sub/Ca/Simulation/Simulation";
import moment from "moment";

interface IProps {
  selectCompanyTypeDataList: EnumType<string>[];
  selectChemTypeDataList: EnumType<string>[];
}
export default function AddSimulationClient({
  selectCompanyTypeDataList,
  selectChemTypeDataList,
}: IProps) {
  const { setIsChange, setText, setStatus } = useAutoAlert();

  /**
   * 전체 Step에서 공통으로 관리되는 State
   * @step : 현재 위치한 단계 (0~3)
   * @availableMoveStep : 자유로이 전환 이용 가능한 최대 단계 (0~3)
   */
  const [step, setStep] = useState<number>(0);
  const [availableMoveStep, setAvailableMoveStep] = useState<number>(0);

  /**
   * @step1 과정
   */
  const {
    register: step1Register,
    formState: { errors: step1Errors },
    getValues: step1GetValues,
    setValue: step1SetValue,
    watch: step1Watch,
    trigger: step1Trigger,
  } = useForm<RegisterDmgeEfctStdCommandStep1>({
    mode: "all",
    defaultValues: {
      companySeq: undefined,
      companyNm: "",
      companyRprsvNm: "",
      companyBizNo: "",
      companyTpbizNm: "",
      companyRoadNmAddr: "",
      companyTelNo: "",
      fireYn: "N",
      explYn: "N",
      dfsnYn: "N",

      companyLdar: 0,
      companyGeom: "",

      lat: null,
      lot: null,
    },
  });
  const [selectStep1Type, setSelectStep1Type] = useState<
    "업체선택" | "사고위치선택"
  >("업체선택");
  const [selectLocation, setSelectLocation] = useState<
    | {
        lot: number;
        lat: number;
      }
    | undefined
  >(undefined);
  const [isStep1Success, setIsStep1Success] = useState<boolean>(false);

  /**
   * @step2 과정
   */
  const {
    register: step2Register,
    formState: { errors: step2Errors },
    getValues: step2GetValues,
    setValue: step2SetValue,
    watch: step2Watch,
    trigger: step2Trigger,
  } = useForm<RegisterDmgeEfctStdCommandStep2>({
    mode: "all",
    defaultValues: {
      chemSeq: undefined,
      casNo: "",
      mttrnmkor: "",
      mttrnmeng: "",
      // 성상
      i0202: "",
      // 색상
      i0204: "",
      // 냄새
      i04: "",
      // 인화점
      i14: "",
      // 밀도
      i26: "",
      // 점도
      i36: "",
      // 자연발화온도
      i32: "",
      // 저장탱크용량
      strgTnkSz: "",
      // 누출량 - default 탱크 설계용량과 동일
      lkgSz: "",
      // 누출시간(초) - default 600초
      lkgTime: 0,
      // 분자량
      mass: "",
      // pac2
      pac2: "",
      // pacUnit
      pacUnit: "",
      // hcomb
      hcomb: "",
    },
  });
  const [isStep2Success, setIsStep2Success] = useState<boolean>(false);

  // 추가 0322
  const [chemAvg, setChemAvg] = useState<ChemSubstanceAvgResponse | undefined>(
    undefined
  );

  /**
   * @step3 과정
   */
  const {
    register: step3Register,
    formState: { errors: step3Errors },
    getValues: step3GetValues,
    setValue: step3SetValue,
    watch: step3Watch,
    trigger: step3Trigger,
  } = useForm<RegisterDmgeEfctStdCommandStep3>({
    mode: "all",
    defaultValues: {
      // 기준일시
      stdDt: "",
      // 기온
      tmpr: "",
      // 습도
      hmdt: "",
      // 풍속
      wsd: "",
      wsd1h: "",
      wsd4h: "",
      wsd8h: "",
      // 풍향
      vec: "",
      // 대기 안정도
      atmsStblPct: "",
    },
  });
  const [isStep3Success, setIsStep3Success] = useState<boolean>(false);

  /**
   * @step4 과정
   * @simulateCommandData : step3에서 시뮬레이션을 위해 최종 전송한 데이터
   * @simulationRes : step3 시뮬레이션 결과
   * @reactHookForm : step4 최종 등록 post용도
   */
  const {
    register: step4Register,
    formState: { errors: step4Errors },
    getValues: step4GetValues,
    setValue: step4SetValue,
    watch: step4Watch,
    trigger: step4Trigger,
  } = useForm<RegisterDmgeEfctEvlCommand>({
    mode: "all",
    defaultValues: undefined,
  });

  const [simulateCommandData, setSimulateCommandData] = useState<
    SimulateCommand | undefined
  >(undefined);

  const [simulationRes, setSimulationRes] = useState<
    SimulateResultResponse | undefined
  >(undefined);
  const [isStep4Success, setIsStep4Success] = useState<boolean>(false);
  useEffect(() => {
    if (
      step === 2 &&
      !moment(step3Watch("stdDt"), "YYYY-MM-DD HH:mm", true).isValid()
    ) {
      step3SetValue("stdDt", moment(new Date()).format("YYYY-MM-DD HH:mm"));
    }
  }, [step]);

  return (
    <>
      <SimulationTab
        tabTitle={[
          "(STEP 1). 기준정보 입력",
          "(STEP 2). 물질 및 누출정보 입력",
          "(STEP 3). 기상정보 입력",
          "(STEP 4). 피해영향범위 평가",
        ]}
        step={step}
        setStep={setStep}
        availableMoveStep={availableMoveStep}
        isStep1Success={isStep1Success}
      >
        <AddSimulationStep1
          // common
          setStep={setStep}
          setAvailableMoveStep={setAvailableMoveStep}
          selectCompanyTypeDataList={selectCompanyTypeDataList}
          // react-hook-form step1
          register={step1Register}
          getValues={step1GetValues}
          setValue={step1SetValue}
          watch={step1Watch}
          trigger={step1Trigger}
          // 추가 0320
          selectStep1Type={selectStep1Type}
          setSelectStep1Type={setSelectStep1Type}
          selectLocation={selectLocation}
          setSelectLocation={setSelectLocation}
          // react-hook-form step2
          step2SetValues={step2SetValue}
          // step1,2 is success?
          setIsStep1Success={setIsStep1Success}
          setIsStep2Success={setIsStep2Success}
          // set step4
          setSimulationRes={setSimulationRes}
        />
        <AddSimulationStep2
          // common
          setStep={setStep}
          setAvailableMoveStep={setAvailableMoveStep}
          selectChemTypeDataList={selectChemTypeDataList}
          // react-hook-form step1
          step1GetValues={step1GetValues}
          selectStep1Type={selectStep1Type}
          // react-hook-form step2
          register={step2Register}
          getValues={step2GetValues}
          setValue={step2SetValue}
          watch={step2Watch}
          trigger={step2Trigger}
          // 추가 0322
          chemAvg={chemAvg}
          setChemAvg={setChemAvg}
          // step2 is success?
          setIsStep2Success={setIsStep2Success}
          setIsStep3Success={setIsStep3Success}
          // set step4
          setSimulationRes={setSimulationRes}
        />
        <AddSimulationStep3
          // common
          step={step}
          setStep={setStep}
          setAvailableMoveStep={setAvailableMoveStep}
          // react-hook-form step1
          step1GetValues={step1GetValues}
          // react-hook-form step2
          step2GetValues={step2GetValues}
          // react-hook-form step3
          register={step3Register}
          getValues={step3GetValues}
          setValue={step3SetValue}
          watch={step3Watch}
          trigger={step3Trigger}
          // step3 is success?
          isStep1Success={isStep1Success}
          isStep2Success={isStep2Success}
          isStep3Success={isStep3Success}
          setIsStep3Success={setIsStep3Success}
          // set step4
          setSimulationRes={setSimulationRes}
          setSimulateCommandData={setSimulateCommandData}
        />
        <AddSimulationStep4
          // response
          simulationRes={simulationRes}
          // react-hook-form step1~3
          step1GetValues={step1GetValues}
          step2GetValues={step2GetValues}
          step3GetValues={step3GetValues}
          // 0321 추가
          selectStep1Type={selectStep1Type}
          selectLocation={selectLocation}
          setSelectLocation={setSelectLocation}
          // react-hook-form step4
          register={step4Register}
          getValues={step4GetValues}
          setValue={step4SetValue}
          watch={step4Watch}
          trigger={step4Trigger}
          simulateCommandData={simulateCommandData}
        />
      </SimulationTab>
    </>
  );
}

```