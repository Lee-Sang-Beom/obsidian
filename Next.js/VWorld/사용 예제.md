
```tsx
"use client";


import styles from "./ChemiMap.module.scss";
import MapContext from "@/utils/map/mapContext";
import { useContext, useEffect, useState } from "react"
  

import { returnSettingShelterMarkerVectorLayer } from "@/app/Map/TotalTest/Marker";
import { getVWorldLayer } from "@/app/Map/TotalTest/Layer";
import { MapControl } from "@/app/Map/TotalTest/MapControl";
import MapSide from "@/components/common/MapSide/MapSide";
import { useRouter } from "next/navigation";
import {
  AdmVO,
  SearchShelterCommand,
  ShelterDetailResponse,
} from "@/types/sub/Sm/SysShelter";

import { Session } from "next-auth";
import { chemicalSelectSearchFilter } from "@/types/common/filter/filter";
import { SearchChemCommand } from "@/types/sub/Sm/SysChemical";
import { ApiResponse, TablePageResponse } from "@/types/common/commonType";
import { useShelterList } from "@/hooks/sub/Sm/useShelterList";
import { useAutoAlert } from "@/hooks/Alert/useAutoAlert";
import { commonSelectType } from "@/components/common/CommonSelect/CommonSelect";
interface IProps {

  sigunguList: AdmVO[];

  session: Session | null;

}

export default function ChemiMap({ sigunguList, session }: IProps) {

  const { setIsChange, setText, setStatus } = useAutoAlert();

  

  const { mapObj } = useContext<any>(MapContext);

  const { map } = mapObj;

  

  const [isMounted, setIsMounted] = useState(false);

  

  // 대피소 마커를 만들기 위한 데이터 리스트

  const [shelterMarkerList, setShelterMarkerList] = useState<

    ShelterDetailResponse[]

  >([]);

  

  // 대피소 마커

  const [shelterMarker, setShelterMarker] = useState<any | undefined>(

    undefined

  );

  

  // 리스트 닫기

  const [open, setOpen] = useState<boolean>(true);

  

  // 활성화된 탭 인덱스 위치

  const [activeIdx, setActiveIdx] = useState<number>(0);

  

  /**

   * 1. 화학물질 조회 (로그인 권한자 표시, 해당 화학물질 취급하는 위치(업체)표시: 바뀔수있음)

   */

  const [chemSearchType, setChemSearchType] = useState<

    "MTTRNMKOR" | "MTTRNMENG" | "CASNO" | "ALL"

  >("ALL");

  const [chemSearchKeyWord, setChemSearchKeyWord] = useState<string>("");

  const [chemSearchKeyObj, setChemSearchKeyObj] = useState<SearchChemCommand>({

    page: 0,

    size: 10,

    searchKeyWord: "",

    orderBy: "ASC",

    sort: "casNo",

    chemSearchType: "ALL",

    changwonYn: "N",

  });

  

  /**

   * 2. 취급업체 조회

   */

  

  /**

   * 3. 대피소

   */

  // 시군구 데이터

  const [sigunguFilterList, setSigunguFilterList] = useState<

    commonSelectType[]

  >([]);

  

  // default 시군구 데이터와 사용자 선택 시 state

  const [defaultSigungu, setDefaultSigungu] = useState<

    commonSelectType | undefined

  >(undefined);

  

  // 검색 키워드(대피소)

  const [shelterSearchKeyWord, setShelterSearchKeyWord] = useState<string>("");

  

  const [shelterSearchKeyObj, setShelterSearchKeyObj] =

    useState<SearchShelterCommand>({

      page: 0,

      size: 5,

      sigungu: "",

      searchKeyWord: "",

      orderBy: "DESC",

      sort: "crtrYmd",

    });

  

  const shelterQuery = useShelterList(shelterSearchKeyObj);

  

  useEffect(() => {

    if (shelterQuery.data) {

      setShelterMarkerList(shelterQuery.data.content);

    }

  }, [activeIdx, shelterSearchKeyObj, shelterQuery.data]);

  

  // 최초 렌더링 시, 대피소 기본 select 필터 데이터 세팅

  useEffect(() => {

    if (sigunguList.length) {

      const filtedCommonSelectTypeSigunguList = sigunguList.map((item) => {

        return {

          name: item.lowestAdmCodeNm,

          value: item.admCode,

          group: "",

        };

      });

  

      const filtedDefaultSelectType = filtedCommonSelectTypeSigunguList.find(

        (item) => {

          return item.name === "창원시";

        }

      );

  

      // 총 리스트

      setSigunguFilterList(filtedCommonSelectTypeSigunguList);

  

      // 디폴트

      setDefaultSigungu(filtedDefaultSelectType);

      shelterSearchKeyObj.sigungu = filtedDefaultSelectType!.name;

    }

  }, []);

  

  // 화면 첫 렌더링 시 map 초기화 및 레이어 초기화

  useEffect(() => {

    // 초기화작업

    setIsMounted(true);

  

    // 최초 로드 시, BaseLayer 추가

    const vworld = getVWorldLayer();

  

    if (map) {

      // 기존 맵 객체 존재 시, default로 작동할 BaseLayer를 map에 add

      map.addLayer(vworld);

      map.getAllLayers().map((m: any) => {

        if (

          m.get("name") &&

          (m.get("name") === "base-vworld-Satellite" ||

            m.get("name") === "base-vworld-hybrid")

        ) {

          map.removeLayer(m);

        }

        return;

      });

  

      map.on("pointermove", function (e: any) {

        const pixel = map.getEventPixel(e.originalEvent);

        const hit = map.hasFeatureAtPixel(pixel);

        map.getTarget().style.cursor = hit ? "pointer" : "";

        map.getTarget().style.zIndex = 9999;

      });

    }

  }, [map]);

  

  useEffect(() => {

    if (!isMounted || !map) {

      return;

    }

  

    if (shelterMarkerList.length) {

      map.getAllLayers().map((m: any) => {

        if (m.get("name") && m.get("name") === "shelter") {

          map.removeLayer(m);

        }

      });

  

      console.log("activeIdx : ", activeIdx);

  

      if (activeIdx == 2) {

        const newShelterMarkerVectorLayerList =

          returnSettingShelterMarkerVectorLayer(shelterMarkerList, "shelter");

  

        setShelterMarker(newShelterMarkerVectorLayerList);

        map.addLayer(newShelterMarkerVectorLayerList);

      }

    }

  }, [activeIdx, shelterMarkerList]);

  

  return (

    <div className={styles.chemimap_wrap}>

      <MapSide

        map={map}

        session={session}

        sigunguList={sigunguList}

        open={open}

        setOpen={setOpen}

        chemSearchType={chemSearchType}

        setChemSearchType={setChemSearchType}

        chemSearchKeyWord={chemSearchKeyWord}

        setChemSearchKeyWord={setChemSearchKeyWord}

        sigunguFilterList={sigunguFilterList}

        defaultSigungu={defaultSigungu}

        setDefaultSigungu={setDefaultSigungu}

        shelterSearchKeyWord={shelterSearchKeyWord}

        setShelterSearchKeyWord={setShelterSearchKeyWord}

        setShelterSearchKeyObj={setShelterSearchKeyObj}

        shelterDataList={shelterQuery.data}

        setActiveIdx={setActiveIdx}

      />

      <MapControl

        map={map}

        style={{

          left: "87%",

        }}

      />

      <div id="map" className={styles.map_el}></div>

    </div>

  );

}
```