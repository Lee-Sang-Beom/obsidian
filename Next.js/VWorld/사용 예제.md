```tsx
"use client";

  

import styles from "./ChemiMap.module.scss";

import MapContext from "@/utils/map/mapContext";

import { useContext, useEffect, useState } from "react";

  

import { getVWorldLayer } from "@/app/Map/TotalTest/Layer";

import { MapControl } from "@/app/Map/TotalTest/MapControl";

import MapSide from "@/components/common/MapSide/MapSide";

import { useRouter } from "next/navigation";

import {

  AdmVO,

  SearchShelterCommand,

  ShelterDetailResponse,

} from "@/types/sub/Sm/SysShelter";

import { Session } from "next-auth";

import { chemicalSelectSearchFilter } from "@/types/common/filter/filter";

import { SearchChemCommand } from "@/types/sub/Sm/SysChemical";

import { ApiResponse, TablePageResponse } from "@/types/common/commonType";

import { useShelterList } from "@/hooks/sub/Sm/useShelterList";

import { useAutoAlert } from "@/hooks/Alert/useAutoAlert";

import { commonSelectType } from "@/components/common/CommonSelect/CommonSelect";

import { returnSettingShelterMarkerVectorLayer } from "@/types/sub2/Ci/ChemiMap/ShelterChemiMap";

import { Point } from "ol/geom";

  

interface ParamsProps {

  params?: {};

  searchParams?: {

    active?: number;

    seq?: number;

    name?: string;

  };

}

  

interface IProps {

  sigunguList: AdmVO[];

  session: Session | null;

  params?: ParamsProps;

}

  

export default function ChemiMap({ sigunguList, session, params }: IProps) {

  const { setIsChange, setText, setStatus } = useAutoAlert();

  

  const { mapObj } = useContext<any>(MapContext);

  const { map } = mapObj;

  

  const [isMounted, setIsMounted] = useState(false);

  

  // 리스트 닫기

  const [open, setOpen] = useState<boolean>(true);

  

  // 활성화된 탭 인덱스 위치

  const [activeIdx, setActiveIdx] = useState<number>(

    params && params.searchParams && params.searchParams.active

      ? Number(params.searchParams.active)

      : 0

  );

  

  /**

   * 1. 화학물질 조회 (로그인 권한자 표시, 해당 화학물질 취급하는 위치(업체)표시: 바뀔수있음)

   * @chemSearchType : 화학물질 검색 필터로 사용될 데이터

   * @chemSearchKeyWord : 검색 키워드(화학물질)를 관리할 state

   * @chemSearchKeyObj : 화학물질의 queryInstance

   *

   * @clickedMarkerChemInfoData : 클릭된 화학물질 마커가 무엇인지를 관리하는 state

   */

  const [chemSearchType, setChemSearchType] = useState<

    "MTTRNMKOR" | "MTTRNMENG" | "CASNO" | "ALL"

  >("ALL");

  const [chemSearchKeyWord, setChemSearchKeyWord] = useState<string>("");

  const [chemSearchKeyObj, setChemSearchKeyObj] = useState<SearchChemCommand>({

    page: 0,

    size: 10,

    searchKeyWord: "",

    orderBy: "ASC",

    sort: "casNo",

    chemSearchType: "ALL",

    changwonYn: "N",

  });

  const [clickedMarkerChemInfoData, setClickedChemMarkerInfoData] =

    useState(null);

  

  /**

   * 2. 취급업체 조회

   */

  

  /**

   * 3. 대피소

   * @sigunguFilterList : 대피소검색필터로 사용될 시군구 데이터

   * @defaultSigungu : default 시군구 데이터와 사용자가 선택한 시군구 데이터를 관리할 state

   * @shelterSearchKeyWord : 검색 키워드(대피소)를 관리할 state

   * @shelterSearchKeyObj : 대피소의 queryInstance

   * @shelterQuery : react-query(대피소 정보)

   * @shelterMarkerList : shelterQuery.data.content가 보관될 state. 조회한 대피소 리스트들을 저장하고, 대피소 마커를 만들기 위해 사용될 것임

   * @shelterMarker : shelterMarkerList에 들어간 데이터를 이용해 실질적으로 만든 마커 데이터

   * @clickedMarkerShelterInfoData : 클릭된 대피소 마커가 무엇인지를 관리하는 state

   *

   */

  const [sigunguFilterList, setSigunguFilterList] = useState<

    commonSelectType[]

  >([]);

  const [defaultSigungu, setDefaultSigungu] = useState<

    commonSelectType | undefined

  >(undefined);

  const [shelterSearchKeyWord, setShelterSearchKeyWord] = useState<string>("");

  const [shelterSearchKeyObj, setShelterSearchKeyObj] =

    useState<SearchShelterCommand>({

      page: 0,

      size: 5,

      sigungu: "",

      searchKeyWord:

        params && params.searchParams && params.searchParams.name

          ? params.searchParams.name

          : "",

      orderBy: "DESC",

      sort: "crtrYmd",

    });

  const shelterQuery = useShelterList(shelterSearchKeyObj);

  const [shelterMarkerList, setShelterMarkerList] = useState<

    ShelterDetailResponse[]

  >([]);

  const [shelterMarker, setShelterMarker] = useState<any | undefined>(

    undefined

  );

  const [clickedMarkerShelterInfoData, setClickedMarkerShelterInfoData] =

    useState<ShelterDetailResponse | null>(null);

  

  // 마커 클릭 시 발생하는 이벤트

  const handleMarkerClick = (event: any) => {

    const clickedFeature = map.forEachFeatureAtPixel(

      event.pixel,

      (feature: any) => feature

    );

  

    if (clickedFeature) {

      // 여기에서 clickedFeature에서 필요한 정보를 추출하고 상태를 업데이트합니다.

      const markerName = clickedFeature.get("geometryName");

      if (shelterMarkerList.length) {

        const clickMarkerData = shelterMarkerList.find((item) => {

          return item.shelterNm === markerName;

        });

        console.log("marker name is ", markerName);

        console.log("clickMarkerData is ", clickMarkerData);

      }

    }

  };

  

  // 최초 렌더링 시, 대피소 기본 select 필터 데이터 세팅

  useEffect(() => {

    if (sigunguList.length) {

      const filtedCommonSelectTypeSigunguList = sigunguList.map((item) => {

        return {

          name: item.lowestAdmCodeNm,

          value: item.admCode,

          group: "",

        };

      });

  

      const filtedDefaultSelectType = filtedCommonSelectTypeSigunguList.find(

        (item) => {

          return item.name === "창원시";

        }

      );

  

      // 총 리스트

      setSigunguFilterList(filtedCommonSelectTypeSigunguList);

  

      // 디폴트

      setDefaultSigungu(filtedDefaultSelectType);

      shelterSearchKeyObj.sigungu = filtedDefaultSelectType!.name;

    }

  }, []);

  

  // tabIndex가 변할때마다, queryInstance가 변하거나, query로 넘어온 데이터가 변할때마다, marker를 생성할 리스트를 새로 갱신

  useEffect(() => {

    // 1. 화학물질

  

    // 2. 취급업체

  

    // 3. 대피소

    if (shelterQuery && shelterQuery.data && shelterQuery.data.content) {

      setShelterMarkerList(shelterQuery.data.content);

    } else {

      setShelterMarkerList([]);

    }

  }, [activeIdx, shelterSearchKeyObj, shelterQuery.data]);

  

  // 화면 첫 렌더링 시 map 초기화 및 레이어/스타일 초기화

  useEffect(() => {

    // 초기화작업

    setIsMounted(true);

  

    // 최초 로드 시, BaseLayer 추가

    const vworld = getVWorldLayer();

  

    if (map) {

      // 기존 맵 객체 존재 시, default로 작동할 BaseLayer를 map에 add

      map.addLayer(vworld);

      map.on("click", handleMarkerClick);

      map.getAllLayers().map((m: any) => {

        if (

          m.get("name") &&

          (m.get("name") === "base-vworld-Satellite" ||

            m.get("name") === "base-vworld-hybrid")

        ) {

          map.removeLayer(m);

        }

        return;

      });

  

      map.on("pointermove", function (e: any) {

        const pixel = map.getEventPixel(e.originalEvent);

        const hit = map.hasFeatureAtPixel(pixel);

        map.getTarget().style.cursor = hit ? "pointer" : "";

        map.getTarget().style.zIndex = 9999;

      });

  

      return () => {

        map.un("click", handleMarkerClick);

      };

    }

  }, [map]);

  

  // activeIdex 및 markerList가 변할 때마다 마커를포함한 vectorLayer를 초기화하고, 다시 마커를 포함한 vectorLayor를 그리는 역할 수행

  useEffect(() => {

    if (!isMounted || !map) {

      return;

    }

  

    map.on("click", handleMarkerClick);

  

    // 레이어 추가 전, 모든 레이어 제거

    map.getAllLayers().map((m: any) => {

      if (m.get("name") && m.get("name") === "shelter") {

        map.removeLayer(m);

      }

    });

  

    // tabIndex 먼저 확인

    // 각 tabIndex(화학물질, 취급업체, 대피소)에 해당하는 레이어를 추가만 해주면 됨!!

    if (activeIdx == 0) {

    } else if (activeIdx == 1) {

    } else if (activeIdx == 2) {

      if (shelterMarkerList.length) {

        const newShelterMarkerVectorLayerList =

          returnSettingShelterMarkerVectorLayer(shelterMarkerList, "shelter");

  

        setShelterMarker(newShelterMarkerVectorLayerList);

        map.addLayer(newShelterMarkerVectorLayerList);

  

        // 데이터의 맨 첫번째 요소로 자동 포커스이동!!

        map.getView().setCenter(

          new Point([

            Number(shelterMarkerList[0].lot),

            Number(shelterMarkerList[0].lat),

          ])

            .transform("EPSG:4326", "EPSG:3857")

            // @ts-ignore

            .getCoordinates()

        );

      }

    } else {

    }

  

    return () => {

      map.un("click", handleMarkerClick);

    };

  }, [activeIdx, shelterMarkerList]);

  

  return (

    <div className={styles.chemimap_wrap}>

      <MapSide

        map={map}

        session={session}

        sigunguList={sigunguList}

        open={open}

        setOpen={setOpen}

        chemSearchType={chemSearchType}

        setChemSearchType={setChemSearchType}

        chemSearchKeyWord={chemSearchKeyWord}

        setChemSearchKeyWord={setChemSearchKeyWord}

        sigunguFilterList={sigunguFilterList}

        defaultSigungu={defaultSigungu}

        setDefaultSigungu={setDefaultSigungu}

        shelterSearchKeyWord={shelterSearchKeyWord}

        setShelterSearchKeyWord={setShelterSearchKeyWord}

        setShelterSearchKeyObj={setShelterSearchKeyObj}

        shelterDataList={shelterQuery.data}

        activeIdx={activeIdx}

        setActiveIdx={setActiveIdx}

      />

      <MapControl

        map={map}

        style={{

          left: "87%",

        }}

      />

      <div id="map" className={styles.map_el}></div>

    </div>

  );

}
```