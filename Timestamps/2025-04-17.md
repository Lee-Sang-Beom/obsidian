
#### Day Planner
---
- [ ] 하루 1회 프론트엔드 지식 및 Next.js 관련 기술 정리하기


#### Work
---
- [ ] 


```tsx
import { NextRequest, NextResponse } from "next/server";
import { withAuth } from "next-auth/middleware";

export default withAuth(
  async function middleware(req: NextRequest) {
    const url = req.nextUrl;
    const pathname = url.pathname;

    const token =
      req.cookies.get("next-auth.session-token") ||
      req.cookies.get("__Secure-next-auth.session-token");

    const isLoggedIn = !!token;

    // 로그인한 사용자가 접근하면 대시보드로 리다이렉트되는 페이지들
    const noAuthNeededPages = ["/login", "/join", "/forgot-password"];
    const isNoAuthNeededPage = noAuthNeededPages.includes(pathname);

    // 로그인 없이 접근 가능한 페이지들
    const publicAccessPages = ["/", ...noAuthNeededPages];
    const isPublicAccessPage = publicAccessPages.includes(pathname);

    // .css, .scss 파일인 경우 요청 그대로 진행
    if (pathname.match(/\.(css|scss)$/)) {
      return NextResponse.next(); // CSS/SCSS 파일은 미들웨어 처리하지 않음
    }

    // 로그인하지 않은 사용자가 접근 가능한 페이지가 아닌 경우 로그인 페이지로 리다이렉트
    if (!isLoggedIn && !isPublicAccessPage) {
      const loginUrl = new URL("/login", url.origin);
      loginUrl.searchParams.set("callbackUrl", pathname); // 로그인 후 돌아올 경로
      return NextResponse.redirect(loginUrl);
    }

    // 로그인한 사용자가 인증 페이지(로그인, 회원가입, 비밀번호찾기)에 접근하는 경우 대시보드로 리다이렉트
    if (isLoggedIn && isNoAuthNeededPage) {
      const dashboardUrl = new URL("/dashboard", url.origin);
      return NextResponse.redirect(dashboardUrl);
    }

    return NextResponse.next(); // 조건에 해당하지 않는 요청은 그대로 허용
  },
  {
    callbacks: {
      authorized: ({ req, token }) => {
        if (req.url.includes("/dashboard")) {
          if (!token || !token.user) {
            return false;
          } else {
            return true;
          }
        } else {
          return true;
        }
      },
    },
  }
);

export const config = {
  // 미들웨어가 적용되지 않도록 처리한 URL 패턴을 제외한 나머지 URL에 대해 미들웨어를 적용
  matcher: [
    "/((?!_next|favicon.ico|img).*)", // 특정 파일 경로를 제외한 모든 요청에 대해 미들웨어 적용
  ],
};
```
