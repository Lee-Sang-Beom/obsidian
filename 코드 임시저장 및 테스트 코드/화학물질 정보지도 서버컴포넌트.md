```tsx
import { headers } from "next/headers";
import { makeHostUrl, makeUrlQuery } from "@/utils/utils";
import { serverSideFetch } from "@/utils/serverSideFetch";
import { AdmVO } from "@/types/sub/Sm/SysShelter";
import {
  ApiResponse,
  EnumType,
  TablePageResponse,
} from "@/types/common/commonType";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/AuthOptions";
import ChemiMap from "./ChemiMap";
import {
  CompanyMapResponse,
  SearchCompanyChemForMapCommand,
  SearchShelterForMapCommand,
  SiAndDongCountResponse,
} from "@/types/sub2/Ci/ChemiMap/ChemiMap";
import { SearchCompanyCommand } from "@/types/sub/Sm/SysCompany";
import { ShelterResponse } from "@/types/common/Home/Home";

interface IProps {
  params?: {};
  searchParams?: {
    active?: number;
    seq?: number;
    name?: string;
  };
}

async function getCompanySearchType() {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl + `/api/common/company/getCompanySearchType`,
    {
      cache: "no-store",
    }
  );

  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }

  return res.json();
}

// 대피소
const fetchShelterList = async (searchObj: SearchShelterForMapCommand) => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl +
      `/api/common/shelter/getShelterPageForMap?${makeUrlQuery(searchObj)}`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

// 취급업체 (로그인 o)
const fetchCompanyList = async (searchObj: SearchCompanyCommand) => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl + `/api/company/getCompanyPageForMap?${makeUrlQuery(searchObj)}`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

// 취급업체 (로그인 x)
const fetchCompanyCommonList = async (searchObj: SearchCompanyCommand) => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl +
      `/api/common/company/getCompanyPageForMap?${makeUrlQuery(searchObj)}`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

// 화학물질
const fetchChemCompanyList = async (
  searchObj: SearchCompanyChemForMapCommand
) => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl +
      `/api/common/company/getCompanyPageByCompanyChem?${makeUrlQuery(
        searchObj
      )}`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

const getCommonCompanyCountForBjd = async () => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl + `/api/common/company/getCompanyCountForBjd?stdgCd=4812000000`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

const getCompanyCountForBjd = async () => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl + `/api/company/getCompanyCountForBjd?stdgCd=4812000000`,
    {
      cache: "no-store",
    }
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

const getChangwonBoundingBoxData = async () => {
  const headersInstance = headers();
  const hostUrl = makeHostUrl(headersInstance);

  const res = await serverSideFetch(
    hostUrl +
      `/api/common/openapi/getDongGeomeByBoundingBox?boundingBox=128.3916218148024,35.099745781503515,128.88063104464345,35.28747340324021&crs=EPSG:4326`
  );
  if (!res.ok) {
    throw new Error("Failed to fetch data");
  }
  return res.json();
};

export default async function ChemimapServer({ params }: IProps) {
  const { data: companySelectTypeFilterList }: ApiResponse<EnumType<string>[]> =
    await getCompanySearchType();

  const session = await getServerSession(authOptions);

  const shelterSearchKeyObj: SearchShelterForMapCommand = {
    page: 0,
    size: 10,
    shelterForMapSearchType: "ALL",
    searchKeyWord: "",
    orderBy: "ASC",
    sort: "shelterNm",
  };

  const companySearchKeyObj: SearchCompanyCommand = {
    page: 0,
    size: 10,
    companySearchType: "ALL",
    searchKeyWord: "",
    orderBy: "ASC",
    sort: "companyNm",
    evacMttrYn: null,
    acdntMttrYn: null,
  };

  // 화학물질
  const chemCompanySearchKeyObj: SearchCompanyChemForMapCommand = {
    page: 0,
    size: 10,
    searchKeyWord: "",
    orderBy: "ASC",
    sort: "companyNm",
    chemSearchType: "ALL",
    evacMttrYn: null,
    acdntMttrYn: null,
  };

  const {
    data: shelterData,
  }: ApiResponse<TablePageResponse<ShelterResponse[]>> =
    await fetchShelterList(shelterSearchKeyObj);

  const {
    data: companyData,
  }: ApiResponse<TablePageResponse<CompanyMapResponse[]>> =
    session && session.user
      ? await fetchCompanyList(companySearchKeyObj)
      : await fetchCompanyCommonList(companySearchKeyObj);

  const {
    data: chemCompanyData,
  }: ApiResponse<TablePageResponse<CompanyMapResponse[]>> =
    await fetchChemCompanyList(chemCompanySearchKeyObj);

  const shelterTotalElements = shelterData ? shelterData.totalElements : 0;
  const companyTotalElements = companyData ? companyData.totalElements : 0;
  const chemCompanyTotalElements = chemCompanyData
    ? chemCompanyData.totalElements
    : 0;

  const { data: siAndDongData }: ApiResponse<SiAndDongCountResponse[]> =
    session && session.user
      ? await getCompanyCountForBjd()
      : await getCommonCompanyCountForBjd();

  const { data: changwonBoundingBoxData } = await getChangwonBoundingBoxData();
  return (
    <ChemiMap
      params={params}
      companySelectTypeFilterList={companySelectTypeFilterList}
      session={session}
      shelterTotalElements={shelterTotalElements}
      companyTotalElements={companyTotalElements}
      chemCompanyTotalElements={chemCompanyTotalElements}
      siAndDongData={siAndDongData}
      changwonBoundingBoxData={changwonBoundingBoxData}
    />
  );
}

```