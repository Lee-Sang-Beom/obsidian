
#### 1. 연관관계 매핑 시 고려사항 3가지

1. **다중성** 
	 - 다대일: @ManyToOne 
	 - 일대다: @OneToMany 
	 - 일대일: @OneToOne 
	 - 다대다: @ManyToMan

2. **단방향, 양방향** 
	- 테이블
		- 외래 키 하나만 있으면, 양쪽으로 조인 가능하다.
		- 사실 방향이라는 개념은 없다. (외래키만 있으면 됨)

	- 객체
		- 객체 연관관계는 방향이 있다.
		- 참조용 필드가 있는 쪽으로만 참조가 가능한 특징이 있다. 
			- 참조용 필드가 있어야,  아래 메소드로 접근이 가능하다.
			- `member.getTeam()`, `team.getMembers()`
		
		- 한쪽만 참조하면 단방향
		- 양쪽이 서로 참조하는 구조이면, 양방향

3. **연관관계의 주인**
	 - 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺는다.
	 - 객체 양방향 관계는 A->B, B->A 처럼 참조 위치가 2곳으로 발생한다.
		 - 객체 양방향 관계는 참조가 2군데 있다.
		 - 둘중 테이블의 외래 키를 관리할 곳을 지정해야 한다.

	 - 연관관계의 주인(`@joinColumn`): 외래 키를 관리하는 테이블과 매핑된 참조로 지정해야 한다.
	 - 연관관계 주인의 반대편(`mappedBy`): 외래 키에 영향을 주지 않으며, 단순 조회만 가능하다.


#### 2. 다대일 [N:1]

###### ※ 다대일 단방향

![[다대일 단방향.png]]
- DB 입장에서는 Member가 'n', Team이 '1'이다.
	- 다대일(n:1) 관계에서는 항상 **다(n)** 쪽에 **외래키**가 위치해 있어야 한다.
	- 아니면 설계가 잘못된 것이다.

- Member객체에서 `Team team`이라는 참조값도 동일하다.
	- 단순히 `member` 인스턴스가 속한 Team을 찾아가고 싶기 때문에 Member에 `Team team`이라는 참조를 걸어놓는 것이다.
	- 위 이미지처럼, Member 테이블에 외래키가 있는 것을 확인하고, 그냥 Member 객체의 team이라는 속성에 참조를 걸음으로써 `Team team`과 `TEAM_ID(FK)`를 연관관계 매핑을 하면 된다.

- 가장 많이 사용하는 연관관계이다.

![[다대일 단방향예시.png]]

###### ※ 다대일 양방향

![[다대일 양방향.png]]
- 앞서, 외래키가 있는 곳이 연관관계의 주인이라고 언급했다.
- 연관관계의 주인이 아닌 객체에 `mappedBy`를 걸어주면 된다.
	- 본 예제의 다대일 관계 예제에서, Team 객체의 `List members`쪽에 참조를 걸어주면 되는데, Team의 입장에서는 Member와 일대다 관계이기 때문에, `@OneToMany`를 걸어주어야 한다. (Member의 `Team team`은 `@ManyToOne`)
	
	- `mappedBy = [attributeName]`에서, `attributeName`은 연관관계 주인 측의 어떤 참조 속성과 매핑해야하는지를 결정한 것이다.
		- **연관관계 주인(관계를 소유하는 쪽)과 관계를 매핑하기 위해 사용하는 annotation이 `mappedBy`이다.**
			- `mappedBy`로 정의된 필드는 읽기만 가능하다.
		
		- 본 예제에서, Team 엔티티는 Member 엔티티와 `@OneToMany`(일대다) 관계를 가지고 있다. 그리고 `List<Member> members`는 `mappedBy` 옵션을 사용하여, Member 엔티티의 `team` 필드에 의해 매핑된다는 것을 나타낸다.

![[다대일 양방향 예시.png]]
![[다대일 양방향 예시.png]]