
#### 1. 정의

 - C와 같은 언어는 메모리 할당을 위해 `malloc()`을, 해제를 위해 `free()`를 사용한다.
	 - 하지만, 자바스크립트는 객체 생성 및 값을 초기화 할 때 자동으로 메모리를 할당하고, 객체가 더이상 필요하지 않을 때 메모리를 자동으로 해제할 수 있도록 도와주는 것이 있는데, 이것이 가비지 컬렉션(Garbage Collection)이다. 

- 자바스크립트의 가비지 컬렉션(Garbage Collection)은 더 이상 사용되지 않는 메모리를 자동으로 해제해 주는 메모리 관리 메커니즘이다.
	- 자바스크립트는 메모리 관리가 자동으로 이루어지므로, 개발자가 직접 메모리를 해제할 필요가 없고 언어가 이를 스스로 처리한다.

```javascript
let apple = {
  name : 'apple',
}

let orange = apple;

orange = null;
apple = null;
```
- 객체를 특정 식별자에 할당하는 구문이 실행되면, 객체는 `heap`이라는 곳에 만들어진다. 
	- 이 때의 식별자는 메모리가 만들어진 주소를 가리킨다.
	- 메모리 안에 아무것도 없을 경우에 (Null) 참조하는 것이 없다면, 쓰레기로 간주하고 메모리에서 깔끔하게 청소를 해준다.

- 자바스크립트에서 가비지 컬렉션이 발생하는 이유는  자바스크립트 엔진 자체에서 제공하는 **가비지 컬렉터**가 백그라운드 프로세스에서 동작하기 때문이다. 
	- 대신 이런 점에서 CPU 동작이 발생하여, 비용이 발생하게 된다. 


#### 2. 목적

 - 자바스크립트의 가비지 컬렉션의 **목적**은 불필요한 메모리 사용을 줄여 성능을 최적화하고 메모리 누수(memory leak)를 방지하는 데 있다. 
 
 - JavaScript는 브라우저나 Node.js 환경에서 작동하며, 메모리가 제한적일 수 있기 때문에 불필요한 메모리 점유를 줄이는 것이 중요하다.
 
 - 가비지 컬렉터는 자동으로 메모리 관리를 수행하여 개발자가 명시적으로 메모리를 해제할 필요를 줄이고, 메모리 관리를 실수 없이 수행할 수 있도록 돕는다.


#### 3. 알고리즘

- 가비지 컬렉션의 주요 원칙은 **도달성(reachability)** 이다. 다음은 자바스크립트 가비지 컬렉션의 핵심 사항이다.
	1. **도달성(reachability) 기준**: 자바스크립트 엔진은 도달할 수 없는(즉, 실행 중인 코드에서 접근할 수 없는) 객체들을 가비지 컬렉션 대상으로 간주한다.
	    - 기본적으로 전역 객체, 현재 호출 스택의 로컬 변수 및 클로저가 참조하는 객체들이 도달 가능한 상태로 간주된다.
	    - 함수 실행이 종료되거나 변수가 재할당되어 더 이상 참조되지 않으면, 그 객체는 도달할 수 없는 상태가 되어 가비지 컬렉션의 대상이 된다.
	
	2. **참조 카운팅 방식**: 자바스크립트에서는 주요 메모리 관리 방식으로 _마크 앤드 스윕(mark-and-sweep)_ 방식을 사용한다. 
		- 그러나 참조 카운팅이 누락되거나 순환 참조로 인해 객체가 해제되지 않는 메모리 누수가 발생할 수 있다.
    
	3. **마크 앤드 스윕(Mark-and-Sweep)**: 가비지 컬렉터는 도달할 수 있는 모든 객체를 추적하고, 더 이상 참조되지 않는 객체들을 해제한다.
	    - 엔진은 먼저 루트 객체에서 시작해 참조되고 있는 객체들을 확인하여 "마킹"하고, 마크되지 않은 객체들은 메모리에서 해제(sweep)한다.
	    - **도달 가능한 객체 확인**: 가비지 컬렉터는 '루트' 객체(전역 객체와 실행 중인 함수의 스택 등)에서 시작하여, 모든 참조를 따라가며 도달 가능한(reachable) 객체를 마킹한다. 이러한 객체는 아직 사용 중이므로 삭제하지 않는다.
		- **마크 단계(Mark Phase)**: 루트 객체에서 참조하는 모든 객체를 '도달 가능' 상태로 마크(mark)합니다. 이 마크는 해당 객체가 여전히 코드에서 참조되고 있음을 나타낸다.
		- **스윕 단계(Sweep Phase)**: 도달 가능한 객체로 마크되지 않은 객체들을 메모리에서 해제한다. 즉, 참조되지 않는 객체들이 메모리에서 삭제된다.
	
	4. **가비지 컬렉션 트리거**: 자바스크립트는 다양한 이벤트와 엔진의 상태에 따라 가비지 컬렉션을 실행한다. 가비지 컬렉션은 주기적으로, 또는 메모리 부족이 감지되면 수행된다.

- 최근의 자바스크립트 엔진(V8, SpiderMonkey 등)에서는 **분할 가비지 컬렉션(incremental garbage collection)**, **생성 세대 가비지 컬렉션(generational garbage collection)** 등의 기법을 도입해 성능을 높이고 중단 시간을 줄이는 최적화를 수행한다.
	1. **분할 가비지 컬렉션**: 큰 데이터 세트를 여러 번에 걸쳐 나누어 가비지 컬렉션을 수행하여 중단 시간을 최소화한다.
	2. **생성 세대 가비지 컬렉션**: 객체를 생명 주기별로 분류하여, 단기적으로 존재하는 객체와 장기적으로 존재하는 객체를 분리 관리한다. 단기 객체는 생성과 해제의 빈도가 높으므로 빠르게 가비지 컬렉션이 이루어지고, 장기 객체는 덜 자주 검사하여 효율성을 높인다.

- 이와 같은 최신 알고리즘 덕분에 JavaScript 엔진은 메모리 관리 효율성을 크게 개선하고, 프로그램 실행 중단 시간을 최소화할 수 있도록 한다.

#### 4. 주의사항

- 자바스크립트의 가비지 컬렉션은 자동화되어 있지만, 개발자는 여전히 메모리 누수(leak)가 발생하지 않도록 신경 써야 한다.
	- 특히 전역 객체에 변수를 선언하거나, 이벤트 리스너를 해제하지 않는 경우, 클로저와 순환 참조에서 메모리 누수가 발생할 수 니다.

- 따라서 최적의 성능을 위해서는 사용하지 않는 변수를 `null`로 할당하거나 클로저를 정리하는 방식으로 메모리를 관리하는 것이 중요하다.
	- 또한, 특정 블록 스코프에 정의된 식별자들은 블록 스코프의 역할이 끝나면 가비지 컬렉터가 메모리를 처리해주면서 자동으로 소멸된다.
	- 때문에, 전역적으로 사용하는 전역변수는 성능 이슈로 가능한 한 적게 쓰는 것이 좋다.