
#### 0. 들어가기 전에

- 아래는 클라이언트가 서버와 통신하는 일반적인 과정을 보여준다.
![[일반적인 클라이언트와 서버의 통신과정.png]]
- 하지만, 실제로 사용자가 브라우저에서 URL을 입력해 요청을 시작한 순간부터, 서버가 서비스를 제공하는 응답이 도착할 때까지 거치는 과정은 위 사진처럼 **간단하지 않다.**
	- 보안상의 이유 혹은 기업이 사용하는 네크워크의 복잡도에 따라 요청이 거치게 되는 과정은 **천차만별**이다.

- 그 과정은 여러가지 유형이 있지만, 대표적으로 **리버스 프록시**에 대한 설명을 할까 한다.
	- 리버스 프록시에 대해 알기 전에, **프록시**가 무엇인지에 대해서 알아보자.


#### 1. 프록시(Proxy)

- 프록시(Proxy)란, **클라이언트와 웹 서버의 중간에서 어떠한 과정을 처리하는 구성**을 의미한다.
	- 클라이언트와 웹 서버의 사이에서 프록시를 진행하는 서버를 **프록시 서버**(Proxy Server)라고 한다.

- 프록시는 크게 두가지의 종류로 분류할 수 있다.
	- 1. **포워드 프록시**(Forward Proxy, 정방향 프록시)
	- 2. **리버스 프록시**(Reverse Proxy, 역방향 프록시)


#### 2. 포워드 프록시(Forward Proxy, 정방향 프록시)

![[포워드 프록시.png]]
- 클라이언트가 직접적으로 서버에 통신하는 것이 아닌, 프록시 서버가 대신 통신해주는 구성을 **포워드 프록시**라고 한다.

- 클라이언트가 서버에 접근할 때, 클라이언트는 접근하려는 서버의 주소를 포워드 프록시에 전달하고, 포워드 프록시가 인터넷으로 요청된 내용을 가져오는 방식을 사용한다.

##### 장점
- **보안**: 클라이언트가 웹 사이트로 직접적으로 방문하는 것을 제한한다. 이 때, 포워드 프록시 서버는 방화벽같은 개념으로, 특정 사이트에 접속하는 것을 막을 수 있도록 한다.

- **캐싱**: 클라이언트가 특정 웹 사이트에 접근할 때, 프록시 서버가 해당 페이지 서버의 정보를 임시보관(캐싱)할 수 있다. 이를 통해 서버의 부하를 줄일 수 있고, 클라이언트도 빠른 응답을 받을 수 있다.

- **암호화**: 클라이언트 요청은 포워드 프록시 서버를 통과하면서 암호화된다. 이 때, 암호화된 요청은  다른 서버를 통과할 때 필요한 최소한의 정보만 갖게 되는데, 이는 클라이언트의 IP를 감춰주는 보안 효과를 낸다.
	- 따라서, 본 서버에서 IP주소에 대한 역추적을 하더라도 **포워드 프록시 서버의 IP**만 보인다.


#### 3. 리버스 프록시(Reverse Proxy, 역방향 프록시)

![[리버스 프록시.png]]
- **리버스 프록시**는 **웹 서버** 혹은 **WAS** 쪽에 붙어, 해당 요청에 대해서 각자 다른 웹 서버에 배분해주는 역할을 한다.
	- 클라이언트는 특정 사이트에 접근할 때 웹 서버에 요청하는 것이 아닌, 리버스 프록시 서버로 요청하게 되고, 프록시가 배후(reverse)의 서버로부터 데이터를 가져오게 된다.

##### 장점
- **로드 밸런싱**: 단일 서버에 트래픽이 몰리게 되면, 서버가 과부하될 수 있다. 이 때 여러 대의 서버를 두고 요청을 분산시키는 것이 **로드 밸런싱**이다.  위에서 언급한대로, 리버스 프록시는 **웹 서버 혹은 WAS** 쪽에 붙어, 해당 요청을 다른 웹 서버에 배분해줄 수 있기 때문에, 서버 부하를 줄일 수 있도록 해준다.

- **캐싱**: 리버스 프록시도 포워드 프록시처럼, **프록시 서버에 캐싱된 데이터를 사용**하여, 클라이언트의 요청을 처리할 수 있다. 프록시 서버의 기본 기능이라 생각하면 된다.

- **보안**: 리버스 프록시는 웹 서버 혹은 WAS 앞에 놓이기 때문에, 클라이언트가 **웹 서버에 직접 접근하는 것**이 아닌 리버스 프록시를 통해 접근하기 때문에, 웹 서버의 ip를 노출시키지 않는다. 포워드 프록시가 서버 측에서 클라이언트 IP주소를 추적하지 못하게 한다면, 리버스 프록시는 클라이언트 측에서, 웹 서버의 IP를 추적하지 못하게 한다고 생각할 수 있다.(프록시 서버의 IP만 노출되기 떄문)

- 그리고, 이러한 **리버스 프록시**를 구현하게 하는 대표적인 소프트웨어가 바로 **Nginx**이다.

### Nginx

참고 URL : [https://dkswnkk.tistory.com/513](https://dkswnkk.tistory.com/513)

Nginx란 트래픽이 많은 웹사이트의 서버(WAS)를 도와주는 비동기 이벤트 기반구조의 경량화 웹 서버 소프트웨어이다.

때문에 Nginx는 웹에서 사용하는 정적 파일들을 응답해주는 HTTP Web Server로 활용할 수 있지만, Nginx는 역방향 프록시 기능을 탑재하고 있어 역방향 프록시 서버로 활용이 되기도 한다.

뎁스에서도 마찬가지로 Nginx를 역방향 프록시 서버로 사용하고 있다.

예시를 살펴보자.
![[nginx.png]]
해당 사진은 nginx의 설정파일이다.

해당 nginx의 listen 포트로 들어오는 모든 경로(location /)에 대해서 proxy_pass에 설정되어있는 서버로 재 요청을 보낸다.

해당 재 요청 시, 추가로 http 요청의 header에 추가 값을 담는 로직도 포함되어 있다.



#### 참고 및 이미지 출처
- [프록시란?]([https://engineer-mole.tistory.com/288](https://engineer-mole.tistory.com/288)
- [포워드 프록시와 리버스 프록시](https://inpa.tistory.com/entry/NETWORK-%F0%9F%93%A1-Reverse-Proxy-Forward-Proxy-%EC%A0%95%EC%9D%98-%EC%B0%A8%EC%9D%B4-%EC%A0%95%EB%A6%AC)