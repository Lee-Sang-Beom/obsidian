
#### 1. ckeditor5 파일 다운로드 받기

- CKEditor5를 `@ckeditor/ckeditor5-react, @ckeditor/ckeditor5-build-classic` 라이브러리만을 사용하고, CSS를 변경하는 방식으로 에디터를 사용하기에는, 명확한 한계가 있었다.
	- 동작하기를 원하는 기능이 동작하지 않는 문제가 너무나 많았다는 것이 문제였다.

- 그래서 이번에는 다른 방법을 찾다가, 다음 [링크](https://ckeditor.com/docs/ckeditor5/latest/installation/getting-started/quick-start-other.html#creating-custom-builds-with-online-builder)에서 제시하는 방법대로 커스터마이징 인스톨을 진행해보려 한다.


#### 2. Online Builder 

###### STEP 1
- 먼저, 다음의 [Online Builder 링크](https://ckeditor.com/ckeditor-5/online-builder/)로 이동해보자.
	- 그럼, 총 5개의 STEP이 제시되어 있고 Editor Type을 선택하는 화면을 확인할 수 있을 것이다.
	- 여기서는, **Classic Type**을 선택할 것이다.  
![[ckeditor5 커스터마이징 온라인 빌더 step1.png]]

###### STEP 2
- 다음은, 사용할 에디터에서 어떤 기능을 사용할 지에 대해 선택하는 플러그인 선택 단계이다.
- 구현하기를 원하는 플러그인들을 선택하여 넣으면 된다.
![[ckeditor5 커스터마이징 온라인 빌더 step2.png]]

###### STEP 3
- 다음은, 실제 사용할 툴바 아이템을 어느 위치에 배치시킬지에 대한 내용이다.
	- 마우스로 아이템을 끌어 적용이 가능하다.
![[ckeditor5 커스터마이징 온라인 빌더 step3.png]]


###### STEP 4
- 다음은, Editor의 언어를 선택하는 단계이다. (한국어가 있다.)
![[ckeditor5 커스터마이징 온라인 빌더 step4.png]]

###### STEP 5
- custom CKEditor5 build 데이터를 다운로드하는 화면이다. 
	- 아래 START 버튼을 눌러 다운로드할 수 있다.
![[ckeditor5 커스터마이징 온라인 빌더 step5.png]]


#### 3. 프로젝트에 적용하기

- 이제, 다운로드받은 ckEditor 파일을 Next.js 프로젝트에 옮겨주어야 한다.
	- 다음과 같이, `ckEditor5` 디렉터리를 통째로 옮겨주자.
![[ckEditor 디렉터리.png]]

- 이제 해당 [링크](https://ckeditor.com/docs/ckeditor5/latest/installation/integrations/next-js.html)를 참고하여 설치 과정을 진행하면 된다.
	- ```npm install file:./ckeditor5```
	- 만약, `ckeditor5-react`가 설치되어있지 않으면, `@ckeditor/ckeditor5-react` 설치

- 이제, 설치한 라이브러리를 기반으로 `<CustomCKEditor />` 컴포넌트를 구현해주면 끝이다.
```tsx
"use client";

import "./Editor.scss";
import React, { useRef } from "react";
import * as process from "process";
import FormData from "form-data";
import axios from "axios";

// 별도로 설치한 ckEditor build파일
import Editor from "ckeditor5-custom-build/build/ckeditor";
import { CKEditor } from "@ckeditor/ckeditor5-react";

interface CustomCKEditorProps {
  /**
   * @content: 내용 state 값
   */
  content: string;
  /**
   * @onContentChange: 내용이 바뀔 때마다 실행되는 콜백함수
   */
  onContentChange: (value: string) => void;
}

const CustomCKEditor = ({ content, onContentChange }: CustomCKEditorProps) => {
  const customUploadAdapter = (loader: any) => {
    return {
      upload: () => {
        return new Promise((resolve, reject) => {
          const data = new FormData();
          loader.file.then((file: any) => {
            data.append("file", file);
            axios
              .post(
                process.env.NEXT_PUBLIC_HOST + "/utils/files/upload",
                data,
                {
                  headers: {
                    "Content-Type":
                      "multipart/form-data; boundary=" +
                      "------" +
                      Math.random().toString(36).substring(2),
                  },
                }
              )
              .then((res) => {
                const { data } = res;
                if (data.error) {
                  reject(data.error);
                } else {
                  resolve({
                    default: data.url,
                  });
                }
              })
              .catch((err) => {
                reject(err);
              });
          });
        });
      },
      abort: () => {},
    };
  };

  function uploadPlugin(editor: any) {
    editor.plugins.get("FileRepository").createUploadAdapter = (
      loader: any
    ) => {
      return customUploadAdapter(loader);
    };
  }

  return (
    <>
      <CKEditor
        editor={Editor}
        data={content}
        onChange={(e, editor) => {
          //@ts-ignore
          const value = editor.getData();
          onContentChange(value);
        }}
        config={{
          // upload img 관리
          extraPlugins: [uploadPlugin],
          // toolbar 관리 func 제거
          removePlugins: ["Table"],

          // oembed -> iframe으로 링크 영상이 출력되게끔 구성
          //@ts-ignore
          mediaEmbed: {
            previewsInData: true,
          },
        }}
      />
    </>
  );
};

export default CustomCKEditor;

```